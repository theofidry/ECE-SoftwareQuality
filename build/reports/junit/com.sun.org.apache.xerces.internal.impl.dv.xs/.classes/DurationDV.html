


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: DurationDV</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">com.sun.org.apache.xerces.internal.impl.dv.xs</a> ]
</div>

<h1>Coverage Summary for Class: DurationDV (com.sun.org.apache.xerces.internal.impl.dv.xs)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DurationDV</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 164)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;//
<i>2</i>&nbsp;// Source code recreated from a .class file by IntelliJ IDEA
<i>3</i>&nbsp;// (powered by Fernflower decompiler)
<i>4</i>&nbsp;//
<i>5</i>&nbsp;
<i>6</i>&nbsp;package com.sun.org.apache.xerces.internal.impl.dv.xs;
<i>7</i>&nbsp;
<i>8</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.dv.InvalidDatatypeValueException;
<i>9</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.dv.ValidationContext;
<i>10</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.dv.xs.AbstractDateTimeDV;
<i>11</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.dv.xs.SchemaDateTimeException;
<i>12</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.dv.xs.AbstractDateTimeDV.DateTimeData;
<i>13</i>&nbsp;import java.math.BigDecimal;
<i>14</i>&nbsp;import java.math.BigInteger;
<i>15</i>&nbsp;import javax.xml.datatype.Duration;
<i>16</i>&nbsp;
<i>17</i>&nbsp;public class DurationDV extends AbstractDateTimeDV {
<i>18</i>&nbsp;    public static final int DURATION_TYPE = 0;
<i>19</i>&nbsp;    public static final int YEARMONTHDURATION_TYPE = 1;
<i>20</i>&nbsp;    public static final int DAYTIMEDURATION_TYPE = 2;
<i>21</i>&nbsp;    private static final DateTimeData[] DATETIMES = new DateTimeData[]{new DateTimeData(1696, 9, 1, 0, 0, 0.0D, 90, (String)null, true, (AbstractDateTimeDV)null), new DateTimeData(1697, 2, 1, 0, 0, 0.0D, 90, (String)null, true, (AbstractDateTimeDV)null), new DateTimeData(1903, 3, 1, 0, 0, 0.0D, 90, (String)null, true, (AbstractDateTimeDV)null), new DateTimeData(1903, 7, 1, 0, 0, 0.0D, 90, (String)null, true, (AbstractDateTimeDV)null)};
<i>22</i>&nbsp;
<i>23</i>&nbsp;    public DurationDV() {
<i>24</i>&nbsp;    }
<i>25</i>&nbsp;
<i>26</i>&nbsp;    public Object getActualValue(String content, ValidationContext context) throws InvalidDatatypeValueException {
<i>27</i>&nbsp;        try {
<i>28</i>&nbsp;            return this.parse(content, 0);
<i>29</i>&nbsp;        } catch (Exception var4) {
<i>30</i>&nbsp;            throw new InvalidDatatypeValueException(&quot;cvc-datatype-valid.1.2.1&quot;, new Object[]{content, &quot;duration&quot;});
<i>31</i>&nbsp;        }
<i>32</i>&nbsp;    }
<i>33</i>&nbsp;
<i>34</i>&nbsp;    protected DateTimeData parse(String str, int durationType) throws SchemaDateTimeException {
<i>35</i>&nbsp;        int len = str.length();
<i>36</i>&nbsp;        DateTimeData date = new DateTimeData(str, this);
<b class="nc"><i>37</i>&nbsp;        byte start = 0;</b>
<i>38</i>&nbsp;        int var12 = start + 1;
<i>39</i>&nbsp;        char c = str.charAt(start);
<i>40</i>&nbsp;        if(c != 80 &amp;&amp; c != 45) {
<i>41</i>&nbsp;            throw new SchemaDateTimeException();
<i>42</i>&nbsp;        } else {
<i>43</i>&nbsp;            date.utc = c == 45?45:0;
<i>44</i>&nbsp;            if(c == 45 &amp;&amp; str.charAt(var12++) != 80) {
<i>45</i>&nbsp;                throw new SchemaDateTimeException();
<i>46</i>&nbsp;            } else {
<i>47</i>&nbsp;                byte negate = 1;
<b class="nc"><i>48</i>&nbsp;                if(date.utc == 45) {</b>
<i>49</i>&nbsp;                    negate = -1;
<i>50</i>&nbsp;                }
<i>51</i>&nbsp;
<i>52</i>&nbsp;                boolean designator = false;
<i>53</i>&nbsp;                int endDate = this.indexOf(str, var12, len, &#39;T&#39;);
<i>54</i>&nbsp;                if(endDate == -1) {
<i>55</i>&nbsp;                    endDate = len;
<b class="nc"><i>56</i>&nbsp;                } else if(durationType == 1) {</b>
<b class="nc"><i>57</i>&nbsp;                    throw new SchemaDateTimeException();</b>
<b class="nc"><i>58</i>&nbsp;                }</b>
<i>59</i>&nbsp;
<i>60</i>&nbsp;                int end = this.indexOf(str, var12, endDate, &#39;Y&#39;);
<i>61</i>&nbsp;                if(end != -1) {
<i>62</i>&nbsp;                    if(durationType == 2) {
<i>63</i>&nbsp;                        throw new SchemaDateTimeException();
<i>64</i>&nbsp;                    }
<i>65</i>&nbsp;
<i>66</i>&nbsp;                    date.year = negate * this.parseInt(str, var12, end);
<i>67</i>&nbsp;                    var12 = end + 1;
<i>68</i>&nbsp;                    designator = true;
<i>69</i>&nbsp;                }
<i>70</i>&nbsp;
<b class="nc"><i>71</i>&nbsp;                end = this.indexOf(str, var12, endDate, &#39;M&#39;);</b>
<b class="nc"><i>72</i>&nbsp;                if(end != -1) {</b>
<i>73</i>&nbsp;                    if(durationType == 2) {
<b class="nc"><i>74</i>&nbsp;                        throw new SchemaDateTimeException();</b>
<b class="nc"><i>75</i>&nbsp;                    }</b>
<b class="nc"><i>76</i>&nbsp;</b>
<b class="nc"><i>77</i>&nbsp;                    date.month = negate * this.parseInt(str, var12, end);</b>
<i>78</i>&nbsp;                    var12 = end + 1;
<i>79</i>&nbsp;                    designator = true;
<b class="nc"><i>80</i>&nbsp;                }</b>
<b class="nc"><i>81</i>&nbsp;</b>
<b class="nc"><i>82</i>&nbsp;                end = this.indexOf(str, var12, endDate, &#39;D&#39;);</b>
<i>83</i>&nbsp;                if(end != -1) {
<i>84</i>&nbsp;                    if(durationType == 1) {
<i>85</i>&nbsp;                        throw new SchemaDateTimeException();
<b class="nc"><i>86</i>&nbsp;                    }</b>
<i>87</i>&nbsp;
<b class="nc"><i>88</i>&nbsp;                    date.day = negate * this.parseInt(str, var12, end);</b>
<b class="nc"><i>89</i>&nbsp;                    var12 = end + 1;</b>
<i>90</i>&nbsp;                    designator = true;
<i>91</i>&nbsp;                }
<i>92</i>&nbsp;
<b class="nc"><i>93</i>&nbsp;                if(len == endDate &amp;&amp; var12 != len) {</b>
<i>94</i>&nbsp;                    throw new SchemaDateTimeException();
<b class="nc"><i>95</i>&nbsp;                } else {</b>
<b class="nc"><i>96</i>&nbsp;                    if(len != endDate) {</b>
<b class="nc"><i>97</i>&nbsp;                        label96: {</b>
<i>98</i>&nbsp;                            ++var12;
<b class="nc"><i>99</i>&nbsp;                            end = this.indexOf(str, var12, len, &#39;H&#39;);</b>
<b class="nc"><i>100</i>&nbsp;                            if(end != -1) {</b>
<i>101</i>&nbsp;                                date.hour = negate * this.parseInt(str, var12, end);
<i>102</i>&nbsp;                                var12 = end + 1;
<i>103</i>&nbsp;                                designator = true;
<b class="nc"><i>104</i>&nbsp;                            }</b>
<b class="nc"><i>105</i>&nbsp;</b>
<i>106</i>&nbsp;                            end = this.indexOf(str, var12, len, &#39;M&#39;);
<b class="nc"><i>107</i>&nbsp;                            if(end != -1) {</b>
<b class="nc"><i>108</i>&nbsp;                                date.minute = negate * this.parseInt(str, var12, end);</b>
<i>109</i>&nbsp;                                var12 = end + 1;
<i>110</i>&nbsp;                                designator = true;
<i>111</i>&nbsp;                            }
<b class="nc"><i>112</i>&nbsp;</b>
<b class="nc"><i>113</i>&nbsp;                            end = this.indexOf(str, var12, len, &#39;S&#39;);</b>
<b class="nc"><i>114</i>&nbsp;                            if(end != -1) {</b>
<i>115</i>&nbsp;                                date.second = (double)negate * this.parseSecond(str, var12, end);
<i>116</i>&nbsp;                                var12 = end + 1;
<b class="nc"><i>117</i>&nbsp;                                designator = true;</b>
<b class="nc"><i>118</i>&nbsp;                            }</b>
<i>119</i>&nbsp;
<b class="nc"><i>120</i>&nbsp;                            if(var12 == len) {</b>
<b class="nc"><i>121</i>&nbsp;                                --var12;</b>
<i>122</i>&nbsp;                                if(str.charAt(var12) != 84) {
<i>123</i>&nbsp;                                    break label96;
<i>124</i>&nbsp;                                }
<b class="nc"><i>125</i>&nbsp;                            }</b>
<b class="nc"><i>126</i>&nbsp;</b>
<b class="nc"><i>127</i>&nbsp;                            throw new SchemaDateTimeException();</b>
<i>128</i>&nbsp;                        }
<i>129</i>&nbsp;                    }
<b class="nc"><i>130</i>&nbsp;</b>
<b class="nc"><i>131</i>&nbsp;                    if(!designator) {</b>
<i>132</i>&nbsp;                        throw new SchemaDateTimeException();
<b class="nc"><i>133</i>&nbsp;                    } else {</b>
<b class="nc"><i>134</i>&nbsp;                        return date;</b>
<i>135</i>&nbsp;                    }
<i>136</i>&nbsp;                }
<i>137</i>&nbsp;            }
<b class="nc"><i>138</i>&nbsp;        }</b>
<b class="nc"><i>139</i>&nbsp;    }</b>
<b class="nc"><i>140</i>&nbsp;</b>
<i>141</i>&nbsp;    protected short compareDates(DateTimeData date1, DateTimeData date2, boolean strict) {
<i>142</i>&nbsp;        boolean resultB = true;
<b class="nc"><i>143</i>&nbsp;        short resultA = this.compareOrder(date1, date2);</b>
<b class="nc"><i>144</i>&nbsp;        if(resultA == 0) {</b>
<i>145</i>&nbsp;            return (short)0;
<b class="nc"><i>146</i>&nbsp;        } else {</b>
<i>147</i>&nbsp;            DateTimeData[] result = new DateTimeData[]{new DateTimeData((String)null, this), new DateTimeData((String)null, this)};
<i>148</i>&nbsp;            DateTimeData tempA = this.addDuration(date1, DATETIMES[0], result[0]);
<i>149</i>&nbsp;            DateTimeData tempB = this.addDuration(date2, DATETIMES[0], result[1]);
<i>150</i>&nbsp;            resultA = this.compareOrder(tempA, tempB);
<i>151</i>&nbsp;            if(resultA == 2) {
<b class="nc"><i>152</i>&nbsp;                return (short)2;</b>
<b class="nc"><i>153</i>&nbsp;            } else {</b>
<i>154</i>&nbsp;                tempA = this.addDuration(date1, DATETIMES[1], result[0]);
<b class="nc"><i>155</i>&nbsp;                tempB = this.addDuration(date2, DATETIMES[1], result[1]);</b>
<b class="nc"><i>156</i>&nbsp;                short resultB1 = this.compareOrder(tempA, tempB);</b>
<b class="nc"><i>157</i>&nbsp;                resultA = this.compareResults(resultA, resultB1, strict);</b>
<i>158</i>&nbsp;                if(resultA == 2) {
<i>159</i>&nbsp;                    return (short)2;
<b class="nc"><i>160</i>&nbsp;                } else {</b>
<b class="nc"><i>161</i>&nbsp;                    tempA = this.addDuration(date1, DATETIMES[2], result[0]);</b>
<i>162</i>&nbsp;                    tempB = this.addDuration(date2, DATETIMES[2], result[1]);
<b class="nc"><i>163</i>&nbsp;                    resultB1 = this.compareOrder(tempA, tempB);</b>
<b class="nc"><i>164</i>&nbsp;                    resultA = this.compareResults(resultA, resultB1, strict);</b>
<b class="nc"><i>165</i>&nbsp;                    if(resultA == 2) {</b>
<i>166</i>&nbsp;                        return (short)2;
<i>167</i>&nbsp;                    } else {
<b class="nc"><i>168</i>&nbsp;                        tempA = this.addDuration(date1, DATETIMES[3], result[0]);</b>
<b class="nc"><i>169</i>&nbsp;                        tempB = this.addDuration(date2, DATETIMES[3], result[1]);</b>
<i>170</i>&nbsp;                        resultB1 = this.compareOrder(tempA, tempB);
<b class="nc"><i>171</i>&nbsp;                        resultA = this.compareResults(resultA, resultB1, strict);</b>
<b class="nc"><i>172</i>&nbsp;                        return resultA;</b>
<b class="nc"><i>173</i>&nbsp;                    }</b>
<i>174</i>&nbsp;                }
<i>175</i>&nbsp;            }
<i>176</i>&nbsp;        }
<b class="nc"><i>177</i>&nbsp;    }</b>
<b class="nc"><i>178</i>&nbsp;</b>
<i>179</i>&nbsp;    private short compareResults(short resultA, short resultB, boolean strict) {
<i>180</i>&nbsp;        return resultB == 2?2:(resultA != resultB &amp;&amp; strict?2:(resultA != resultB &amp;&amp; !strict?(resultA != 0 &amp;&amp; resultB != 0?2:(resultA != 0?resultA:resultB)):resultA));
<i>181</i>&nbsp;    }
<b class="nc"><i>182</i>&nbsp;</b>
<b class="nc"><i>183</i>&nbsp;    private DateTimeData addDuration(DateTimeData date, DateTimeData addto, DateTimeData duration) {</b>
<i>184</i>&nbsp;        this.resetDateObj(duration);
<i>185</i>&nbsp;        int temp = addto.month + date.month;
<b class="nc"><i>186</i>&nbsp;        duration.month = this.modulo(temp, 1, 13);</b>
<i>187</i>&nbsp;        int carry = this.fQuotient(temp, 1, 13);
<i>188</i>&nbsp;        duration.year = addto.year + date.year + carry;
<i>189</i>&nbsp;        double dtemp = addto.second + date.second;
<i>190</i>&nbsp;        carry = (int)Math.floor(dtemp / 60.0D);
<i>191</i>&nbsp;        duration.second = dtemp - (double)(carry * 60);
<i>192</i>&nbsp;        temp = addto.minute + date.minute + carry;
<i>193</i>&nbsp;        carry = this.fQuotient(temp, 60);
<i>194</i>&nbsp;        duration.minute = this.mod(temp, 60, carry);
<i>195</i>&nbsp;        temp = addto.hour + date.hour + carry;
<i>196</i>&nbsp;        carry = this.fQuotient(temp, 24);
<i>197</i>&nbsp;        duration.hour = this.mod(temp, 24, carry);
<i>198</i>&nbsp;        duration.day = addto.day + date.day + carry;
<i>199</i>&nbsp;
<i>200</i>&nbsp;        while(true) {
<i>201</i>&nbsp;            temp = this.maxDayInMonthFor(duration.year, duration.month);
<i>202</i>&nbsp;            byte carry1;
<i>203</i>&nbsp;            if(duration.day &lt; 1) {
<i>204</i>&nbsp;                duration.day += this.maxDayInMonthFor(duration.year, duration.month - 1);
<i>205</i>&nbsp;                carry1 = -1;
<i>206</i>&nbsp;            } else {
<i>207</i>&nbsp;                if(duration.day &lt;= temp) {
<i>208</i>&nbsp;                    duration.utc = 90;
<i>209</i>&nbsp;                    return duration;
<b class="nc"><i>210</i>&nbsp;                }</b>
<i>211</i>&nbsp;
<b class="nc"><i>212</i>&nbsp;                duration.day -= temp;</b>
<b class="nc"><i>213</i>&nbsp;                carry1 = 1;</b>
<b class="nc"><i>214</i>&nbsp;            }</b>
<i>215</i>&nbsp;
<i>216</i>&nbsp;            temp = duration.month + carry1;
<b class="nc"><i>217</i>&nbsp;            duration.month = this.modulo(temp, 1, 13);</b>
<b class="nc"><i>218</i>&nbsp;            duration.year += this.fQuotient(temp, 1, 13);</b>
<b class="nc"><i>219</i>&nbsp;        }</b>
<i>220</i>&nbsp;    }
<i>221</i>&nbsp;
<b class="nc"><i>222</i>&nbsp;    protected double parseSecond(String buffer, int start, int end) throws NumberFormatException {</b>
<b class="nc"><i>223</i>&nbsp;        int dot = -1;</b>
<b class="nc"><i>224</i>&nbsp;</b>
<b class="nc"><i>225</i>&nbsp;        for(int value = start; value &lt; end; ++value) {</b>
<b class="nc"><i>226</i>&nbsp;            char ch = buffer.charAt(value);</b>
<i>227</i>&nbsp;            if(ch == 46) {
<i>228</i>&nbsp;                dot = value;
<b class="nc"><i>229</i>&nbsp;            } else if(ch &gt; 57 || ch &lt; 48) {</b>
<b class="nc"><i>230</i>&nbsp;                throw new NumberFormatException(&quot;\&#39;&quot; + buffer + &quot;\&#39; has wrong format&quot;);</b>
<b class="nc"><i>231</i>&nbsp;            }</b>
<b class="nc"><i>232</i>&nbsp;        }</b>
<b class="nc"><i>233</i>&nbsp;</b>
<b class="nc"><i>234</i>&nbsp;        if(dot + 1 == end) {</b>
<i>235</i>&nbsp;            throw new NumberFormatException(&quot;\&#39;&quot; + buffer + &quot;\&#39; has wrong format&quot;);
<i>236</i>&nbsp;        } else {
<b class="nc"><i>237</i>&nbsp;            double var7 = Double.parseDouble(buffer.substring(start, end));</b>
<b class="nc"><i>238</i>&nbsp;            if(var7 == 1.0D / 0.0) {</b>
<b class="nc"><i>239</i>&nbsp;                throw new NumberFormatException(&quot;\&#39;&quot; + buffer + &quot;\&#39; has wrong format&quot;);</b>
<b class="nc"><i>240</i>&nbsp;            } else {</b>
<b class="nc"><i>241</i>&nbsp;                return var7;</b>
<b class="nc"><i>242</i>&nbsp;            }</b>
<i>243</i>&nbsp;        }
<i>244</i>&nbsp;    }
<b class="nc"><i>245</i>&nbsp;</b>
<b class="nc"><i>246</i>&nbsp;    protected String dateToString(DateTimeData date) {</b>
<b class="nc"><i>247</i>&nbsp;        StringBuffer message = new StringBuffer(30);</b>
<b class="nc"><i>248</i>&nbsp;        if(date.year &lt; 0 || date.month &lt; 0 || date.day &lt; 0 || date.hour &lt; 0 || date.minute &lt; 0 || date.second &lt; 0.0D) {</b>
<i>249</i>&nbsp;            message.append(&#39;-&#39;);
<b class="nc"><i>250</i>&nbsp;        }</b>
<i>251</i>&nbsp;
<i>252</i>&nbsp;        message.append(&#39;P&#39;);
<i>253</i>&nbsp;        message.append((date.year &lt; 0?-1:1) * date.year);
<i>254</i>&nbsp;        message.append(&#39;Y&#39;);
<b class="nc"><i>255</i>&nbsp;        message.append((date.month &lt; 0?-1:1) * date.month);</b>
<b class="nc"><i>256</i>&nbsp;        message.append(&#39;M&#39;);</b>
<i>257</i>&nbsp;        message.append((date.day &lt; 0?-1:1) * date.day);
<b class="nc"><i>258</i>&nbsp;        message.append(&#39;D&#39;);</b>
<b class="nc"><i>259</i>&nbsp;        message.append(&#39;T&#39;);</b>
<i>260</i>&nbsp;        message.append((date.hour &lt; 0?-1:1) * date.hour);
<b class="nc"><i>261</i>&nbsp;        message.append(&#39;H&#39;);</b>
<b class="nc"><i>262</i>&nbsp;        message.append((date.minute &lt; 0?-1:1) * date.minute);</b>
<b class="nc"><i>263</i>&nbsp;        message.append(&#39;M&#39;);</b>
<i>264</i>&nbsp;        this.append2(message, (double)(date.second &lt; 0.0D?-1:1) * date.second);
<i>265</i>&nbsp;        message.append(&#39;S&#39;);
<b class="nc"><i>266</i>&nbsp;        return message.toString();</b>
<i>267</i>&nbsp;    }
<i>268</i>&nbsp;
<b class="nc"><i>269</i>&nbsp;    protected Duration getDuration(DateTimeData date) {</b>
<i>270</i>&nbsp;        byte sign = 1;
<i>271</i>&nbsp;        if(date.year &lt; 0 || date.month &lt; 0 || date.day &lt; 0 || date.hour &lt; 0 || date.minute &lt; 0 || date.second &lt; 0.0D) {
<i>272</i>&nbsp;            sign = -1;
<i>273</i>&nbsp;        }
<i>274</i>&nbsp;
<i>275</i>&nbsp;        return datatypeFactory.newDuration(sign == 1, date.year != -2147483648?BigInteger.valueOf((long)(sign * date.year)):null, date.month != -2147483648?BigInteger.valueOf((long)(sign * date.month)):null, date.day != -2147483648?BigInteger.valueOf((long)(sign * date.day)):null, date.hour != -2147483648?BigInteger.valueOf((long)(sign * date.hour)):null, date.minute != -2147483648?BigInteger.valueOf((long)(sign * date.minute)):null, date.second != -2.147483648E9D?new BigDecimal(String.valueOf((double)sign * date.second)):null);
<i>276</i>&nbsp;    }
<i>277</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2014-12-21 15:48</div>
</div>
</body>
</html>
