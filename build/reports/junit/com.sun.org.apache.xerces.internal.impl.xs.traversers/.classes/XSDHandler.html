


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: XSDHandler</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">com.sun.org.apache.xerces.internal.impl.xs.traversers</a> ]
</div>

<h1>Coverage Summary for Class: XSDHandler (com.sun.org.apache.xerces.internal.impl.xs.traversers)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">XSDHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 46)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1063)
  </span>
</td>
</tr>
  <tr>
    <td class="name">XSDHandler$XSAnnotationGrammarPool</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 27)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">XSDHandler$XSDKey</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 16)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 53)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1106)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;//
<i>2</i>&nbsp;// Source code recreated from a .class file by IntelliJ IDEA
<i>3</i>&nbsp;// (powered by Fernflower decompiler)
<i>4</i>&nbsp;//
<i>5</i>&nbsp;
<i>6</i>&nbsp;package com.sun.org.apache.xerces.internal.impl.xs.traversers;
<i>7</i>&nbsp;
<i>8</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.XMLEntityManager;
<i>9</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.XMLErrorReporter;
<i>10</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.dv.SchemaDVFactory;
<i>11</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.dv.xs.XSSimpleTypeDecl;
<i>12</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.SchemaGrammar;
<i>13</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.SchemaNamespaceSupport;
<i>14</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.SchemaSymbols;
<i>15</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaException;
<i>16</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaLoader;
<i>17</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSAttributeDecl;
<i>18</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSAttributeGroupDecl;
<i>19</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSComplexTypeDecl;
<i>20</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSDDescription;
<i>21</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSDeclarationPool;
<i>22</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSElementDecl;
<i>23</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSGrammarBucket;
<i>24</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSGroupDecl;
<i>25</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSModelGroupImpl;
<i>26</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSNotationDecl;
<i>27</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.XSParticleDecl;
<i>28</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.SchemaGrammar.Schema4Annotations;
<i>29</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.identity.IdentityConstraint;
<i>30</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.opti.ElementImpl;
<i>31</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.opti.SchemaDOM;
<i>32</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.opti.SchemaDOMParser;
<i>33</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.opti.SchemaParsingConfig;
<i>34</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.SchemaContentHandler;
<i>35</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.StAXSchemaParser;
<i>36</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSAnnotationInfo;
<i>37</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSAttributeChecker;
<i>38</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDAttributeGroupTraverser;
<i>39</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDAttributeTraverser;
<i>40</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDComplexTypeTraverser;
<i>41</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDElementTraverser;
<i>42</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDGroupTraverser;
<i>43</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDKeyrefTraverser;
<i>44</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDNotationTraverser;
<i>45</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDSimpleTypeTraverser;
<i>46</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDUniqueOrKeyTraverser;
<i>47</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDWildcardTraverser;
<i>48</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.traversers.XSDocumentInfo;
<i>49</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.util.SimpleLocator;
<i>50</i>&nbsp;import com.sun.org.apache.xerces.internal.impl.xs.util.XSInputSource;
<i>51</i>&nbsp;import com.sun.org.apache.xerces.internal.parsers.SAXParser;
<i>52</i>&nbsp;import com.sun.org.apache.xerces.internal.parsers.XML11Configuration;
<i>53</i>&nbsp;import com.sun.org.apache.xerces.internal.util.DOMInputSource;
<i>54</i>&nbsp;import com.sun.org.apache.xerces.internal.util.DOMUtil;
<i>55</i>&nbsp;import com.sun.org.apache.xerces.internal.util.DefaultErrorHandler;
<i>56</i>&nbsp;import com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper;
<i>57</i>&nbsp;import com.sun.org.apache.xerces.internal.util.SAXInputSource;
<i>58</i>&nbsp;import com.sun.org.apache.xerces.internal.util.StAXInputSource;
<i>59</i>&nbsp;import com.sun.org.apache.xerces.internal.util.StAXLocationWrapper;
<i>60</i>&nbsp;import com.sun.org.apache.xerces.internal.util.SymbolHash;
<i>61</i>&nbsp;import com.sun.org.apache.xerces.internal.util.SymbolTable;
<i>62</i>&nbsp;import com.sun.org.apache.xerces.internal.util.XMLSymbols;
<i>63</i>&nbsp;import com.sun.org.apache.xerces.internal.util.URI.MalformedURIException;
<i>64</i>&nbsp;import com.sun.org.apache.xerces.internal.utils.SecuritySupport;
<i>65</i>&nbsp;import com.sun.org.apache.xerces.internal.utils.XMLSecurityManager;
<i>66</i>&nbsp;import com.sun.org.apache.xerces.internal.utils.XMLSecurityPropertyManager;
<i>67</i>&nbsp;import com.sun.org.apache.xerces.internal.utils.XMLSecurityPropertyManager.Property;
<i>68</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.QName;
<i>69</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.XNIException;
<i>70</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.grammars.Grammar;
<i>71</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.grammars.XMLGrammarDescription;
<i>72</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.grammars.XMLGrammarPool;
<i>73</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.grammars.XMLSchemaDescription;
<i>74</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.parser.XMLComponentManager;
<i>75</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException;
<i>76</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.parser.XMLEntityResolver;
<i>77</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.parser.XMLErrorHandler;
<i>78</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.parser.XMLInputSource;
<i>79</i>&nbsp;import com.sun.org.apache.xerces.internal.xni.parser.XMLParseException;
<i>80</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.StringList;
<i>81</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSAttributeDeclaration;
<i>82</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSAttributeGroupDefinition;
<i>83</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSAttributeUse;
<i>84</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSElementDeclaration;
<i>85</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSModelGroup;
<i>86</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSModelGroupDefinition;
<i>87</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSNamedMap;
<i>88</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSObject;
<i>89</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSObjectList;
<i>90</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSParticle;
<i>91</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSSimpleTypeDefinition;
<i>92</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSTerm;
<i>93</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.XSTypeDefinition;
<i>94</i>&nbsp;import com.sun.org.apache.xerces.internal.xs.datatypes.ObjectList;
<i>95</i>&nbsp;import java.io.IOException;
<i>96</i>&nbsp;import java.io.StringReader;
<i>97</i>&nbsp;import java.util.ArrayList;
<i>98</i>&nbsp;import java.util.HashMap;
<i>99</i>&nbsp;import java.util.Hashtable;
<i>100</i>&nbsp;import java.util.Iterator;
<i>101</i>&nbsp;import java.util.Locale;
<i>102</i>&nbsp;import java.util.Map;
<i>103</i>&nbsp;import java.util.Stack;
<i>104</i>&nbsp;import java.util.Vector;
<i>105</i>&nbsp;import java.util.Map.Entry;
<i>106</i>&nbsp;import javax.xml.stream.XMLEventReader;
<i>107</i>&nbsp;import javax.xml.stream.XMLStreamException;
<i>108</i>&nbsp;import javax.xml.stream.XMLStreamReader;
<i>109</i>&nbsp;import org.w3c.dom.Document;
<i>110</i>&nbsp;import org.w3c.dom.Element;
<i>111</i>&nbsp;import org.w3c.dom.Node;
<i>112</i>&nbsp;import org.xml.sax.ContentHandler;
<i>113</i>&nbsp;import org.xml.sax.ErrorHandler;
<i>114</i>&nbsp;import org.xml.sax.InputSource;
<i>115</i>&nbsp;import org.xml.sax.SAXException;
<i>116</i>&nbsp;import org.xml.sax.SAXNotRecognizedException;
<i>117</i>&nbsp;import org.xml.sax.SAXParseException;
<i>118</i>&nbsp;import org.xml.sax.XMLReader;
<i>119</i>&nbsp;import org.xml.sax.helpers.XMLReaderFactory;
<i>120</i>&nbsp;
<i>121</i>&nbsp;public class XSDHandler {
<i>122</i>&nbsp;    protected static final String VALIDATION = &quot;http://xml.org/sax/features/validation&quot;;
<i>123</i>&nbsp;    protected static final String XMLSCHEMA_VALIDATION = &quot;http://apache.org/xml/features/validation/schema&quot;;
<i>124</i>&nbsp;    protected static final String ALLOW_JAVA_ENCODINGS = &quot;http://apache.org/xml/features/allow-java-encodings&quot;;
<i>125</i>&nbsp;    protected static final String CONTINUE_AFTER_FATAL_ERROR = &quot;http://apache.org/xml/features/continue-after-fatal-error&quot;;
<i>126</i>&nbsp;    protected static final String STANDARD_URI_CONFORMANT_FEATURE = &quot;http://apache.org/xml/features/standard-uri-conformant&quot;;
<i>127</i>&nbsp;    protected static final String DISALLOW_DOCTYPE = &quot;http://apache.org/xml/features/disallow-doctype-decl&quot;;
<i>128</i>&nbsp;    protected static final String GENERATE_SYNTHETIC_ANNOTATIONS = &quot;http://apache.org/xml/features/generate-synthetic-annotations&quot;;
<i>129</i>&nbsp;    protected static final String VALIDATE_ANNOTATIONS = &quot;http://apache.org/xml/features/validate-annotations&quot;;
<i>130</i>&nbsp;    protected static final String HONOUR_ALL_SCHEMALOCATIONS = &quot;http://apache.org/xml/features/honour-all-schemaLocations&quot;;
<i>131</i>&nbsp;    protected static final String NAMESPACE_GROWTH = &quot;http://apache.org/xml/features/namespace-growth&quot;;
<i>132</i>&nbsp;    protected static final String TOLERATE_DUPLICATES = &quot;http://apache.org/xml/features/internal/tolerate-duplicates&quot;;
<i>133</i>&nbsp;    private static final String NAMESPACE_PREFIXES = &quot;http://xml.org/sax/features/namespace-prefixes&quot;;
<i>134</i>&nbsp;    protected static final String STRING_INTERNING = &quot;http://xml.org/sax/features/string-interning&quot;;
<i>135</i>&nbsp;    protected static final String ERROR_HANDLER = &quot;http://apache.org/xml/properties/internal/error-handler&quot;;
<i>136</i>&nbsp;    protected static final String JAXP_SCHEMA_SOURCE = &quot;http://java.sun.com/xml/jaxp/properties/schemaSource&quot;;
<i>137</i>&nbsp;    public static final String ENTITY_RESOLVER = &quot;http://apache.org/xml/properties/internal/entity-resolver&quot;;
<i>138</i>&nbsp;    protected static final String ENTITY_MANAGER = &quot;http://apache.org/xml/properties/internal/entity-manager&quot;;
<i>139</i>&nbsp;    public static final String ERROR_REPORTER = &quot;http://apache.org/xml/properties/internal/error-reporter&quot;;
<i>140</i>&nbsp;    public static final String XMLGRAMMAR_POOL = &quot;http://apache.org/xml/properties/internal/grammar-pool&quot;;
<i>141</i>&nbsp;    public static final String SYMBOL_TABLE = &quot;http://apache.org/xml/properties/internal/symbol-table&quot;;
<i>142</i>&nbsp;    protected static final String SECURITY_MANAGER = &quot;http://apache.org/xml/properties/security-manager&quot;;
<i>143</i>&nbsp;    private static final String SECURE_PROCESSING = &quot;http://apache.org/xml/properties/security-manager&quot;;
<i>144</i>&nbsp;    protected static final String LOCALE = &quot;http://apache.org/xml/properties/locale&quot;;
<i>145</i>&nbsp;    private static final String XML_SECURITY_PROPERTY_MANAGER = &quot;http://www.oracle.com/xml/jaxp/properties/xmlSecurityPropertyManager&quot;;
<i>146</i>&nbsp;    protected static final boolean DEBUG_NODE_POOL = false;
<i>147</i>&nbsp;    static final int ATTRIBUTE_TYPE = 1;
<i>148</i>&nbsp;    static final int ATTRIBUTEGROUP_TYPE = 2;
<i>149</i>&nbsp;    static final int ELEMENT_TYPE = 3;
<i>150</i>&nbsp;    static final int GROUP_TYPE = 4;
<i>151</i>&nbsp;    static final int IDENTITYCONSTRAINT_TYPE = 5;
<i>152</i>&nbsp;    static final int NOTATION_TYPE = 6;
<i>153</i>&nbsp;    static final int TYPEDECL_TYPE = 7;
<i>154</i>&nbsp;    public static final String REDEF_IDENTIFIER = &quot;_fn3dktizrknc9pi&quot;;
<i>155</i>&nbsp;    protected XSDeclarationPool fDeclPool;
<i>156</i>&nbsp;    protected XMLSecurityManager fSecureProcessing;
<i>157</i>&nbsp;    private String fAccessExternalSchema;
<i>158</i>&nbsp;    private String fAccessExternalDTD;
<i>159</i>&nbsp;    private boolean registryEmpty;
<i>160</i>&nbsp;    private Map&lt;String, Element&gt; fUnparsedAttributeRegistry;
<i>161</i>&nbsp;    private Map&lt;String, Element&gt; fUnparsedAttributeGroupRegistry;
<i>162</i>&nbsp;    private Map&lt;String, Element&gt; fUnparsedElementRegistry;
<i>163</i>&nbsp;    private Map&lt;String, Element&gt; fUnparsedGroupRegistry;
<i>164</i>&nbsp;    private Map&lt;String, Element&gt; fUnparsedIdentityConstraintRegistry;
<i>165</i>&nbsp;    private Map&lt;String, Element&gt; fUnparsedNotationRegistry;
<i>166</i>&nbsp;    private Map&lt;String, Element&gt; fUnparsedTypeRegistry;
<i>167</i>&nbsp;    private Map&lt;String, XSDocumentInfo&gt; fUnparsedAttributeRegistrySub;
<i>168</i>&nbsp;    private Map&lt;String, XSDocumentInfo&gt; fUnparsedAttributeGroupRegistrySub;
<i>169</i>&nbsp;    private Map&lt;String, XSDocumentInfo&gt; fUnparsedElementRegistrySub;
<i>170</i>&nbsp;    private Map&lt;String, XSDocumentInfo&gt; fUnparsedGroupRegistrySub;
<i>171</i>&nbsp;    private Map&lt;String, XSDocumentInfo&gt; fUnparsedIdentityConstraintRegistrySub;
<i>172</i>&nbsp;    private Map&lt;String, XSDocumentInfo&gt; fUnparsedNotationRegistrySub;
<i>173</i>&nbsp;    private Map&lt;String, XSDocumentInfo&gt; fUnparsedTypeRegistrySub;
<i>174</i>&nbsp;    private Map[] fUnparsedRegistriesExt;
<i>175</i>&nbsp;    private Map&lt;XSDocumentInfo, Vector&gt; fDependencyMap;
<i>176</i>&nbsp;    private Map&lt;String, Vector&gt; fImportMap;
<i>177</i>&nbsp;    private Vector fAllTNSs;
<i>178</i>&nbsp;    private Map fLocationPairs;
<i>179</i>&nbsp;    private static final Map EMPTY_TABLE = new HashMap();
<i>180</i>&nbsp;    Hashtable fHiddenNodes;
<i>181</i>&nbsp;    private Map fTraversed;
<i>182</i>&nbsp;    private Map fDoc2SystemId;
<i>183</i>&nbsp;    private XSDocumentInfo fRoot;
<i>184</i>&nbsp;    private Map fDoc2XSDocumentMap;
<i>185</i>&nbsp;    private Map fRedefine2XSDMap;
<i>186</i>&nbsp;    private Map fRedefine2NSSupport;
<i>187</i>&nbsp;    private Map fRedefinedRestrictedAttributeGroupRegistry;
<i>188</i>&nbsp;    private Map fRedefinedRestrictedGroupRegistry;
<i>189</i>&nbsp;    private boolean fLastSchemaWasDuplicate;
<i>190</i>&nbsp;    private boolean fValidateAnnotations;
<i>191</i>&nbsp;    private boolean fHonourAllSchemaLocations;
<i>192</i>&nbsp;    boolean fNamespaceGrowth;
<i>193</i>&nbsp;    boolean fTolerateDuplicates;
<i>194</i>&nbsp;    private XMLErrorReporter fErrorReporter;
<b class="nc"><i>195</i>&nbsp;    private XMLEntityResolver fEntityResolver;</b>
<i>196</i>&nbsp;    private XSAttributeChecker fAttributeChecker;
<b class="nc"><i>197</i>&nbsp;    private SymbolTable fSymbolTable;</b>
<i>198</i>&nbsp;    private XSGrammarBucket fGrammarBucket;
<i>199</i>&nbsp;    private XSDDescription fSchemaGrammarDescription;
<i>200</i>&nbsp;    private XMLGrammarPool fGrammarPool;
<i>201</i>&nbsp;    XSDAttributeGroupTraverser fAttributeGroupTraverser;
<i>202</i>&nbsp;    XSDAttributeTraverser fAttributeTraverser;
<i>203</i>&nbsp;    XSDComplexTypeTraverser fComplexTypeTraverser;
<b class="nc"><i>204</i>&nbsp;    XSDElementTraverser fElementTraverser;</b>
<i>205</i>&nbsp;    XSDGroupTraverser fGroupTraverser;
<i>206</i>&nbsp;    XSDKeyrefTraverser fKeyrefTraverser;
<i>207</i>&nbsp;    XSDNotationTraverser fNotationTraverser;
<i>208</i>&nbsp;    XSDSimpleTypeTraverser fSimpleTypeTraverser;
<i>209</i>&nbsp;    XSDUniqueOrKeyTraverser fUniqueOrKeyTraverser;
<i>210</i>&nbsp;    XSDWildcardTraverser fWildCardTraverser;
<i>211</i>&nbsp;    SchemaDVFactory fDVFactory;
<i>212</i>&nbsp;    SchemaDOMParser fSchemaParser;
<i>213</i>&nbsp;    SchemaContentHandler fXSContentHandler;
<b class="nc"><i>214</i>&nbsp;    StAXSchemaParser fStAXSchemaParser;</b>
<b class="nc"><i>215</i>&nbsp;    XML11Configuration fAnnotationValidator;</b>
<b class="nc"><i>216</i>&nbsp;    XSDHandler.XSAnnotationGrammarPool fGrammarBucketAdapter;</b>
<b class="nc"><i>217</i>&nbsp;    private static final int INIT_STACK_SIZE = 30;</b>
<b class="nc"><i>218</i>&nbsp;    private static final int INC_STACK_SIZE = 10;</b>
<b class="nc"><i>219</i>&nbsp;    private int fLocalElemStackPos;</b>
<b class="nc"><i>220</i>&nbsp;    private XSParticleDecl[] fParticle;</b>
<i>221</i>&nbsp;    private Element[] fLocalElementDecl;
<i>222</i>&nbsp;    private XSDocumentInfo[] fLocalElementDecl_schema;
<i>223</i>&nbsp;    private int[] fAllContext;
<b class="nc"><i>224</i>&nbsp;    private XSObject[] fParent;</b>
<b class="nc"><i>225</i>&nbsp;    private String[][] fLocalElemNamespaceContext;</b>
<b class="nc"><i>226</i>&nbsp;    private static final int INIT_KEYREF_STACK = 2;</b>
<b class="nc"><i>227</i>&nbsp;    private static final int INC_KEYREF_STACK_AMOUNT = 2;</b>
<b class="nc"><i>228</i>&nbsp;    private int fKeyrefStackPos;</b>
<b class="nc"><i>229</i>&nbsp;    private Element[] fKeyrefs;</b>
<b class="nc"><i>230</i>&nbsp;    private XSDocumentInfo[] fKeyrefsMapXSDocumentInfo;</b>
<i>231</i>&nbsp;    private XSElementDecl[] fKeyrefElems;
<i>232</i>&nbsp;    private String[][] fKeyrefNamespaceContext;
<i>233</i>&nbsp;    SymbolHash fGlobalAttrDecls;
<i>234</i>&nbsp;    SymbolHash fGlobalAttrGrpDecls;
<i>235</i>&nbsp;    SymbolHash fGlobalElemDecls;
<i>236</i>&nbsp;    SymbolHash fGlobalGroupDecls;
<i>237</i>&nbsp;    SymbolHash fGlobalNotationDecls;
<b class="nc"><i>238</i>&nbsp;    SymbolHash fGlobalIDConstraintDecls;</b>
<i>239</i>&nbsp;    SymbolHash fGlobalTypeDecls;
<i>240</i>&nbsp;    private static final String[][] NS_ERROR_CODES = new String[][]{{&quot;src-include.2.1&quot;, &quot;src-include.2.1&quot;}, {&quot;src-redefine.3.1&quot;, &quot;src-redefine.3.1&quot;}, {&quot;src-import.3.1&quot;, &quot;src-import.3.2&quot;}, null, {&quot;TargetNamespace.1&quot;, &quot;TargetNamespace.2&quot;}, {&quot;TargetNamespace.1&quot;, &quot;TargetNamespace.2&quot;}, {&quot;TargetNamespace.1&quot;, &quot;TargetNamespace.2&quot;}, {&quot;TargetNamespace.1&quot;, &quot;TargetNamespace.2&quot;}};
<i>241</i>&nbsp;    private static final String[] ELE_ERROR_CODES = new String[]{&quot;src-include.1&quot;, &quot;src-redefine.2&quot;, &quot;src-import.2&quot;, &quot;schema_reference.4&quot;, &quot;schema_reference.4&quot;, &quot;schema_reference.4&quot;, &quot;schema_reference.4&quot;, &quot;schema_reference.4&quot;};
<i>242</i>&nbsp;    private Vector fReportedTNS;
<b class="nc"><i>243</i>&nbsp;    private static final String[] COMP_TYPE = new String[]{null, &quot;attribute declaration&quot;, &quot;attribute group&quot;, &quot;element declaration&quot;, &quot;group&quot;, &quot;identity constraint&quot;, &quot;notation&quot;, &quot;type definition&quot;};</b>
<i>244</i>&nbsp;    private static final String[] CIRCULAR_CODES = new String[]{&quot;Internal-Error&quot;, &quot;Internal-Error&quot;, &quot;src-attribute_group.3&quot;, &quot;e-props-correct.6&quot;, &quot;mg-props-correct.2&quot;, &quot;Internal-Error&quot;, &quot;Internal-Error&quot;, &quot;st-props-correct.2&quot;};
<i>245</i>&nbsp;    private SimpleLocator xl;
<i>246</i>&nbsp;
<i>247</i>&nbsp;    private String null2EmptyString(String ns) {
<i>248</i>&nbsp;        return ns == null?XMLSymbols.EMPTY_STRING:ns;
<b class="nc"><i>249</i>&nbsp;    }</b>
<i>250</i>&nbsp;
<i>251</i>&nbsp;    private String emptyString2Null(String ns) {
<i>252</i>&nbsp;        return ns == XMLSymbols.EMPTY_STRING?null:ns;
<b class="nc"><i>253</i>&nbsp;    }</b>
<i>254</i>&nbsp;
<b class="nc"><i>255</i>&nbsp;    private String doc2SystemId(Element ele) {</b>
<i>256</i>&nbsp;        String documentURI = null;
<i>257</i>&nbsp;        if(ele.getOwnerDocument() instanceof SchemaDOM) {
<i>258</i>&nbsp;            documentURI = ((SchemaDOM)ele.getOwnerDocument()).getDocumentURI();
<b class="nc"><i>259</i>&nbsp;        }</b>
<i>260</i>&nbsp;
<i>261</i>&nbsp;        return documentURI != null?documentURI:(String)this.fDoc2SystemId.get(ele);
<i>262</i>&nbsp;    }
<b class="nc"><i>263</i>&nbsp;</b>
<i>264</i>&nbsp;    public XSDHandler() {
<i>265</i>&nbsp;        this.fDeclPool = null;
<b class="nc"><i>266</i>&nbsp;        this.fSecureProcessing = null;</b>
<i>267</i>&nbsp;        this.registryEmpty = true;
<i>268</i>&nbsp;        this.fUnparsedAttributeRegistry = new HashMap();
<i>269</i>&nbsp;        this.fUnparsedAttributeGroupRegistry = new HashMap();
<b class="nc"><i>270</i>&nbsp;        this.fUnparsedElementRegistry = new HashMap();</b>
<i>271</i>&nbsp;        this.fUnparsedGroupRegistry = new HashMap();
<i>272</i>&nbsp;        this.fUnparsedIdentityConstraintRegistry = new HashMap();
<i>273</i>&nbsp;        this.fUnparsedNotationRegistry = new HashMap();
<b class="nc"><i>274</i>&nbsp;        this.fUnparsedTypeRegistry = new HashMap();</b>
<b class="nc"><i>275</i>&nbsp;        this.fUnparsedAttributeRegistrySub = new HashMap();</b>
<i>276</i>&nbsp;        this.fUnparsedAttributeGroupRegistrySub = new HashMap();
<b class="nc"><i>277</i>&nbsp;        this.fUnparsedElementRegistrySub = new HashMap();</b>
<i>278</i>&nbsp;        this.fUnparsedGroupRegistrySub = new HashMap();
<i>279</i>&nbsp;        this.fUnparsedIdentityConstraintRegistrySub = new HashMap();
<i>280</i>&nbsp;        this.fUnparsedNotationRegistrySub = new HashMap();
<i>281</i>&nbsp;        this.fUnparsedTypeRegistrySub = new HashMap();
<i>282</i>&nbsp;        this.fUnparsedRegistriesExt = new HashMap[]{null, null, null, null, null, null, null, null};
<i>283</i>&nbsp;        this.fDependencyMap = new HashMap();
<i>284</i>&nbsp;        this.fImportMap = new HashMap();
<b class="nc"><i>285</i>&nbsp;        this.fAllTNSs = new Vector();</b>
<i>286</i>&nbsp;        this.fLocationPairs = null;
<i>287</i>&nbsp;        this.fHiddenNodes = null;
<i>288</i>&nbsp;        this.fTraversed = new HashMap();
<b class="nc"><i>289</i>&nbsp;        this.fDoc2SystemId = new HashMap();</b>
<i>290</i>&nbsp;        this.fRoot = null;
<i>291</i>&nbsp;        this.fDoc2XSDocumentMap = new HashMap();
<b class="nc"><i>292</i>&nbsp;        this.fRedefine2XSDMap = null;</b>
<i>293</i>&nbsp;        this.fRedefine2NSSupport = null;
<i>294</i>&nbsp;        this.fRedefinedRestrictedAttributeGroupRegistry = new HashMap();
<i>295</i>&nbsp;        this.fRedefinedRestrictedGroupRegistry = new HashMap();
<b class="nc"><i>296</i>&nbsp;        this.fValidateAnnotations = false;</b>
<i>297</i>&nbsp;        this.fHonourAllSchemaLocations = false;
<i>298</i>&nbsp;        this.fNamespaceGrowth = false;
<i>299</i>&nbsp;        this.fTolerateDuplicates = false;
<b class="nc"><i>300</i>&nbsp;        this.fLocalElemStackPos = 0;</b>
<i>301</i>&nbsp;        this.fParticle = new XSParticleDecl[30];
<i>302</i>&nbsp;        this.fLocalElementDecl = new Element[30];
<b class="nc"><i>303</i>&nbsp;        this.fLocalElementDecl_schema = new XSDocumentInfo[30];</b>
<i>304</i>&nbsp;        this.fAllContext = new int[30];
<i>305</i>&nbsp;        this.fParent = new XSObject[30];
<i>306</i>&nbsp;        this.fLocalElemNamespaceContext = new String[30][1];
<i>307</i>&nbsp;        this.fKeyrefStackPos = 0;
<i>308</i>&nbsp;        this.fKeyrefs = new Element[2];
<i>309</i>&nbsp;        this.fKeyrefsMapXSDocumentInfo = new XSDocumentInfo[2];
<b class="nc"><i>310</i>&nbsp;        this.fKeyrefElems = new XSElementDecl[2];</b>
<b class="nc"><i>311</i>&nbsp;        this.fKeyrefNamespaceContext = new String[2][1];</b>
<i>312</i>&nbsp;        this.fGlobalAttrDecls = new SymbolHash();
<i>313</i>&nbsp;        this.fGlobalAttrGrpDecls = new SymbolHash();
<i>314</i>&nbsp;        this.fGlobalElemDecls = new SymbolHash();
<i>315</i>&nbsp;        this.fGlobalGroupDecls = new SymbolHash();
<i>316</i>&nbsp;        this.fGlobalNotationDecls = new SymbolHash();
<i>317</i>&nbsp;        this.fGlobalIDConstraintDecls = new SymbolHash();
<b class="nc"><i>318</i>&nbsp;        this.fGlobalTypeDecls = new SymbolHash();</b>
<i>319</i>&nbsp;        this.fReportedTNS = null;
<i>320</i>&nbsp;        this.xl = new SimpleLocator();
<b class="nc"><i>321</i>&nbsp;        this.fHiddenNodes = new Hashtable();</b>
<i>322</i>&nbsp;        this.fSchemaParser = new SchemaDOMParser(new SchemaParsingConfig());
<i>323</i>&nbsp;    }
<i>324</i>&nbsp;
<i>325</i>&nbsp;    public XSDHandler(XSGrammarBucket gBucket) {
<i>326</i>&nbsp;        this();
<i>327</i>&nbsp;        this.fGrammarBucket = gBucket;
<i>328</i>&nbsp;        this.fSchemaGrammarDescription = new XSDDescription();
<i>329</i>&nbsp;    }
<i>330</i>&nbsp;
<i>331</i>&nbsp;    public SchemaGrammar parseSchema(XMLInputSource is, XSDDescription desc, Map locationPairs) throws IOException {
<i>332</i>&nbsp;        this.fLocationPairs = locationPairs;
<i>333</i>&nbsp;        this.fSchemaParser.resetNodePool();
<i>334</i>&nbsp;        SchemaGrammar grammar = null;
<i>335</i>&nbsp;        String schemaNamespace = null;
<i>336</i>&nbsp;        short referType = desc.getContextType();
<i>337</i>&nbsp;        if(referType != 3) {
<i>338</i>&nbsp;            if(this.fHonourAllSchemaLocations &amp;&amp; referType == 2 &amp;&amp; this.isExistingGrammar(desc, this.fNamespaceGrowth)) {
<i>339</i>&nbsp;                grammar = this.fGrammarBucket.getGrammar(desc.getTargetNamespace());
<i>340</i>&nbsp;            } else {
<i>341</i>&nbsp;                grammar = this.findGrammar(desc, this.fNamespaceGrowth);
<i>342</i>&nbsp;            }
<i>343</i>&nbsp;
<i>344</i>&nbsp;            if(grammar != null) {
<i>345</i>&nbsp;                if(!this.fNamespaceGrowth) {
<i>346</i>&nbsp;                    return grammar;
<i>347</i>&nbsp;                }
<i>348</i>&nbsp;
<i>349</i>&nbsp;                try {
<i>350</i>&nbsp;                    if(grammar.getDocumentLocations().contains(XMLEntityManager.expandSystemId(is.getSystemId(), is.getBaseSystemId(), false))) {
<i>351</i>&nbsp;                        return grammar;
<i>352</i>&nbsp;                    }
<i>353</i>&nbsp;                } catch (MalformedURIException var16) {
<i>354</i>&nbsp;                    ;
<i>355</i>&nbsp;                }
<i>356</i>&nbsp;            }
<i>357</i>&nbsp;
<i>358</i>&nbsp;            schemaNamespace = desc.getTargetNamespace();
<i>359</i>&nbsp;            if(schemaNamespace != null) {
<i>360</i>&nbsp;                schemaNamespace = this.fSymbolTable.addSymbol(schemaNamespace);
<i>361</i>&nbsp;            }
<i>362</i>&nbsp;        }
<i>363</i>&nbsp;
<i>364</i>&nbsp;        this.prepareForParse();
<i>365</i>&nbsp;        Element schemaRoot = null;
<i>366</i>&nbsp;        if(is instanceof DOMInputSource) {
<b class="nc"><i>367</i>&nbsp;            schemaRoot = this.getSchemaDocument(schemaNamespace, (DOMInputSource)((DOMInputSource)is), referType == 3, referType, (Element)null);</b>
<i>368</i>&nbsp;        } else if(is instanceof SAXInputSource) {
<b class="nc"><i>369</i>&nbsp;            schemaRoot = this.getSchemaDocument(schemaNamespace, (SAXInputSource)((SAXInputSource)is), referType == 3, referType, (Element)null);</b>
<b class="nc"><i>370</i>&nbsp;        } else if(is instanceof StAXInputSource) {</b>
<b class="nc"><i>371</i>&nbsp;            schemaRoot = this.getSchemaDocument(schemaNamespace, (StAXInputSource)((StAXInputSource)is), referType == 3, referType, (Element)null);</b>
<b class="nc"><i>372</i>&nbsp;        } else if(is instanceof XSInputSource) {</b>
<b class="nc"><i>373</i>&nbsp;            schemaRoot = this.getSchemaDocument((XSInputSource)is, desc);</b>
<b class="nc"><i>374</i>&nbsp;        } else {</b>
<i>375</i>&nbsp;            schemaRoot = this.getSchemaDocument(schemaNamespace, (XMLInputSource)is, referType == 3, referType, (Element)null);
<i>376</i>&nbsp;        }
<i>377</i>&nbsp;
<i>378</i>&nbsp;        if(schemaRoot == null) {
<i>379</i>&nbsp;            return is instanceof XSInputSource?this.fGrammarBucket.getGrammar(desc.getTargetNamespace()):grammar;
<i>380</i>&nbsp;        } else {
<i>381</i>&nbsp;            if(referType == 3) {
<i>382</i>&nbsp;                schemaNamespace = DOMUtil.getAttrValue(schemaRoot, SchemaSymbols.ATT_TARGETNAMESPACE);
<i>383</i>&nbsp;                if(schemaNamespace != null &amp;&amp; schemaNamespace.length() &gt; 0) {
<b class="nc"><i>384</i>&nbsp;                    schemaNamespace = this.fSymbolTable.addSymbol(schemaNamespace);</b>
<i>385</i>&nbsp;                    desc.setTargetNamespace(schemaNamespace);
<b class="nc"><i>386</i>&nbsp;                } else {</b>
<b class="nc"><i>387</i>&nbsp;                    schemaNamespace = null;</b>
<b class="nc"><i>388</i>&nbsp;                }</b>
<b class="nc"><i>389</i>&nbsp;</b>
<i>390</i>&nbsp;                grammar = this.findGrammar(desc, this.fNamespaceGrowth);
<i>391</i>&nbsp;                String i = XMLEntityManager.expandSystemId(is.getSystemId(), is.getBaseSystemId(), false);
<b class="nc"><i>392</i>&nbsp;                if(grammar != null &amp;&amp; (!this.fNamespaceGrowth || i != null &amp;&amp; grammar.getDocumentLocations().contains(i))) {</b>
<b class="nc"><i>393</i>&nbsp;                    return grammar;</b>
<b class="nc"><i>394</i>&nbsp;                }</b>
<i>395</i>&nbsp;
<i>396</i>&nbsp;                XSDHandler.XSDKey tns = new XSDHandler.XSDKey(i, referType, schemaNamespace);
<i>397</i>&nbsp;                this.fTraversed.put(tns, schemaRoot);
<i>398</i>&nbsp;                if(i != null) {
<i>399</i>&nbsp;                    this.fDoc2SystemId.put(schemaRoot, i);
<i>400</i>&nbsp;                }
<b class="nc"><i>401</i>&nbsp;            }</b>
<b class="nc"><i>402</i>&nbsp;</b>
<i>403</i>&nbsp;            this.prepareForTraverse();
<i>404</i>&nbsp;            this.fRoot = this.constructTrees(schemaRoot, is.getSystemId(), desc, grammar != null);
<i>405</i>&nbsp;            if(this.fRoot == null) {
<i>406</i>&nbsp;                return null;
<b class="nc"><i>407</i>&nbsp;            } else {</b>
<i>408</i>&nbsp;                this.buildGlobalNameRegistries();
<i>409</i>&nbsp;                ArrayList annotationInfo = this.fValidateAnnotations?new ArrayList():null;
<i>410</i>&nbsp;                this.traverseSchemas(annotationInfo);
<i>411</i>&nbsp;                this.traverseLocalElements();
<i>412</i>&nbsp;                this.resolveKeyRefs();
<i>413</i>&nbsp;
<i>414</i>&nbsp;                for(int var17 = this.fAllTNSs.size() - 1; var17 &gt;= 0; --var17) {
<i>415</i>&nbsp;                    String var18 = (String)this.fAllTNSs.elementAt(var17);
<i>416</i>&nbsp;                    Vector ins = (Vector)this.fImportMap.get(var18);
<i>417</i>&nbsp;                    SchemaGrammar sg = this.fGrammarBucket.getGrammar(this.emptyString2Null(var18));
<i>418</i>&nbsp;                    if(sg != null) {
<i>419</i>&nbsp;                        int count = 0;
<i>420</i>&nbsp;
<i>421</i>&nbsp;                        for(int j = 0; j &lt; ins.size(); ++j) {
<i>422</i>&nbsp;                            SchemaGrammar isg = this.fGrammarBucket.getGrammar((String)ins.elementAt(j));
<i>423</i>&nbsp;                            if(isg != null) {
<b class="nc"><i>424</i>&nbsp;                                ins.setElementAt(isg, count++);</b>
<b class="nc"><i>425</i>&nbsp;                            }</b>
<b class="nc"><i>426</i>&nbsp;                        }</b>
<b class="nc"><i>427</i>&nbsp;</b>
<b class="nc"><i>428</i>&nbsp;                        ins.setSize(count);</b>
<i>429</i>&nbsp;                        sg.setImportedGrammars(ins);
<i>430</i>&nbsp;                    }
<i>431</i>&nbsp;                }
<i>432</i>&nbsp;
<i>433</i>&nbsp;                if(this.fValidateAnnotations &amp;&amp; annotationInfo.size() &gt; 0) {
<i>434</i>&nbsp;                    this.validateAnnotations(annotationInfo);
<b class="nc"><i>435</i>&nbsp;                }</b>
<i>436</i>&nbsp;
<b class="nc"><i>437</i>&nbsp;                return this.fGrammarBucket.getGrammar(this.fRoot.fTargetNamespace);</b>
<b class="nc"><i>438</i>&nbsp;            }</b>
<i>439</i>&nbsp;        }
<i>440</i>&nbsp;    }
<b class="nc"><i>441</i>&nbsp;</b>
<i>442</i>&nbsp;    private void validateAnnotations(ArrayList annotationInfo) {
<b class="nc"><i>443</i>&nbsp;        if(this.fAnnotationValidator == null) {</b>
<b class="nc"><i>444</i>&nbsp;            this.createAnnotationValidator();</b>
<b class="nc"><i>445</i>&nbsp;        }</b>
<i>446</i>&nbsp;
<b class="nc"><i>447</i>&nbsp;        int size = annotationInfo.size();</b>
<b class="nc"><i>448</i>&nbsp;        XMLInputSource src = new XMLInputSource((String)null, (String)null, (String)null);</b>
<i>449</i>&nbsp;        this.fGrammarBucketAdapter.refreshGrammars(this.fGrammarBucket);
<i>450</i>&nbsp;
<i>451</i>&nbsp;        for(int i = 0; i &lt; size; i += 2) {
<i>452</i>&nbsp;            src.setSystemId((String)annotationInfo.get(i));
<i>453</i>&nbsp;
<b class="nc"><i>454</i>&nbsp;            for(XSAnnotationInfo annotation = (XSAnnotationInfo)annotationInfo.get(i + 1); annotation != null; annotation = annotation.next) {</b>
<i>455</i>&nbsp;                src.setCharacterStream(new StringReader(annotation.fAnnotation));
<b class="nc"><i>456</i>&nbsp;</b>
<b class="nc"><i>457</i>&nbsp;                try {</b>
<i>458</i>&nbsp;                    this.fAnnotationValidator.parse(src);
<b class="nc"><i>459</i>&nbsp;                } catch (IOException var7) {</b>
<i>460</i>&nbsp;                    ;
<b class="nc"><i>461</i>&nbsp;                }</b>
<b class="nc"><i>462</i>&nbsp;            }</b>
<i>463</i>&nbsp;        }
<b class="nc"><i>464</i>&nbsp;</b>
<b class="nc"><i>465</i>&nbsp;    }</b>
<b class="nc"><i>466</i>&nbsp;</b>
<i>467</i>&nbsp;    private void createAnnotationValidator() {
<b class="nc"><i>468</i>&nbsp;        this.fAnnotationValidator = new XML11Configuration();</b>
<b class="nc"><i>469</i>&nbsp;        this.fGrammarBucketAdapter = new XSDHandler.XSAnnotationGrammarPool();</b>
<i>470</i>&nbsp;        this.fAnnotationValidator.setFeature(&quot;http://xml.org/sax/features/validation&quot;, true);
<i>471</i>&nbsp;        this.fAnnotationValidator.setFeature(&quot;http://apache.org/xml/features/validation/schema&quot;, true);
<b class="nc"><i>472</i>&nbsp;        this.fAnnotationValidator.setProperty(&quot;http://apache.org/xml/properties/internal/grammar-pool&quot;, this.fGrammarBucketAdapter);</b>
<i>473</i>&nbsp;        XMLErrorHandler errorHandler = this.fErrorReporter.getErrorHandler();
<b class="nc"><i>474</i>&nbsp;        this.fAnnotationValidator.setProperty(&quot;http://apache.org/xml/properties/internal/error-handler&quot;, errorHandler != null?errorHandler:new DefaultErrorHandler());</b>
<b class="nc"><i>475</i>&nbsp;        Locale locale = this.fErrorReporter.getLocale();</b>
<b class="nc"><i>476</i>&nbsp;        this.fAnnotationValidator.setProperty(&quot;http://apache.org/xml/properties/locale&quot;, locale);</b>
<b class="nc"><i>477</i>&nbsp;    }</b>
<b class="nc"><i>478</i>&nbsp;</b>
<b class="nc"><i>479</i>&nbsp;    SchemaGrammar getGrammar(String tns) {</b>
<i>480</i>&nbsp;        return this.fGrammarBucket.getGrammar(tns);
<b class="nc"><i>481</i>&nbsp;    }</b>
<i>482</i>&nbsp;
<b class="nc"><i>483</i>&nbsp;    protected SchemaGrammar findGrammar(XSDDescription desc, boolean ignoreConflict) {</b>
<i>484</i>&nbsp;        SchemaGrammar sg = this.fGrammarBucket.getGrammar(desc.getTargetNamespace());
<i>485</i>&nbsp;        if(sg == null &amp;&amp; this.fGrammarPool != null) {
<i>486</i>&nbsp;            sg = (SchemaGrammar)this.fGrammarPool.retrieveGrammar(desc);
<b class="nc"><i>487</i>&nbsp;            if(sg != null &amp;&amp; !this.fGrammarBucket.putGrammar(sg, true, ignoreConflict)) {</b>
<i>488</i>&nbsp;                this.reportSchemaWarning(&quot;GrammarConflict&quot;, (Object[])null, (Element)null);
<i>489</i>&nbsp;                sg = null;
<i>490</i>&nbsp;            }
<b class="nc"><i>491</i>&nbsp;        }</b>
<b class="nc"><i>492</i>&nbsp;</b>
<b class="nc"><i>493</i>&nbsp;        return sg;</b>
<i>494</i>&nbsp;    }
<b class="nc"><i>495</i>&nbsp;</b>
<b class="nc"><i>496</i>&nbsp;    protected XSDocumentInfo constructTrees(Element schemaRoot, String locationHint, XSDDescription desc, boolean nsCollision) {</b>
<i>497</i>&nbsp;        if(schemaRoot == null) {
<b class="nc"><i>498</i>&nbsp;            return null;</b>
<i>499</i>&nbsp;        } else {
<i>500</i>&nbsp;            String callerTNS = desc.getTargetNamespace();
<i>501</i>&nbsp;            short referType = desc.getContextType();
<b class="nc"><i>502</i>&nbsp;            XSDocumentInfo currSchemaInfo = null;</b>
<i>503</i>&nbsp;
<b class="nc"><i>504</i>&nbsp;            try {</b>
<i>505</i>&nbsp;                currSchemaInfo = new XSDocumentInfo(schemaRoot, this.fAttributeChecker, this.fSymbolTable);
<b class="nc"><i>506</i>&nbsp;            } catch (XMLSchemaException var25) {</b>
<i>507</i>&nbsp;                this.reportSchemaError(ELE_ERROR_CODES[referType], new Object[]{locationHint}, schemaRoot);
<i>508</i>&nbsp;                return null;
<b class="nc"><i>509</i>&nbsp;            }</b>
<b class="nc"><i>510</i>&nbsp;</b>
<b class="nc"><i>511</i>&nbsp;            if(currSchemaInfo.fTargetNamespace != null &amp;&amp; currSchemaInfo.fTargetNamespace.length() == 0) {</b>
<i>512</i>&nbsp;                this.reportSchemaWarning(&quot;EmptyTargetNamespace&quot;, new Object[]{locationHint}, schemaRoot);
<b class="nc"><i>513</i>&nbsp;                currSchemaInfo.fTargetNamespace = null;</b>
<i>514</i>&nbsp;            }
<b class="nc"><i>515</i>&nbsp;</b>
<b class="nc"><i>516</i>&nbsp;            byte sg;</b>
<i>517</i>&nbsp;            if(callerTNS != null) {
<b class="nc"><i>518</i>&nbsp;                sg = 0;</b>
<i>519</i>&nbsp;                if(referType != 0 &amp;&amp; referType != 1) {
<b class="nc"><i>520</i>&nbsp;                    if(referType != 3 &amp;&amp; callerTNS != currSchemaInfo.fTargetNamespace) {</b>
<b class="nc"><i>521</i>&nbsp;                        this.reportSchemaError(NS_ERROR_CODES[referType][sg], new Object[]{callerTNS, currSchemaInfo.fTargetNamespace}, schemaRoot);</b>
<b class="nc"><i>522</i>&nbsp;                        return null;</b>
<b class="nc"><i>523</i>&nbsp;                    }</b>
<b class="nc"><i>524</i>&nbsp;                } else if(currSchemaInfo.fTargetNamespace == null) {</b>
<i>525</i>&nbsp;                    currSchemaInfo.fTargetNamespace = callerTNS;
<b class="nc"><i>526</i>&nbsp;                    currSchemaInfo.fIsChameleonSchema = true;</b>
<i>527</i>&nbsp;                } else if(callerTNS != currSchemaInfo.fTargetNamespace) {
<b class="nc"><i>528</i>&nbsp;                    this.reportSchemaError(NS_ERROR_CODES[referType][sg], new Object[]{callerTNS, currSchemaInfo.fTargetNamespace}, schemaRoot);</b>
<b class="nc"><i>529</i>&nbsp;                    return null;</b>
<i>530</i>&nbsp;                }
<b class="nc"><i>531</i>&nbsp;            } else if(currSchemaInfo.fTargetNamespace != null) {</b>
<i>532</i>&nbsp;                if(referType != 3) {
<i>533</i>&nbsp;                    sg = 1;
<i>534</i>&nbsp;                    this.reportSchemaError(NS_ERROR_CODES[referType][sg], new Object[]{callerTNS, currSchemaInfo.fTargetNamespace}, schemaRoot);
<i>535</i>&nbsp;                    return null;
<i>536</i>&nbsp;                }
<b class="nc"><i>537</i>&nbsp;</b>
<i>538</i>&nbsp;                desc.setTargetNamespace(currSchemaInfo.fTargetNamespace);
<b class="nc"><i>539</i>&nbsp;                callerTNS = currSchemaInfo.fTargetNamespace;</b>
<i>540</i>&nbsp;            }
<i>541</i>&nbsp;
<b class="nc"><i>542</i>&nbsp;            currSchemaInfo.addAllowedNS(currSchemaInfo.fTargetNamespace);</b>
<b class="nc"><i>543</i>&nbsp;            SchemaGrammar sg1 = null;</b>
<b class="nc"><i>544</i>&nbsp;            if(nsCollision) {</b>
<b class="nc"><i>545</i>&nbsp;                SchemaGrammar dependencies = this.fGrammarBucket.getGrammar(currSchemaInfo.fTargetNamespace);</b>
<i>546</i>&nbsp;                if(dependencies.isImmutable()) {
<i>547</i>&nbsp;                    sg1 = new SchemaGrammar(dependencies);
<b class="nc"><i>548</i>&nbsp;                    this.fGrammarBucket.putGrammar(sg1);</b>
<b class="nc"><i>549</i>&nbsp;                    this.updateImportListWith(sg1);</b>
<i>550</i>&nbsp;                } else {
<i>551</i>&nbsp;                    sg1 = dependencies;
<b class="nc"><i>552</i>&nbsp;                }</b>
<i>553</i>&nbsp;
<b class="nc"><i>554</i>&nbsp;                this.updateImportListFor(sg1);</b>
<b class="nc"><i>555</i>&nbsp;            } else if(referType != 0 &amp;&amp; referType != 1) {</b>
<b class="nc"><i>556</i>&nbsp;                if(this.fHonourAllSchemaLocations &amp;&amp; referType == 2) {</b>
<b class="nc"><i>557</i>&nbsp;                    sg1 = this.findGrammar(desc, false);</b>
<b class="nc"><i>558</i>&nbsp;                    if(sg1 == null) {</b>
<b class="nc"><i>559</i>&nbsp;                        sg1 = new SchemaGrammar(currSchemaInfo.fTargetNamespace, desc.makeClone(), this.fSymbolTable);</b>
<b class="nc"><i>560</i>&nbsp;                        this.fGrammarBucket.putGrammar(sg1);</b>
<b class="nc"><i>561</i>&nbsp;                    }</b>
<i>562</i>&nbsp;                } else {
<i>563</i>&nbsp;                    sg1 = new SchemaGrammar(currSchemaInfo.fTargetNamespace, desc.makeClone(), this.fSymbolTable);
<i>564</i>&nbsp;                    this.fGrammarBucket.putGrammar(sg1);
<i>565</i>&nbsp;                }
<i>566</i>&nbsp;            } else {
<b class="nc"><i>567</i>&nbsp;                sg1 = this.fGrammarBucket.getGrammar(currSchemaInfo.fTargetNamespace);</b>
<i>568</i>&nbsp;            }
<b class="nc"><i>569</i>&nbsp;</b>
<b class="nc"><i>570</i>&nbsp;            sg1.addDocument((Object)null, (String)this.fDoc2SystemId.get(currSchemaInfo.fSchemaElement));</b>
<b class="nc"><i>571</i>&nbsp;            this.fDoc2XSDocumentMap.put(schemaRoot, currSchemaInfo);</b>
<i>572</i>&nbsp;            Vector dependencies1 = new Vector();
<i>573</i>&nbsp;            Element newSchemaRoot = null;
<i>574</i>&nbsp;
<b class="nc"><i>575</i>&nbsp;            for(Element child = DOMUtil.getFirstChildElement(schemaRoot); child != null; child = DOMUtil.getNextSiblingElement(child)) {</b>
<i>576</i>&nbsp;                String schemaNamespace = null;
<i>577</i>&nbsp;                String schemaHint = null;
<b class="nc"><i>578</i>&nbsp;                String localName = DOMUtil.getLocalName(child);</b>
<b class="nc"><i>579</i>&nbsp;                boolean refType = true;</b>
<i>580</i>&nbsp;                boolean importCollision = false;
<i>581</i>&nbsp;                if(!localName.equals(SchemaSymbols.ELT_ANNOTATION)) {
<b class="nc"><i>582</i>&nbsp;                    Element mustResolve;</b>
<i>583</i>&nbsp;                    Object[] newSchemaInfo;
<i>584</i>&nbsp;                    String alreadyTraversed;
<b class="nc"><i>585</i>&nbsp;                    if(localName.equals(SchemaSymbols.ELT_IMPORT)) {</b>
<i>586</i>&nbsp;                        refType = true;
<i>587</i>&nbsp;                        newSchemaInfo = this.fAttributeChecker.checkAttributes(child, true, currSchemaInfo);
<i>588</i>&nbsp;                        schemaHint = (String)newSchemaInfo[XSAttributeChecker.ATTIDX_SCHEMALOCATION];
<i>589</i>&nbsp;                        schemaNamespace = (String)newSchemaInfo[XSAttributeChecker.ATTIDX_NAMESPACE];
<i>590</i>&nbsp;                        if(schemaNamespace != null) {
<i>591</i>&nbsp;                            schemaNamespace = this.fSymbolTable.addSymbol(schemaNamespace);
<i>592</i>&nbsp;                        }
<b class="nc"><i>593</i>&nbsp;</b>
<i>594</i>&nbsp;                        mustResolve = DOMUtil.getFirstChildElement(child);
<b class="nc"><i>595</i>&nbsp;                        if(mustResolve != null) {</b>
<i>596</i>&nbsp;                            alreadyTraversed = DOMUtil.getLocalName(mustResolve);
<b class="nc"><i>597</i>&nbsp;                            if(alreadyTraversed.equals(SchemaSymbols.ELT_ANNOTATION)) {</b>
<i>598</i>&nbsp;                                sg1.addAnnotation(this.fElementTraverser.traverseAnnotationDecl(mustResolve, newSchemaInfo, true, currSchemaInfo));
<b class="nc"><i>599</i>&nbsp;                            } else {</b>
<b class="nc"><i>600</i>&nbsp;                                this.reportSchemaError(&quot;s4s-elt-must-match.1&quot;, new Object[]{localName, &quot;annotation?&quot;, alreadyTraversed}, child);</b>
<b class="nc"><i>601</i>&nbsp;                            }</b>
<i>602</i>&nbsp;
<i>603</i>&nbsp;                            if(DOMUtil.getNextSiblingElement(mustResolve) != null) {
<b class="nc"><i>604</i>&nbsp;                                this.reportSchemaError(&quot;s4s-elt-must-match.1&quot;, new Object[]{localName, &quot;annotation?&quot;, DOMUtil.getLocalName(DOMUtil.getNextSiblingElement(mustResolve))}, child);</b>
<b class="nc"><i>605</i>&nbsp;                            }</b>
<i>606</i>&nbsp;                        } else {
<b class="nc"><i>607</i>&nbsp;                            alreadyTraversed = DOMUtil.getSyntheticAnnotation(child);</b>
<i>608</i>&nbsp;                            if(alreadyTraversed != null) {
<b class="nc"><i>609</i>&nbsp;                                sg1.addAnnotation(this.fElementTraverser.traverseSyntheticAnnotation(child, alreadyTraversed, newSchemaInfo, true, currSchemaInfo));</b>
<b class="nc"><i>610</i>&nbsp;                            }</b>
<i>611</i>&nbsp;                        }
<b class="nc"><i>612</i>&nbsp;</b>
<i>613</i>&nbsp;                        this.fAttributeChecker.returnAttrArray(newSchemaInfo, currSchemaInfo);
<b class="nc"><i>614</i>&nbsp;                        if(schemaNamespace == currSchemaInfo.fTargetNamespace) {</b>
<i>615</i>&nbsp;                            this.reportSchemaError(schemaNamespace != null?&quot;src-import.1.1&quot;:&quot;src-import.1.2&quot;, new Object[]{schemaNamespace}, child);
<i>616</i>&nbsp;                            continue;
<i>617</i>&nbsp;                        }
<b class="nc"><i>618</i>&nbsp;</b>
<b class="nc"><i>619</i>&nbsp;                        if(currSchemaInfo.isAllowedNS(schemaNamespace)) {</b>
<i>620</i>&nbsp;                            if(!this.fHonourAllSchemaLocations &amp;&amp; !this.fNamespaceGrowth) {
<i>621</i>&nbsp;                                continue;
<i>622</i>&nbsp;                            }
<b class="nc"><i>623</i>&nbsp;                        } else {</b>
<i>624</i>&nbsp;                            currSchemaInfo.addAllowedNS(schemaNamespace);
<i>625</i>&nbsp;                        }
<i>626</i>&nbsp;
<b class="nc"><i>627</i>&nbsp;                        alreadyTraversed = this.null2EmptyString(currSchemaInfo.fTargetNamespace);</b>
<b class="nc"><i>628</i>&nbsp;                        Vector schemaSource = (Vector)this.fImportMap.get(alreadyTraversed);</b>
<i>629</i>&nbsp;                        if(schemaSource == null) {
<b class="nc"><i>630</i>&nbsp;                            this.fAllTNSs.addElement(alreadyTraversed);</b>
<b class="nc"><i>631</i>&nbsp;                            schemaSource = new Vector();</b>
<b class="nc"><i>632</i>&nbsp;                            this.fImportMap.put(alreadyTraversed, schemaSource);</b>
<b class="nc"><i>633</i>&nbsp;                            schemaSource.addElement(schemaNamespace);</b>
<b class="nc"><i>634</i>&nbsp;                        } else if(!schemaSource.contains(schemaNamespace)) {</b>
<b class="nc"><i>635</i>&nbsp;                            schemaSource.addElement(schemaNamespace);</b>
<b class="nc"><i>636</i>&nbsp;                        }</b>
<b class="nc"><i>637</i>&nbsp;</b>
<i>638</i>&nbsp;                        this.fSchemaGrammarDescription.reset();
<b class="nc"><i>639</i>&nbsp;                        this.fSchemaGrammarDescription.setContextType((short)2);</b>
<i>640</i>&nbsp;                        this.fSchemaGrammarDescription.setBaseSystemId(this.doc2SystemId(schemaRoot));
<b class="nc"><i>641</i>&nbsp;                        this.fSchemaGrammarDescription.setLiteralSystemId(schemaHint);</b>
<b class="nc"><i>642</i>&nbsp;                        this.fSchemaGrammarDescription.setLocationHints(new String[]{schemaHint});</b>
<i>643</i>&nbsp;                        this.fSchemaGrammarDescription.setTargetNamespace(schemaNamespace);
<i>644</i>&nbsp;                        SchemaGrammar e = this.findGrammar(this.fSchemaGrammarDescription, this.fNamespaceGrowth);
<i>645</i>&nbsp;                        if(e != null) {
<i>646</i>&nbsp;                            if(this.fNamespaceGrowth) {
<i>647</i>&nbsp;                                try {
<b class="nc"><i>648</i>&nbsp;                                    if(e.getDocumentLocations().contains(XMLEntityManager.expandSystemId(schemaHint, this.fSchemaGrammarDescription.getBaseSystemId(), false))) {</b>
<b class="nc"><i>649</i>&nbsp;                                        continue;</b>
<b class="nc"><i>650</i>&nbsp;                                    }</b>
<b class="nc"><i>651</i>&nbsp;</b>
<b class="nc"><i>652</i>&nbsp;                                    importCollision = true;</b>
<i>653</i>&nbsp;                                } catch (MalformedURIException var26) {
<b class="nc"><i>654</i>&nbsp;                                    ;</b>
<b class="nc"><i>655</i>&nbsp;                                }</b>
<i>656</i>&nbsp;                            } else if(!this.fHonourAllSchemaLocations || this.isExistingGrammar(this.fSchemaGrammarDescription, false)) {
<i>657</i>&nbsp;                                continue;
<i>658</i>&nbsp;                            }
<i>659</i>&nbsp;                        }
<i>660</i>&nbsp;
<i>661</i>&nbsp;                        newSchemaRoot = this.resolveSchema(this.fSchemaGrammarDescription, false, child, e == null);
<i>662</i>&nbsp;                    } else {
<b class="nc"><i>663</i>&nbsp;                        if(!localName.equals(SchemaSymbols.ELT_INCLUDE) &amp;&amp; !localName.equals(SchemaSymbols.ELT_REDEFINE)) {</b>
<i>664</i>&nbsp;                            break;
<i>665</i>&nbsp;                        }
<i>666</i>&nbsp;
<i>667</i>&nbsp;                        newSchemaInfo = this.fAttributeChecker.checkAttributes(child, true, currSchemaInfo);
<i>668</i>&nbsp;                        schemaHint = (String)newSchemaInfo[XSAttributeChecker.ATTIDX_SCHEMALOCATION];
<i>669</i>&nbsp;                        if(localName.equals(SchemaSymbols.ELT_REDEFINE)) {
<i>670</i>&nbsp;                            if(this.fRedefine2NSSupport == null) {
<i>671</i>&nbsp;                                this.fRedefine2NSSupport = new HashMap();
<b class="nc"><i>672</i>&nbsp;                            }</b>
<b class="nc"><i>673</i>&nbsp;</b>
<b class="nc"><i>674</i>&nbsp;                            this.fRedefine2NSSupport.put(child, new SchemaNamespaceSupport(currSchemaInfo.fNamespaceSupport));</b>
<b class="nc"><i>675</i>&nbsp;                        }</b>
<b class="nc"><i>676</i>&nbsp;</b>
<i>677</i>&nbsp;                        if(localName.equals(SchemaSymbols.ELT_INCLUDE)) {
<i>678</i>&nbsp;                            mustResolve = DOMUtil.getFirstChildElement(child);
<b class="nc"><i>679</i>&nbsp;                            if(mustResolve != null) {</b>
<i>680</i>&nbsp;                                alreadyTraversed = DOMUtil.getLocalName(mustResolve);
<i>681</i>&nbsp;                                if(alreadyTraversed.equals(SchemaSymbols.ELT_ANNOTATION)) {
<b class="nc"><i>682</i>&nbsp;                                    sg1.addAnnotation(this.fElementTraverser.traverseAnnotationDecl(mustResolve, newSchemaInfo, true, currSchemaInfo));</b>
<b class="nc"><i>683</i>&nbsp;                                } else {</b>
<i>684</i>&nbsp;                                    this.reportSchemaError(&quot;s4s-elt-must-match.1&quot;, new Object[]{localName, &quot;annotation?&quot;, alreadyTraversed}, child);
<i>685</i>&nbsp;                                }
<i>686</i>&nbsp;
<i>687</i>&nbsp;                                if(DOMUtil.getNextSiblingElement(mustResolve) != null) {
<b class="nc"><i>688</i>&nbsp;                                    this.reportSchemaError(&quot;s4s-elt-must-match.1&quot;, new Object[]{localName, &quot;annotation?&quot;, DOMUtil.getLocalName(DOMUtil.getNextSiblingElement(mustResolve))}, child);</b>
<i>689</i>&nbsp;                                }
<i>690</i>&nbsp;                            } else {
<i>691</i>&nbsp;                                alreadyTraversed = DOMUtil.getSyntheticAnnotation(child);
<i>692</i>&nbsp;                                if(alreadyTraversed != null) {
<i>693</i>&nbsp;                                    sg1.addAnnotation(this.fElementTraverser.traverseSyntheticAnnotation(child, alreadyTraversed, newSchemaInfo, true, currSchemaInfo));
<b class="nc"><i>694</i>&nbsp;                                }</b>
<i>695</i>&nbsp;                            }
<i>696</i>&nbsp;                        } else {
<i>697</i>&nbsp;                            for(mustResolve = DOMUtil.getFirstChildElement(child); mustResolve != null; mustResolve = DOMUtil.getNextSiblingElement(mustResolve)) {
<i>698</i>&nbsp;                                alreadyTraversed = DOMUtil.getLocalName(mustResolve);
<i>699</i>&nbsp;                                if(alreadyTraversed.equals(SchemaSymbols.ELT_ANNOTATION)) {
<i>700</i>&nbsp;                                    sg1.addAnnotation(this.fElementTraverser.traverseAnnotationDecl(mustResolve, newSchemaInfo, true, currSchemaInfo));
<i>701</i>&nbsp;                                    DOMUtil.setHidden(mustResolve, this.fHiddenNodes);
<i>702</i>&nbsp;                                } else {
<i>703</i>&nbsp;                                    String schemaSource1 = DOMUtil.getSyntheticAnnotation(child);
<i>704</i>&nbsp;                                    if(schemaSource1 != null) {
<b class="nc"><i>705</i>&nbsp;                                        sg1.addAnnotation(this.fElementTraverser.traverseSyntheticAnnotation(child, schemaSource1, newSchemaInfo, true, currSchemaInfo));</b>
<i>706</i>&nbsp;                                    }
<i>707</i>&nbsp;                                }
<i>708</i>&nbsp;                            }
<i>709</i>&nbsp;                        }
<i>710</i>&nbsp;
<i>711</i>&nbsp;                        this.fAttributeChecker.returnAttrArray(newSchemaInfo, currSchemaInfo);
<i>712</i>&nbsp;                        if(schemaHint == null) {
<i>713</i>&nbsp;                            this.reportSchemaError(&quot;s4s-att-must-appear&quot;, new Object[]{&quot;&lt;include&gt; or &lt;redefine&gt;&quot;, &quot;schemaLocation&quot;}, child);
<i>714</i>&nbsp;                        }
<i>715</i>&nbsp;
<i>716</i>&nbsp;                        boolean mustResolve1 = false;
<i>717</i>&nbsp;                        byte refType1 = 0;
<i>718</i>&nbsp;                        if(localName.equals(SchemaSymbols.ELT_REDEFINE)) {
<i>719</i>&nbsp;                            mustResolve1 = this.nonAnnotationContent(child);
<i>720</i>&nbsp;                            refType1 = 1;
<b class="nc"><i>721</i>&nbsp;                        }</b>
<b class="nc"><i>722</i>&nbsp;</b>
<b class="nc"><i>723</i>&nbsp;                        this.fSchemaGrammarDescription.reset();</b>
<i>724</i>&nbsp;                        this.fSchemaGrammarDescription.setContextType(refType1);
<b class="nc"><i>725</i>&nbsp;                        this.fSchemaGrammarDescription.setBaseSystemId(this.doc2SystemId(schemaRoot));</b>
<i>726</i>&nbsp;                        this.fSchemaGrammarDescription.setLocationHints(new String[]{schemaHint});
<i>727</i>&nbsp;                        this.fSchemaGrammarDescription.setTargetNamespace(callerTNS);
<b class="nc"><i>728</i>&nbsp;                        boolean alreadyTraversed1 = false;</b>
<b class="nc"><i>729</i>&nbsp;                        XMLInputSource schemaSource2 = this.resolveSchemaSource(this.fSchemaGrammarDescription, mustResolve1, child, true);</b>
<b class="nc"><i>730</i>&nbsp;                        if(this.fNamespaceGrowth &amp;&amp; refType1 == 0) {</b>
<i>731</i>&nbsp;                            try {
<i>732</i>&nbsp;                                String e1 = XMLEntityManager.expandSystemId(schemaSource2.getSystemId(), schemaSource2.getBaseSystemId(), false);
<b class="nc"><i>733</i>&nbsp;                                alreadyTraversed1 = sg1.getDocumentLocations().contains(e1);</b>
<b class="nc"><i>734</i>&nbsp;                            } catch (MalformedURIException var24) {</b>
<i>735</i>&nbsp;                                ;
<b class="nc"><i>736</i>&nbsp;                            }</b>
<i>737</i>&nbsp;                        }
<b class="nc"><i>738</i>&nbsp;</b>
<i>739</i>&nbsp;                        if(!alreadyTraversed1) {
<i>740</i>&nbsp;                            newSchemaRoot = this.resolveSchema(schemaSource2, this.fSchemaGrammarDescription, mustResolve1, child);
<b class="nc"><i>741</i>&nbsp;                            schemaNamespace = currSchemaInfo.fTargetNamespace;</b>
<i>742</i>&nbsp;                        } else {
<i>743</i>&nbsp;                            this.fLastSchemaWasDuplicate = true;
<b class="nc"><i>744</i>&nbsp;                        }</b>
<i>745</i>&nbsp;                    }
<i>746</i>&nbsp;
<b class="nc"><i>747</i>&nbsp;                    newSchemaInfo = null;</b>
<i>748</i>&nbsp;                    XSDocumentInfo newSchemaInfo1;
<b class="nc"><i>749</i>&nbsp;                    if(this.fLastSchemaWasDuplicate) {</b>
<i>750</i>&nbsp;                        newSchemaInfo1 = newSchemaRoot == null?null:(XSDocumentInfo)this.fDoc2XSDocumentMap.get(newSchemaRoot);
<i>751</i>&nbsp;                    } else {
<i>752</i>&nbsp;                        newSchemaInfo1 = this.constructTrees(newSchemaRoot, schemaHint, this.fSchemaGrammarDescription, importCollision);
<b class="nc"><i>753</i>&nbsp;                    }</b>
<b class="nc"><i>754</i>&nbsp;</b>
<b class="nc"><i>755</i>&nbsp;                    if(localName.equals(SchemaSymbols.ELT_REDEFINE) &amp;&amp; newSchemaInfo1 != null) {</b>
<i>756</i>&nbsp;                        if(this.fRedefine2XSDMap == null) {
<i>757</i>&nbsp;                            this.fRedefine2XSDMap = new HashMap();
<i>758</i>&nbsp;                        }
<b class="nc"><i>759</i>&nbsp;</b>
<b class="nc"><i>760</i>&nbsp;                        this.fRedefine2XSDMap.put(child, newSchemaInfo1);</b>
<i>761</i>&nbsp;                    }
<i>762</i>&nbsp;
<b class="nc"><i>763</i>&nbsp;                    if(newSchemaRoot != null) {</b>
<i>764</i>&nbsp;                        if(newSchemaInfo1 != null) {
<i>765</i>&nbsp;                            dependencies1.addElement(newSchemaInfo1);
<i>766</i>&nbsp;                        }
<b class="nc"><i>767</i>&nbsp;</b>
<b class="nc"><i>768</i>&nbsp;                        newSchemaRoot = null;</b>
<i>769</i>&nbsp;                    }
<i>770</i>&nbsp;                }
<b class="nc"><i>771</i>&nbsp;            }</b>
<i>772</i>&nbsp;
<b class="nc"><i>773</i>&nbsp;            this.fDependencyMap.put(currSchemaInfo, dependencies1);</b>
<i>774</i>&nbsp;            return currSchemaInfo;
<i>775</i>&nbsp;        }
<b class="nc"><i>776</i>&nbsp;    }</b>
<i>777</i>&nbsp;
<b class="nc"><i>778</i>&nbsp;    private boolean isExistingGrammar(XSDDescription desc, boolean ignoreConflict) {</b>
<b class="nc"><i>779</i>&nbsp;        SchemaGrammar sg = this.fGrammarBucket.getGrammar(desc.getTargetNamespace());</b>
<b class="nc"><i>780</i>&nbsp;        if(sg == null) {</b>
<i>781</i>&nbsp;            return this.findGrammar(desc, ignoreConflict) != null;
<i>782</i>&nbsp;        } else if(sg.isImmutable()) {
<i>783</i>&nbsp;            return true;
<i>784</i>&nbsp;        } else {
<b class="nc"><i>785</i>&nbsp;            try {</b>
<b class="nc"><i>786</i>&nbsp;                return sg.getDocumentLocations().contains(XMLEntityManager.expandSystemId(desc.getLiteralSystemId(), desc.getBaseSystemId(), false));</b>
<i>787</i>&nbsp;            } catch (MalformedURIException var5) {
<i>788</i>&nbsp;                return false;
<b class="nc"><i>789</i>&nbsp;            }</b>
<i>790</i>&nbsp;        }
<i>791</i>&nbsp;    }
<i>792</i>&nbsp;
<i>793</i>&nbsp;    private void updateImportListFor(SchemaGrammar grammar) {
<i>794</i>&nbsp;        Vector importedGrammars = grammar.getImportedGrammars();
<i>795</i>&nbsp;        if(importedGrammars != null) {
<b class="nc"><i>796</i>&nbsp;            for(int i = 0; i &lt; importedGrammars.size(); ++i) {</b>
<i>797</i>&nbsp;                SchemaGrammar isg1 = (SchemaGrammar)importedGrammars.elementAt(i);
<b class="nc"><i>798</i>&nbsp;                SchemaGrammar isg2 = this.fGrammarBucket.getGrammar(isg1.getTargetNamespace());</b>
<i>799</i>&nbsp;                if(isg2 != null &amp;&amp; isg1 != isg2) {
<b class="nc"><i>800</i>&nbsp;                    importedGrammars.set(i, isg2);</b>
<i>801</i>&nbsp;                }
<b class="nc"><i>802</i>&nbsp;            }</b>
<i>803</i>&nbsp;        }
<b class="nc"><i>804</i>&nbsp;</b>
<b class="nc"><i>805</i>&nbsp;    }</b>
<b class="nc"><i>806</i>&nbsp;</b>
<b class="nc"><i>807</i>&nbsp;    private void updateImportListWith(SchemaGrammar newGrammar) {</b>
<b class="nc"><i>808</i>&nbsp;        SchemaGrammar[] schemaGrammars = this.fGrammarBucket.getGrammars();</b>
<i>809</i>&nbsp;
<i>810</i>&nbsp;        for(int i = 0; i &lt; schemaGrammars.length; ++i) {
<i>811</i>&nbsp;            SchemaGrammar sg = schemaGrammars[i];
<b class="nc"><i>812</i>&nbsp;            if(sg != newGrammar) {</b>
<b class="nc"><i>813</i>&nbsp;                Vector importedGrammars = sg.getImportedGrammars();</b>
<i>814</i>&nbsp;                if(importedGrammars != null) {
<i>815</i>&nbsp;                    for(int j = 0; j &lt; importedGrammars.size(); ++j) {
<i>816</i>&nbsp;                        SchemaGrammar isg = (SchemaGrammar)importedGrammars.elementAt(j);
<i>817</i>&nbsp;                        if(this.null2EmptyString(isg.getTargetNamespace()).equals(this.null2EmptyString(newGrammar.getTargetNamespace()))) {
<b class="nc"><i>818</i>&nbsp;                            if(isg != newGrammar) {</b>
<i>819</i>&nbsp;                                importedGrammars.set(j, newGrammar);
<b class="nc"><i>820</i>&nbsp;                            }</b>
<b class="nc"><i>821</i>&nbsp;                            break;</b>
<b class="nc"><i>822</i>&nbsp;                        }</b>
<i>823</i>&nbsp;                    }
<b class="nc"><i>824</i>&nbsp;                }</b>
<b class="nc"><i>825</i>&nbsp;            }</b>
<b class="nc"><i>826</i>&nbsp;        }</b>
<b class="nc"><i>827</i>&nbsp;</b>
<b class="nc"><i>828</i>&nbsp;    }</b>
<b class="nc"><i>829</i>&nbsp;</b>
<b class="nc"><i>830</i>&nbsp;    protected void buildGlobalNameRegistries() {</b>
<i>831</i>&nbsp;        this.registryEmpty = false;
<b class="nc"><i>832</i>&nbsp;        Stack schemasToProcess = new Stack();</b>
<i>833</i>&nbsp;        schemasToProcess.push(this.fRoot);
<b class="nc"><i>834</i>&nbsp;</b>
<b class="nc"><i>835</i>&nbsp;        while(!schemasToProcess.empty()) {</b>
<b class="nc"><i>836</i>&nbsp;            XSDocumentInfo currSchemaDoc = (XSDocumentInfo)schemasToProcess.pop();</b>
<b class="nc"><i>837</i>&nbsp;            Element currDoc = currSchemaDoc.fSchemaElement;</b>
<i>838</i>&nbsp;            if(!DOMUtil.isHidden(currDoc, this.fHiddenNodes)) {
<i>839</i>&nbsp;                boolean dependenciesCanOccur = true;
<b class="nc"><i>840</i>&nbsp;</b>
<b class="nc"><i>841</i>&nbsp;                for(Element currSchemaDepends = DOMUtil.getFirstChildElement(currDoc); currSchemaDepends != null; currSchemaDepends = DOMUtil.getNextSiblingElement(currSchemaDepends)) {</b>
<b class="nc"><i>842</i>&nbsp;                    if(!DOMUtil.getLocalName(currSchemaDepends).equals(SchemaSymbols.ELT_ANNOTATION)) {</b>
<b class="nc"><i>843</i>&nbsp;                        if(!DOMUtil.getLocalName(currSchemaDepends).equals(SchemaSymbols.ELT_INCLUDE) &amp;&amp; !DOMUtil.getLocalName(currSchemaDepends).equals(SchemaSymbols.ELT_IMPORT)) {</b>
<b class="nc"><i>844</i>&nbsp;                            String qName;</b>
<i>845</i>&nbsp;                            String componentType;
<b class="nc"><i>846</i>&nbsp;                            if(DOMUtil.getLocalName(currSchemaDepends).equals(SchemaSymbols.ELT_REDEFINE)) {</b>
<b class="nc"><i>847</i>&nbsp;                                if(!dependenciesCanOccur) {</b>
<i>848</i>&nbsp;                                    this.reportSchemaError(&quot;s4s-elt-invalid-content.3&quot;, new Object[]{DOMUtil.getLocalName(currSchemaDepends)}, currSchemaDepends);
<i>849</i>&nbsp;                                }
<i>850</i>&nbsp;
<b class="nc"><i>851</i>&nbsp;                                for(Element var13 = DOMUtil.getFirstChildElement(currSchemaDepends); var13 != null; var13 = DOMUtil.getNextSiblingElement(var13)) {</b>
<b class="nc"><i>852</i>&nbsp;                                    qName = DOMUtil.getAttrValue(var13, SchemaSymbols.ATT_NAME);</b>
<b class="nc"><i>853</i>&nbsp;                                    if(qName.length() != 0) {</b>
<b class="nc"><i>854</i>&nbsp;                                        componentType = currSchemaDoc.fTargetNamespace == null?&quot;,&quot; + qName:currSchemaDoc.fTargetNamespace + &quot;,&quot; + qName;</b>
<i>855</i>&nbsp;                                        String componentType1 = DOMUtil.getLocalName(var13);
<b class="nc"><i>856</i>&nbsp;                                        String targetLName;</b>
<i>857</i>&nbsp;                                        if(componentType1.equals(SchemaSymbols.ELT_ATTRIBUTEGROUP)) {
<i>858</i>&nbsp;                                            this.checkForDuplicateNames(componentType, 2, this.fUnparsedAttributeGroupRegistry, this.fUnparsedAttributeGroupRegistrySub, var13, currSchemaDoc);
<b class="nc"><i>859</i>&nbsp;                                            targetLName = DOMUtil.getAttrValue(var13, SchemaSymbols.ATT_NAME) + &quot;_fn3dktizrknc9pi&quot;;</b>
<i>860</i>&nbsp;                                            this.renameRedefiningComponents(currSchemaDoc, var13, SchemaSymbols.ELT_ATTRIBUTEGROUP, qName, targetLName);
<b class="nc"><i>861</i>&nbsp;                                        } else if(!componentType1.equals(SchemaSymbols.ELT_COMPLEXTYPE) &amp;&amp; !componentType1.equals(SchemaSymbols.ELT_SIMPLETYPE)) {</b>
<b class="nc"><i>862</i>&nbsp;                                            if(componentType1.equals(SchemaSymbols.ELT_GROUP)) {</b>
<i>863</i>&nbsp;                                                this.checkForDuplicateNames(componentType, 4, this.fUnparsedGroupRegistry, this.fUnparsedGroupRegistrySub, var13, currSchemaDoc);
<b class="nc"><i>864</i>&nbsp;                                                targetLName = DOMUtil.getAttrValue(var13, SchemaSymbols.ATT_NAME) + &quot;_fn3dktizrknc9pi&quot;;</b>
<i>865</i>&nbsp;                                                this.renameRedefiningComponents(currSchemaDoc, var13, SchemaSymbols.ELT_GROUP, qName, targetLName);
<b class="nc"><i>866</i>&nbsp;                                            }</b>
<b class="nc"><i>867</i>&nbsp;                                        } else {</b>
<b class="nc"><i>868</i>&nbsp;                                            this.checkForDuplicateNames(componentType, 7, this.fUnparsedTypeRegistry, this.fUnparsedTypeRegistrySub, var13, currSchemaDoc);</b>
<i>869</i>&nbsp;                                            targetLName = DOMUtil.getAttrValue(var13, SchemaSymbols.ATT_NAME) + &quot;_fn3dktizrknc9pi&quot;;
<i>870</i>&nbsp;                                            if(componentType1.equals(SchemaSymbols.ELT_COMPLEXTYPE)) {
<b class="nc"><i>871</i>&nbsp;                                                this.renameRedefiningComponents(currSchemaDoc, var13, SchemaSymbols.ELT_COMPLEXTYPE, qName, targetLName);</b>
<i>872</i>&nbsp;                                            } else {
<i>873</i>&nbsp;                                                this.renameRedefiningComponents(currSchemaDoc, var13, SchemaSymbols.ELT_SIMPLETYPE, qName, targetLName);
<i>874</i>&nbsp;                                            }
<b class="nc"><i>875</i>&nbsp;                                        }</b>
<b class="nc"><i>876</i>&nbsp;                                    }</b>
<b class="nc"><i>877</i>&nbsp;                                }</b>
<i>878</i>&nbsp;                            } else {
<i>879</i>&nbsp;                                dependenciesCanOccur = false;
<b class="nc"><i>880</i>&nbsp;                                String i = DOMUtil.getAttrValue(currSchemaDepends, SchemaSymbols.ATT_NAME);</b>
<i>881</i>&nbsp;                                if(i.length() != 0) {
<i>882</i>&nbsp;                                    qName = currSchemaDoc.fTargetNamespace == null?&quot;,&quot; + i:currSchemaDoc.fTargetNamespace + &quot;,&quot; + i;
<i>883</i>&nbsp;                                    componentType = DOMUtil.getLocalName(currSchemaDepends);
<b class="nc"><i>884</i>&nbsp;                                    if(componentType.equals(SchemaSymbols.ELT_ATTRIBUTE)) {</b>
<i>885</i>&nbsp;                                        this.checkForDuplicateNames(qName, 1, this.fUnparsedAttributeRegistry, this.fUnparsedAttributeRegistrySub, currSchemaDepends, currSchemaDoc);
<b class="nc"><i>886</i>&nbsp;                                    } else if(componentType.equals(SchemaSymbols.ELT_ATTRIBUTEGROUP)) {</b>
<i>887</i>&nbsp;                                        this.checkForDuplicateNames(qName, 2, this.fUnparsedAttributeGroupRegistry, this.fUnparsedAttributeGroupRegistrySub, currSchemaDepends, currSchemaDoc);
<b class="nc"><i>888</i>&nbsp;                                    } else if(!componentType.equals(SchemaSymbols.ELT_COMPLEXTYPE) &amp;&amp; !componentType.equals(SchemaSymbols.ELT_SIMPLETYPE)) {</b>
<i>889</i>&nbsp;                                        if(componentType.equals(SchemaSymbols.ELT_ELEMENT)) {
<b class="nc"><i>890</i>&nbsp;                                            this.checkForDuplicateNames(qName, 3, this.fUnparsedElementRegistry, this.fUnparsedElementRegistrySub, currSchemaDepends, currSchemaDoc);</b>
<b class="nc"><i>891</i>&nbsp;                                        } else if(componentType.equals(SchemaSymbols.ELT_GROUP)) {</b>
<b class="nc"><i>892</i>&nbsp;                                            this.checkForDuplicateNames(qName, 4, this.fUnparsedGroupRegistry, this.fUnparsedGroupRegistrySub, currSchemaDepends, currSchemaDoc);</b>
<b class="nc"><i>893</i>&nbsp;                                        } else if(componentType.equals(SchemaSymbols.ELT_NOTATION)) {</b>
<i>894</i>&nbsp;                                            this.checkForDuplicateNames(qName, 6, this.fUnparsedNotationRegistry, this.fUnparsedNotationRegistrySub, currSchemaDepends, currSchemaDoc);
<b class="nc"><i>895</i>&nbsp;                                        }</b>
<b class="nc"><i>896</i>&nbsp;                                    } else {</b>
<i>897</i>&nbsp;                                        this.checkForDuplicateNames(qName, 7, this.fUnparsedTypeRegistry, this.fUnparsedTypeRegistrySub, currSchemaDepends, currSchemaDoc);
<i>898</i>&nbsp;                                    }
<b class="nc"><i>899</i>&nbsp;                                }</b>
<b class="nc"><i>900</i>&nbsp;                            }</b>
<b class="nc"><i>901</i>&nbsp;                        } else {</b>
<b class="nc"><i>902</i>&nbsp;                            if(!dependenciesCanOccur) {</b>
<b class="nc"><i>903</i>&nbsp;                                this.reportSchemaError(&quot;s4s-elt-invalid-content.3&quot;, new Object[]{DOMUtil.getLocalName(currSchemaDepends)}, currSchemaDepends);</b>
<i>904</i>&nbsp;                            }
<i>905</i>&nbsp;
<i>906</i>&nbsp;                            DOMUtil.setHidden(currSchemaDepends, this.fHiddenNodes);
<b class="nc"><i>907</i>&nbsp;                        }</b>
<b class="nc"><i>908</i>&nbsp;                    }</b>
<b class="nc"><i>909</i>&nbsp;                }</b>
<b class="nc"><i>910</i>&nbsp;</b>
<b class="nc"><i>911</i>&nbsp;                DOMUtil.setHidden(currDoc, this.fHiddenNodes);</b>
<i>912</i>&nbsp;                Vector var12 = (Vector)this.fDependencyMap.get(currSchemaDoc);
<i>913</i>&nbsp;
<i>914</i>&nbsp;                for(int var14 = 0; var14 &lt; var12.size(); ++var14) {
<i>915</i>&nbsp;                    schemasToProcess.push(var12.elementAt(var14));
<b class="nc"><i>916</i>&nbsp;                }</b>
<b class="nc"><i>917</i>&nbsp;            }</b>
<i>918</i>&nbsp;        }
<b class="nc"><i>919</i>&nbsp;</b>
<b class="nc"><i>920</i>&nbsp;    }</b>
<i>921</i>&nbsp;
<i>922</i>&nbsp;    protected void traverseSchemas(ArrayList annotationInfo) {
<i>923</i>&nbsp;        this.setSchemasVisible(this.fRoot);
<i>924</i>&nbsp;        Stack schemasToProcess = new Stack();
<b class="nc"><i>925</i>&nbsp;        schemasToProcess.push(this.fRoot);</b>
<b class="nc"><i>926</i>&nbsp;</b>
<b class="nc"><i>927</i>&nbsp;        while(!schemasToProcess.empty()) {</b>
<b class="nc"><i>928</i>&nbsp;            XSDocumentInfo currSchemaDoc = (XSDocumentInfo)schemasToProcess.pop();</b>
<b class="nc"><i>929</i>&nbsp;            Element currDoc = currSchemaDoc.fSchemaElement;</b>
<i>930</i>&nbsp;            SchemaGrammar currSG = this.fGrammarBucket.getGrammar(currSchemaDoc.fTargetNamespace);
<b class="nc"><i>931</i>&nbsp;            if(!DOMUtil.isHidden(currDoc, this.fHiddenNodes)) {</b>
<i>932</i>&nbsp;                boolean sawAnnotation = false;
<i>933</i>&nbsp;
<b class="nc"><i>934</i>&nbsp;                for(Element currSchemaDepends = DOMUtil.getFirstVisibleChildElement(currDoc, this.fHiddenNodes); currSchemaDepends != null; currSchemaDepends = DOMUtil.getNextVisibleSiblingElement(currSchemaDepends, this.fHiddenNodes)) {</b>
<i>935</i>&nbsp;                    DOMUtil.setHidden(currSchemaDepends, this.fHiddenNodes);
<b class="nc"><i>936</i>&nbsp;                    String i = DOMUtil.getLocalName(currSchemaDepends);</b>
<b class="nc"><i>937</i>&nbsp;                    if(DOMUtil.getLocalName(currSchemaDepends).equals(SchemaSymbols.ELT_REDEFINE)) {</b>
<i>938</i>&nbsp;                        currSchemaDoc.backupNSSupport(this.fRedefine2NSSupport != null?(SchemaNamespaceSupport)this.fRedefine2NSSupport.get(currSchemaDepends):null);
<b class="nc"><i>939</i>&nbsp;</b>
<i>940</i>&nbsp;                        for(Element redefinedComp = DOMUtil.getFirstVisibleChildElement(currSchemaDepends, this.fHiddenNodes); redefinedComp != null; redefinedComp = DOMUtil.getNextVisibleSiblingElement(redefinedComp, this.fHiddenNodes)) {
<b class="nc"><i>941</i>&nbsp;                            String redefinedComponentType = DOMUtil.getLocalName(redefinedComp);</b>
<b class="nc"><i>942</i>&nbsp;                            DOMUtil.setHidden(redefinedComp, this.fHiddenNodes);</b>
<b class="nc"><i>943</i>&nbsp;                            if(redefinedComponentType.equals(SchemaSymbols.ELT_ATTRIBUTEGROUP)) {</b>
<i>944</i>&nbsp;                                this.fAttributeGroupTraverser.traverseGlobal(redefinedComp, currSchemaDoc, currSG);
<i>945</i>&nbsp;                            } else if(redefinedComponentType.equals(SchemaSymbols.ELT_COMPLEXTYPE)) {
<b class="nc"><i>946</i>&nbsp;                                this.fComplexTypeTraverser.traverseGlobal(redefinedComp, currSchemaDoc, currSG);</b>
<i>947</i>&nbsp;                            } else if(redefinedComponentType.equals(SchemaSymbols.ELT_GROUP)) {
<b class="nc"><i>948</i>&nbsp;                                this.fGroupTraverser.traverseGlobal(redefinedComp, currSchemaDoc, currSG);</b>
<b class="nc"><i>949</i>&nbsp;                            } else if(redefinedComponentType.equals(SchemaSymbols.ELT_SIMPLETYPE)) {</b>
<b class="nc"><i>950</i>&nbsp;                                this.fSimpleTypeTraverser.traverseGlobal(redefinedComp, currSchemaDoc, currSG);</b>
<b class="nc"><i>951</i>&nbsp;                            } else {</b>
<b class="nc"><i>952</i>&nbsp;                                this.reportSchemaError(&quot;s4s-elt-must-match.1&quot;, new Object[]{DOMUtil.getLocalName(currSchemaDepends), &quot;(annotation | (simpleType | complexType | group | attributeGroup))*&quot;, redefinedComponentType}, redefinedComp);</b>
<i>953</i>&nbsp;                            }
<b class="nc"><i>954</i>&nbsp;                        }</b>
<i>955</i>&nbsp;
<b class="nc"><i>956</i>&nbsp;                        currSchemaDoc.restoreNSSupport();</b>
<i>957</i>&nbsp;                    } else if(i.equals(SchemaSymbols.ELT_ATTRIBUTE)) {
<i>958</i>&nbsp;                        this.fAttributeTraverser.traverseGlobal(currSchemaDepends, currSchemaDoc, currSG);
<b class="nc"><i>959</i>&nbsp;                    } else if(i.equals(SchemaSymbols.ELT_ATTRIBUTEGROUP)) {</b>
<b class="nc"><i>960</i>&nbsp;                        this.fAttributeGroupTraverser.traverseGlobal(currSchemaDepends, currSchemaDoc, currSG);</b>
<b class="nc"><i>961</i>&nbsp;                    } else if(i.equals(SchemaSymbols.ELT_COMPLEXTYPE)) {</b>
<i>962</i>&nbsp;                        this.fComplexTypeTraverser.traverseGlobal(currSchemaDepends, currSchemaDoc, currSG);
<i>963</i>&nbsp;                    } else if(i.equals(SchemaSymbols.ELT_ELEMENT)) {
<i>964</i>&nbsp;                        this.fElementTraverser.traverseGlobal(currSchemaDepends, currSchemaDoc, currSG);
<i>965</i>&nbsp;                    } else if(i.equals(SchemaSymbols.ELT_GROUP)) {
<i>966</i>&nbsp;                        this.fGroupTraverser.traverseGlobal(currSchemaDepends, currSchemaDoc, currSG);
<b class="nc"><i>967</i>&nbsp;                    } else if(i.equals(SchemaSymbols.ELT_NOTATION)) {</b>
<i>968</i>&nbsp;                        this.fNotationTraverser.traverse(currSchemaDepends, currSchemaDoc, currSG);
<b class="nc"><i>969</i>&nbsp;                    } else if(i.equals(SchemaSymbols.ELT_SIMPLETYPE)) {</b>
<b class="nc"><i>970</i>&nbsp;                        this.fSimpleTypeTraverser.traverseGlobal(currSchemaDepends, currSchemaDoc, currSG);</b>
<i>971</i>&nbsp;                    } else if(i.equals(SchemaSymbols.ELT_ANNOTATION)) {
<i>972</i>&nbsp;                        currSG.addAnnotation(this.fElementTraverser.traverseAnnotationDecl(currSchemaDepends, currSchemaDoc.getSchemaAttrs(), true, currSchemaDoc));
<i>973</i>&nbsp;                        sawAnnotation = true;
<i>974</i>&nbsp;                    } else {
<b class="nc"><i>975</i>&nbsp;                        this.reportSchemaError(&quot;s4s-elt-invalid-content.1&quot;, new Object[]{SchemaSymbols.ELT_SCHEMA, DOMUtil.getLocalName(currSchemaDepends)}, currSchemaDepends);</b>
<b class="nc"><i>976</i>&nbsp;                    }</b>
<b class="nc"><i>977</i>&nbsp;                }</b>
<b class="nc"><i>978</i>&nbsp;</b>
<b class="nc"><i>979</i>&nbsp;                if(!sawAnnotation) {</b>
<i>980</i>&nbsp;                    String var12 = DOMUtil.getSyntheticAnnotation(currDoc);
<b class="nc"><i>981</i>&nbsp;                    if(var12 != null) {</b>
<b class="nc"><i>982</i>&nbsp;                        currSG.addAnnotation(this.fElementTraverser.traverseSyntheticAnnotation(currDoc, var12, currSchemaDoc.getSchemaAttrs(), true, currSchemaDoc));</b>
<b class="nc"><i>983</i>&nbsp;                    }</b>
<b class="nc"><i>984</i>&nbsp;                }</b>
<b class="nc"><i>985</i>&nbsp;</b>
<b class="nc"><i>986</i>&nbsp;                if(annotationInfo != null) {</b>
<b class="nc"><i>987</i>&nbsp;                    XSAnnotationInfo var15 = currSchemaDoc.getAnnotations();</b>
<i>988</i>&nbsp;                    if(var15 != null) {
<i>989</i>&nbsp;                        annotationInfo.add(this.doc2SystemId(currDoc));
<i>990</i>&nbsp;                        annotationInfo.add(var15);
<i>991</i>&nbsp;                    }
<i>992</i>&nbsp;                }
<i>993</i>&nbsp;
<i>994</i>&nbsp;                currSchemaDoc.returnSchemaAttrs();
<i>995</i>&nbsp;                DOMUtil.setHidden(currDoc, this.fHiddenNodes);
<i>996</i>&nbsp;                Vector var14 = (Vector)this.fDependencyMap.get(currSchemaDoc);
<b class="nc"><i>997</i>&nbsp;</b>
<b class="nc"><i>998</i>&nbsp;                for(int var13 = 0; var13 &lt; var14.size(); ++var13) {</b>
<b class="nc"><i>999</i>&nbsp;                    schemasToProcess.push(var14.elementAt(var13));</b>
<i>1000</i>&nbsp;                }
<i>1001</i>&nbsp;            }
<b class="nc"><i>1002</i>&nbsp;        }</b>
<i>1003</i>&nbsp;
<i>1004</i>&nbsp;    }
<b class="nc"><i>1005</i>&nbsp;</b>
<i>1006</i>&nbsp;    private final boolean needReportTNSError(String uri) {
<i>1007</i>&nbsp;        if(this.fReportedTNS == null) {
<i>1008</i>&nbsp;            this.fReportedTNS = new Vector();
<b class="nc"><i>1009</i>&nbsp;        } else if(this.fReportedTNS.contains(uri)) {</b>
<i>1010</i>&nbsp;            return false;
<b class="nc"><i>1011</i>&nbsp;        }</b>
<b class="nc"><i>1012</i>&nbsp;</b>
<b class="nc"><i>1013</i>&nbsp;        this.fReportedTNS.addElement(uri);</b>
<b class="nc"><i>1014</i>&nbsp;        return true;</b>
<i>1015</i>&nbsp;    }
<i>1016</i>&nbsp;
<i>1017</i>&nbsp;    void addGlobalAttributeDecl(XSAttributeDecl decl) {
<b class="nc"><i>1018</i>&nbsp;        String namespace = decl.getNamespace();</b>
<b class="nc"><i>1019</i>&nbsp;        String declKey = namespace != null &amp;&amp; namespace.length() != 0?namespace + &quot;,&quot; + decl.getName():&quot;,&quot; + decl.getName();</b>
<i>1020</i>&nbsp;        if(this.fGlobalAttrDecls.get(declKey) == null) {
<i>1021</i>&nbsp;            this.fGlobalAttrDecls.put(declKey, decl);
<i>1022</i>&nbsp;        }
<b class="nc"><i>1023</i>&nbsp;</b>
<b class="nc"><i>1024</i>&nbsp;    }</b>
<b class="nc"><i>1025</i>&nbsp;</b>
<i>1026</i>&nbsp;    void addGlobalAttributeGroupDecl(XSAttributeGroupDecl decl) {
<i>1027</i>&nbsp;        String namespace = decl.getNamespace();
<i>1028</i>&nbsp;        String declKey = namespace != null &amp;&amp; namespace.length() != 0?namespace + &quot;,&quot; + decl.getName():&quot;,&quot; + decl.getName();
<b class="nc"><i>1029</i>&nbsp;        if(this.fGlobalAttrGrpDecls.get(declKey) == null) {</b>
<b class="nc"><i>1030</i>&nbsp;            this.fGlobalAttrGrpDecls.put(declKey, decl);</b>
<b class="nc"><i>1031</i>&nbsp;        }</b>
<i>1032</i>&nbsp;
<i>1033</i>&nbsp;    }
<i>1034</i>&nbsp;
<i>1035</i>&nbsp;    void addGlobalElementDecl(XSElementDecl decl) {
<i>1036</i>&nbsp;        String namespace = decl.getNamespace();
<i>1037</i>&nbsp;        String declKey = namespace != null &amp;&amp; namespace.length() != 0?namespace + &quot;,&quot; + decl.getName():&quot;,&quot; + decl.getName();
<i>1038</i>&nbsp;        if(this.fGlobalElemDecls.get(declKey) == null) {
<i>1039</i>&nbsp;            this.fGlobalElemDecls.put(declKey, decl);
<i>1040</i>&nbsp;        }
<i>1041</i>&nbsp;
<i>1042</i>&nbsp;    }
<i>1043</i>&nbsp;
<i>1044</i>&nbsp;    void addGlobalGroupDecl(XSGroupDecl decl) {
<i>1045</i>&nbsp;        String namespace = decl.getNamespace();
<i>1046</i>&nbsp;        String declKey = namespace != null &amp;&amp; namespace.length() != 0?namespace + &quot;,&quot; + decl.getName():&quot;,&quot; + decl.getName();
<i>1047</i>&nbsp;        if(this.fGlobalGroupDecls.get(declKey) == null) {
<i>1048</i>&nbsp;            this.fGlobalGroupDecls.put(declKey, decl);
<i>1049</i>&nbsp;        }
<i>1050</i>&nbsp;
<i>1051</i>&nbsp;    }
<i>1052</i>&nbsp;
<i>1053</i>&nbsp;    void addGlobalNotationDecl(XSNotationDecl decl) {
<b class="nc"><i>1054</i>&nbsp;        String namespace = decl.getNamespace();</b>
<b class="nc"><i>1055</i>&nbsp;        String declKey = namespace != null &amp;&amp; namespace.length() != 0?namespace + &quot;,&quot; + decl.getName():&quot;,&quot; + decl.getName();</b>
<i>1056</i>&nbsp;        if(this.fGlobalNotationDecls.get(declKey) == null) {
<b class="nc"><i>1057</i>&nbsp;            this.fGlobalNotationDecls.put(declKey, decl);</b>
<b class="nc"><i>1058</i>&nbsp;        }</b>
<i>1059</i>&nbsp;
<b class="nc"><i>1060</i>&nbsp;    }</b>
<b class="nc"><i>1061</i>&nbsp;</b>
<i>1062</i>&nbsp;    void addGlobalTypeDecl(XSTypeDefinition decl) {
<b class="nc"><i>1063</i>&nbsp;        String namespace = decl.getNamespace();</b>
<i>1064</i>&nbsp;        String declKey = namespace != null &amp;&amp; namespace.length() != 0?namespace + &quot;,&quot; + decl.getName():&quot;,&quot; + decl.getName();
<i>1065</i>&nbsp;        if(this.fGlobalTypeDecls.get(declKey) == null) {
<b class="nc"><i>1066</i>&nbsp;            this.fGlobalTypeDecls.put(declKey, decl);</b>
<i>1067</i>&nbsp;        }
<b class="nc"><i>1068</i>&nbsp;</b>
<b class="nc"><i>1069</i>&nbsp;    }</b>
<i>1070</i>&nbsp;
<b class="nc"><i>1071</i>&nbsp;    void addIDConstraintDecl(IdentityConstraint decl) {</b>
<b class="nc"><i>1072</i>&nbsp;        String namespace = decl.getNamespace();</b>
<i>1073</i>&nbsp;        String declKey = namespace != null &amp;&amp; namespace.length() != 0?namespace + &quot;,&quot; + decl.getIdentityConstraintName():&quot;,&quot; + decl.getIdentityConstraintName();
<i>1074</i>&nbsp;        if(this.fGlobalIDConstraintDecls.get(declKey) == null) {
<b class="nc"><i>1075</i>&nbsp;            this.fGlobalIDConstraintDecls.put(declKey, decl);</b>
<i>1076</i>&nbsp;        }
<b class="nc"><i>1077</i>&nbsp;</b>
<i>1078</i>&nbsp;    }
<b class="nc"><i>1079</i>&nbsp;</b>
<i>1080</i>&nbsp;    private XSAttributeDecl getGlobalAttributeDecl(String declKey) {
<b class="nc"><i>1081</i>&nbsp;        return (XSAttributeDecl)this.fGlobalAttrDecls.get(declKey);</b>
<b class="nc"><i>1082</i>&nbsp;    }</b>
<i>1083</i>&nbsp;
<b class="nc"><i>1084</i>&nbsp;    private XSAttributeGroupDecl getGlobalAttributeGroupDecl(String declKey) {</b>
<i>1085</i>&nbsp;        return (XSAttributeGroupDecl)this.fGlobalAttrGrpDecls.get(declKey);
<b class="nc"><i>1086</i>&nbsp;    }</b>
<b class="nc"><i>1087</i>&nbsp;</b>
<b class="nc"><i>1088</i>&nbsp;    private XSElementDecl getGlobalElementDecl(String declKey) {</b>
<i>1089</i>&nbsp;        return (XSElementDecl)this.fGlobalElemDecls.get(declKey);
<b class="nc"><i>1090</i>&nbsp;    }</b>
<b class="nc"><i>1091</i>&nbsp;</b>
<b class="nc"><i>1092</i>&nbsp;    private XSGroupDecl getGlobalGroupDecl(String declKey) {</b>
<b class="nc"><i>1093</i>&nbsp;        return (XSGroupDecl)this.fGlobalGroupDecls.get(declKey);</b>
<b class="nc"><i>1094</i>&nbsp;    }</b>
<b class="nc"><i>1095</i>&nbsp;</b>
<b class="nc"><i>1096</i>&nbsp;    private XSNotationDecl getGlobalNotationDecl(String declKey) {</b>
<i>1097</i>&nbsp;        return (XSNotationDecl)this.fGlobalNotationDecls.get(declKey);
<i>1098</i>&nbsp;    }
<b class="nc"><i>1099</i>&nbsp;</b>
<b class="nc"><i>1100</i>&nbsp;    private XSTypeDefinition getGlobalTypeDecl(String declKey) {</b>
<b class="nc"><i>1101</i>&nbsp;        return (XSTypeDefinition)this.fGlobalTypeDecls.get(declKey);</b>
<i>1102</i>&nbsp;    }
<b class="nc"><i>1103</i>&nbsp;</b>
<i>1104</i>&nbsp;    private IdentityConstraint getIDConstraintDecl(String declKey) {
<b class="nc"><i>1105</i>&nbsp;        return (IdentityConstraint)this.fGlobalIDConstraintDecls.get(declKey);</b>
<i>1106</i>&nbsp;    }
<b class="nc"><i>1107</i>&nbsp;</b>
<b class="nc"><i>1108</i>&nbsp;    protected Object getGlobalDecl(XSDocumentInfo currSchema, int declType, QName declToTraverse, Element elmNode) {</b>
<i>1109</i>&nbsp;        if(declToTraverse.uri != null &amp;&amp; declToTraverse.uri == SchemaSymbols.URI_SCHEMAFORSCHEMA &amp;&amp; declType == 7) {
<b class="nc"><i>1110</i>&nbsp;            XSTypeDefinition sGrammar = SchemaGrammar.SG_SchemaNS.getGlobalTypeDecl(declToTraverse.localpart);</b>
<i>1111</i>&nbsp;            if(sGrammar != null) {
<b class="nc"><i>1112</i>&nbsp;                return sGrammar;</b>
<i>1113</i>&nbsp;            }
<b class="nc"><i>1114</i>&nbsp;        }</b>
<b class="nc"><i>1115</i>&nbsp;</b>
<i>1116</i>&nbsp;        if(!currSchema.isAllowedNS(declToTraverse.uri) &amp;&amp; currSchema.needReportTNSError(declToTraverse.uri)) {
<i>1117</i>&nbsp;            String sGrammar1 = declToTraverse.uri == null?&quot;src-resolve.4.1&quot;:&quot;src-resolve.4.2&quot;;
<i>1118</i>&nbsp;            this.reportSchemaError(sGrammar1, new Object[]{this.fDoc2SystemId.get(currSchema.fSchemaElement), declToTraverse.uri, declToTraverse.rawname}, elmNode);
<b class="nc"><i>1119</i>&nbsp;        }</b>
<i>1120</i>&nbsp;
<i>1121</i>&nbsp;        SchemaGrammar sGrammar2 = this.fGrammarBucket.getGrammar(declToTraverse.uri);
<b class="nc"><i>1122</i>&nbsp;        if(sGrammar2 == null) {</b>
<b class="nc"><i>1123</i>&nbsp;            if(this.needReportTNSError(declToTraverse.uri)) {</b>
<b class="nc"><i>1124</i>&nbsp;                this.reportSchemaError(&quot;src-resolve&quot;, new Object[]{declToTraverse.rawname, COMP_TYPE[declType]}, elmNode);</b>
<i>1125</i>&nbsp;            }
<b class="nc"><i>1126</i>&nbsp;</b>
<i>1127</i>&nbsp;            return null;
<b class="nc"><i>1128</i>&nbsp;        } else {</b>
<i>1129</i>&nbsp;            Object retObj = this.getGlobalDeclFromGrammar(sGrammar2, declType, declToTraverse.localpart);
<i>1130</i>&nbsp;            String declKey = declToTraverse.uri == null?&quot;,&quot; + declToTraverse.localpart:declToTraverse.uri + &quot;,&quot; + declToTraverse.localpart;
<i>1131</i>&nbsp;            Object schemaWithDecl;
<i>1132</i>&nbsp;            if(!this.fTolerateDuplicates) {
<i>1133</i>&nbsp;                if(retObj != null) {
<i>1134</i>&nbsp;                    return retObj;
<i>1135</i>&nbsp;                }
<b class="nc"><i>1136</i>&nbsp;            } else {</b>
<b class="nc"><i>1137</i>&nbsp;                schemaWithDecl = this.getGlobalDecl(declKey, declType);</b>
<b class="nc"><i>1138</i>&nbsp;                if(schemaWithDecl != null) {</b>
<b class="nc"><i>1139</i>&nbsp;                    return schemaWithDecl;</b>
<b class="nc"><i>1140</i>&nbsp;                }</b>
<i>1141</i>&nbsp;            }
<i>1142</i>&nbsp;
<b class="nc"><i>1143</i>&nbsp;            schemaWithDecl = null;</b>
<b class="nc"><i>1144</i>&nbsp;            Element decl = null;</b>
<b class="nc"><i>1145</i>&nbsp;            XSDocumentInfo declDoc = null;</b>
<i>1146</i>&nbsp;            switch(declType) {
<b class="nc"><i>1147</i>&nbsp;            case 1:</b>
<b class="nc"><i>1148</i>&nbsp;                decl = this.getElementFromMap(this.fUnparsedAttributeRegistry, declKey);</b>
<i>1149</i>&nbsp;                declDoc = this.getDocInfoFromMap(this.fUnparsedAttributeRegistrySub, declKey);
<b class="nc"><i>1150</i>&nbsp;                break;</b>
<i>1151</i>&nbsp;            case 2:
<b class="nc"><i>1152</i>&nbsp;                decl = this.getElementFromMap(this.fUnparsedAttributeGroupRegistry, declKey);</b>
<i>1153</i>&nbsp;                declDoc = this.getDocInfoFromMap(this.fUnparsedAttributeGroupRegistrySub, declKey);
<b class="nc"><i>1154</i>&nbsp;                break;</b>
<b class="nc"><i>1155</i>&nbsp;            case 3:</b>
<i>1156</i>&nbsp;                decl = this.getElementFromMap(this.fUnparsedElementRegistry, declKey);
<b class="nc"><i>1157</i>&nbsp;                declDoc = this.getDocInfoFromMap(this.fUnparsedElementRegistrySub, declKey);</b>
<b class="nc"><i>1158</i>&nbsp;                break;</b>
<i>1159</i>&nbsp;            case 4:
<b class="nc"><i>1160</i>&nbsp;                decl = this.getElementFromMap(this.fUnparsedGroupRegistry, declKey);</b>
<b class="nc"><i>1161</i>&nbsp;                declDoc = this.getDocInfoFromMap(this.fUnparsedGroupRegistrySub, declKey);</b>
<i>1162</i>&nbsp;                break;
<i>1163</i>&nbsp;            case 5:
<i>1164</i>&nbsp;                decl = this.getElementFromMap(this.fUnparsedIdentityConstraintRegistry, declKey);
<i>1165</i>&nbsp;                declDoc = this.getDocInfoFromMap(this.fUnparsedIdentityConstraintRegistrySub, declKey);
<i>1166</i>&nbsp;                break;
<b class="nc"><i>1167</i>&nbsp;            case 6:</b>
<i>1168</i>&nbsp;                decl = this.getElementFromMap(this.fUnparsedNotationRegistry, declKey);
<b class="nc"><i>1169</i>&nbsp;                declDoc = this.getDocInfoFromMap(this.fUnparsedNotationRegistrySub, declKey);</b>
<b class="nc"><i>1170</i>&nbsp;                break;</b>
<b class="nc"><i>1171</i>&nbsp;            case 7:</b>
<i>1172</i>&nbsp;                decl = this.getElementFromMap(this.fUnparsedTypeRegistry, declKey);
<b class="nc"><i>1173</i>&nbsp;                declDoc = this.getDocInfoFromMap(this.fUnparsedTypeRegistrySub, declKey);</b>
<i>1174</i>&nbsp;                break;
<i>1175</i>&nbsp;            default:
<i>1176</i>&nbsp;                this.reportSchemaError(&quot;Internal-Error&quot;, new Object[]{&quot;XSDHandler asked to locate component of type &quot; + declType + &quot;; it does not recognize this type!&quot;}, elmNode);
<i>1177</i>&nbsp;            }
<i>1178</i>&nbsp;
<i>1179</i>&nbsp;            if(decl == null) {
<i>1180</i>&nbsp;                if(retObj == null) {
<i>1181</i>&nbsp;                    this.reportSchemaError(&quot;src-resolve&quot;, new Object[]{declToTraverse.rawname, COMP_TYPE[declType]}, elmNode);
<i>1182</i>&nbsp;                }
<i>1183</i>&nbsp;
<i>1184</i>&nbsp;                return retObj;
<i>1185</i>&nbsp;            } else {
<i>1186</i>&nbsp;                XSDocumentInfo schemaWithDecl1 = this.findXSDocumentForDecl(currSchema, decl, declDoc);
<i>1187</i>&nbsp;                String code;
<i>1188</i>&nbsp;                if(schemaWithDecl1 == null) {
<i>1189</i>&nbsp;                    if(retObj == null) {
<i>1190</i>&nbsp;                        code = declToTraverse.uri == null?&quot;src-resolve.4.1&quot;:&quot;src-resolve.4.2&quot;;
<i>1191</i>&nbsp;                        this.reportSchemaError(code, new Object[]{this.fDoc2SystemId.get(currSchema.fSchemaElement), declToTraverse.uri, declToTraverse.rawname}, elmNode);
<i>1192</i>&nbsp;                    }
<b class="nc"><i>1193</i>&nbsp;</b>
<b class="nc"><i>1194</i>&nbsp;                    return retObj;</b>
<b class="nc"><i>1195</i>&nbsp;                } else if(DOMUtil.isHidden(decl, this.fHiddenNodes)) {</b>
<b class="nc"><i>1196</i>&nbsp;                    if(retObj == null) {</b>
<b class="nc"><i>1197</i>&nbsp;                        code = CIRCULAR_CODES[declType];</b>
<i>1198</i>&nbsp;                        if(declType == 7 &amp;&amp; SchemaSymbols.ELT_COMPLEXTYPE.equals(DOMUtil.getLocalName(decl))) {
<b class="nc"><i>1199</i>&nbsp;                            code = &quot;ct-props-correct.3&quot;;</b>
<i>1200</i>&nbsp;                        }
<b class="nc"><i>1201</i>&nbsp;</b>
<i>1202</i>&nbsp;                        this.reportSchemaError(code, new Object[]{declToTraverse.prefix + &quot;:&quot; + declToTraverse.localpart}, elmNode);
<b class="nc"><i>1203</i>&nbsp;                    }</b>
<i>1204</i>&nbsp;
<b class="nc"><i>1205</i>&nbsp;                    return retObj;</b>
<i>1206</i>&nbsp;                } else {
<b class="nc"><i>1207</i>&nbsp;                    return this.traverseGlobalDecl(declType, decl, schemaWithDecl1, sGrammar2);</b>
<b class="nc"><i>1208</i>&nbsp;                }</b>
<i>1209</i>&nbsp;            }
<b class="nc"><i>1210</i>&nbsp;        }</b>
<i>1211</i>&nbsp;    }
<b class="nc"><i>1212</i>&nbsp;</b>
<b class="nc"><i>1213</i>&nbsp;    protected Object getGlobalDecl(String declKey, int declType) {</b>
<b class="nc"><i>1214</i>&nbsp;        Object retObj = null;</b>
<b class="nc"><i>1215</i>&nbsp;        switch(declType) {</b>
<i>1216</i>&nbsp;        case 1:
<b class="nc"><i>1217</i>&nbsp;            retObj = this.getGlobalAttributeDecl(declKey);</b>
<i>1218</i>&nbsp;            break;
<b class="nc"><i>1219</i>&nbsp;        case 2:</b>
<b class="nc"><i>1220</i>&nbsp;            retObj = this.getGlobalAttributeGroupDecl(declKey);</b>
<b class="nc"><i>1221</i>&nbsp;            break;</b>
<b class="nc"><i>1222</i>&nbsp;        case 3:</b>
<b class="nc"><i>1223</i>&nbsp;            retObj = this.getGlobalElementDecl(declKey);</b>
<b class="nc"><i>1224</i>&nbsp;            break;</b>
<b class="nc"><i>1225</i>&nbsp;        case 4:</b>
<b class="nc"><i>1226</i>&nbsp;            retObj = this.getGlobalGroupDecl(declKey);</b>
<i>1227</i>&nbsp;            break;
<b class="nc"><i>1228</i>&nbsp;        case 5:</b>
<b class="nc"><i>1229</i>&nbsp;            retObj = this.getIDConstraintDecl(declKey);</b>
<i>1230</i>&nbsp;            break;
<b class="nc"><i>1231</i>&nbsp;        case 6:</b>
<b class="nc"><i>1232</i>&nbsp;            retObj = this.getGlobalNotationDecl(declKey);</b>
<i>1233</i>&nbsp;            break;
<b class="nc"><i>1234</i>&nbsp;        case 7:</b>
<b class="nc"><i>1235</i>&nbsp;            retObj = this.getGlobalTypeDecl(declKey);</b>
<i>1236</i>&nbsp;        }
<i>1237</i>&nbsp;
<i>1238</i>&nbsp;        return retObj;
<i>1239</i>&nbsp;    }
<i>1240</i>&nbsp;
<i>1241</i>&nbsp;    protected Object getGlobalDeclFromGrammar(SchemaGrammar sGrammar, int declType, String localpart) {
<i>1242</i>&nbsp;        Object retObj = null;
<b class="nc"><i>1243</i>&nbsp;        switch(declType) {</b>
<i>1244</i>&nbsp;        case 1:
<i>1245</i>&nbsp;            retObj = sGrammar.getGlobalAttributeDecl(localpart);
<b class="nc"><i>1246</i>&nbsp;            break;</b>
<i>1247</i>&nbsp;        case 2:
<b class="nc"><i>1248</i>&nbsp;            retObj = sGrammar.getGlobalAttributeGroupDecl(localpart);</b>
<b class="nc"><i>1249</i>&nbsp;            break;</b>
<i>1250</i>&nbsp;        case 3:
<b class="nc"><i>1251</i>&nbsp;            retObj = sGrammar.getGlobalElementDecl(localpart);</b>
<b class="nc"><i>1252</i>&nbsp;            break;</b>
<i>1253</i>&nbsp;        case 4:
<b class="nc"><i>1254</i>&nbsp;            retObj = sGrammar.getGlobalGroupDecl(localpart);</b>
<b class="nc"><i>1255</i>&nbsp;            break;</b>
<i>1256</i>&nbsp;        case 5:
<b class="nc"><i>1257</i>&nbsp;            retObj = sGrammar.getIDConstraintDecl(localpart);</b>
<b class="nc"><i>1258</i>&nbsp;            break;</b>
<i>1259</i>&nbsp;        case 6:
<b class="nc"><i>1260</i>&nbsp;            retObj = sGrammar.getGlobalNotationDecl(localpart);</b>
<b class="nc"><i>1261</i>&nbsp;            break;</b>
<i>1262</i>&nbsp;        case 7:
<b class="nc"><i>1263</i>&nbsp;            retObj = sGrammar.getGlobalTypeDecl(localpart);</b>
<b class="nc"><i>1264</i>&nbsp;        }</b>
<i>1265</i>&nbsp;
<b class="nc"><i>1266</i>&nbsp;        return retObj;</b>
<b class="nc"><i>1267</i>&nbsp;    }</b>
<i>1268</i>&nbsp;
<b class="nc"><i>1269</i>&nbsp;    protected Object getGlobalDeclFromGrammar(SchemaGrammar sGrammar, int declType, String localpart, String schemaLoc) {</b>
<b class="nc"><i>1270</i>&nbsp;        Object retObj = null;</b>
<b class="nc"><i>1271</i>&nbsp;        switch(declType) {</b>
<i>1272</i>&nbsp;        case 1:
<i>1273</i>&nbsp;            retObj = sGrammar.getGlobalAttributeDecl(localpart, schemaLoc);
<b class="nc"><i>1274</i>&nbsp;            break;</b>
<i>1275</i>&nbsp;        case 2:
<i>1276</i>&nbsp;            retObj = sGrammar.getGlobalAttributeGroupDecl(localpart, schemaLoc);
<i>1277</i>&nbsp;            break;
<b class="nc"><i>1278</i>&nbsp;        case 3:</b>
<b class="nc"><i>1279</i>&nbsp;            retObj = sGrammar.getGlobalElementDecl(localpart, schemaLoc);</b>
<b class="nc"><i>1280</i>&nbsp;            break;</b>
<b class="nc"><i>1281</i>&nbsp;        case 4:</b>
<i>1282</i>&nbsp;            retObj = sGrammar.getGlobalGroupDecl(localpart, schemaLoc);
<i>1283</i>&nbsp;            break;
<i>1284</i>&nbsp;        case 5:
<i>1285</i>&nbsp;            retObj = sGrammar.getIDConstraintDecl(localpart, schemaLoc);
<b class="nc"><i>1286</i>&nbsp;            break;</b>
<b class="nc"><i>1287</i>&nbsp;        case 6:</b>
<i>1288</i>&nbsp;            retObj = sGrammar.getGlobalNotationDecl(localpart, schemaLoc);
<b class="nc"><i>1289</i>&nbsp;            break;</b>
<b class="nc"><i>1290</i>&nbsp;        case 7:</b>
<b class="nc"><i>1291</i>&nbsp;            retObj = sGrammar.getGlobalTypeDecl(localpart, schemaLoc);</b>
<i>1292</i>&nbsp;        }
<i>1293</i>&nbsp;
<i>1294</i>&nbsp;        return retObj;
<b class="nc"><i>1295</i>&nbsp;    }</b>
<b class="nc"><i>1296</i>&nbsp;</b>
<i>1297</i>&nbsp;    protected Object traverseGlobalDecl(int declType, Element decl, XSDocumentInfo schemaDoc, SchemaGrammar grammar) {
<i>1298</i>&nbsp;        Object retObj = null;
<b class="nc"><i>1299</i>&nbsp;        DOMUtil.setHidden(decl, this.fHiddenNodes);</b>
<b class="nc"><i>1300</i>&nbsp;        SchemaNamespaceSupport nsSupport = null;</b>
<b class="nc"><i>1301</i>&nbsp;        Element parent = DOMUtil.getParent(decl);</b>
<i>1302</i>&nbsp;        if(DOMUtil.getLocalName(parent).equals(SchemaSymbols.ELT_REDEFINE)) {
<b class="nc"><i>1303</i>&nbsp;            nsSupport = this.fRedefine2NSSupport != null?(SchemaNamespaceSupport)this.fRedefine2NSSupport.get(parent):null;</b>
<i>1304</i>&nbsp;        }
<i>1305</i>&nbsp;
<i>1306</i>&nbsp;        schemaDoc.backupNSSupport(nsSupport);
<i>1307</i>&nbsp;        switch(declType) {
<b class="nc"><i>1308</i>&nbsp;        case 1:</b>
<i>1309</i>&nbsp;            retObj = this.fAttributeTraverser.traverseGlobal(decl, schemaDoc, grammar);
<i>1310</i>&nbsp;            break;
<i>1311</i>&nbsp;        case 2:
<i>1312</i>&nbsp;            retObj = this.fAttributeGroupTraverser.traverseGlobal(decl, schemaDoc, grammar);
<b class="nc"><i>1313</i>&nbsp;            break;</b>
<b class="nc"><i>1314</i>&nbsp;        case 3:</b>
<b class="nc"><i>1315</i>&nbsp;            retObj = this.fElementTraverser.traverseGlobal(decl, schemaDoc, grammar);</b>
<b class="nc"><i>1316</i>&nbsp;            break;</b>
<b class="nc"><i>1317</i>&nbsp;        case 4:</b>
<b class="nc"><i>1318</i>&nbsp;            retObj = this.fGroupTraverser.traverseGlobal(decl, schemaDoc, grammar);</b>
<i>1319</i>&nbsp;        case 5:
<i>1320</i>&nbsp;        default:
<b class="nc"><i>1321</i>&nbsp;            break;</b>
<i>1322</i>&nbsp;        case 6:
<i>1323</i>&nbsp;            retObj = this.fNotationTraverser.traverse(decl, schemaDoc, grammar);
<i>1324</i>&nbsp;            break;
<i>1325</i>&nbsp;        case 7:
<i>1326</i>&nbsp;            if(DOMUtil.getLocalName(decl).equals(SchemaSymbols.ELT_COMPLEXTYPE)) {
<i>1327</i>&nbsp;                retObj = this.fComplexTypeTraverser.traverseGlobal(decl, schemaDoc, grammar);
<i>1328</i>&nbsp;            } else {
<i>1329</i>&nbsp;                retObj = this.fSimpleTypeTraverser.traverseGlobal(decl, schemaDoc, grammar);
<i>1330</i>&nbsp;            }
<i>1331</i>&nbsp;        }
<b class="nc"><i>1332</i>&nbsp;</b>
<i>1333</i>&nbsp;        schemaDoc.restoreNSSupport();
<i>1334</i>&nbsp;        return retObj;
<i>1335</i>&nbsp;    }
<i>1336</i>&nbsp;
<i>1337</i>&nbsp;    public String schemaDocument2SystemId(XSDocumentInfo schemaDoc) {
<i>1338</i>&nbsp;        return (String)this.fDoc2SystemId.get(schemaDoc.fSchemaElement);
<i>1339</i>&nbsp;    }
<i>1340</i>&nbsp;
<i>1341</i>&nbsp;    Object getGrpOrAttrGrpRedefinedByRestriction(int type, QName name, XSDocumentInfo currSchema, Element elmNode) {
<i>1342</i>&nbsp;        String realName = name.uri != null?name.uri + &quot;,&quot; + name.localpart:&quot;,&quot; + name.localpart;
<i>1343</i>&nbsp;        String nameToFind = null;
<i>1344</i>&nbsp;        switch(type) {
<i>1345</i>&nbsp;        case 2:
<i>1346</i>&nbsp;            nameToFind = (String)this.fRedefinedRestrictedAttributeGroupRegistry.get(realName);
<i>1347</i>&nbsp;            break;
<i>1348</i>&nbsp;        case 4:
<i>1349</i>&nbsp;            nameToFind = (String)this.fRedefinedRestrictedGroupRegistry.get(realName);
<i>1350</i>&nbsp;            break;
<i>1351</i>&nbsp;        default:
<i>1352</i>&nbsp;            return null;
<i>1353</i>&nbsp;        }
<i>1354</i>&nbsp;
<i>1355</i>&nbsp;        if(nameToFind == null) {
<i>1356</i>&nbsp;            return null;
<i>1357</i>&nbsp;        } else {
<i>1358</i>&nbsp;            int commaPos = nameToFind.indexOf(&quot;,&quot;);
<i>1359</i>&nbsp;            QName qNameToFind = new QName(XMLSymbols.EMPTY_STRING, nameToFind.substring(commaPos + 1), nameToFind.substring(commaPos), commaPos == 0?null:nameToFind.substring(0, commaPos));
<i>1360</i>&nbsp;            Object retObj = this.getGlobalDecl(currSchema, type, qNameToFind, elmNode);
<i>1361</i>&nbsp;            if(retObj == null) {
<i>1362</i>&nbsp;                switch(type) {
<i>1363</i>&nbsp;                case 2:
<i>1364</i>&nbsp;                    this.reportSchemaError(&quot;src-redefine.7.2.1&quot;, new Object[]{name.localpart}, elmNode);
<i>1365</i>&nbsp;                    break;
<i>1366</i>&nbsp;                case 4:
<i>1367</i>&nbsp;                    this.reportSchemaError(&quot;src-redefine.6.2.1&quot;, new Object[]{name.localpart}, elmNode);
<i>1368</i>&nbsp;                }
<i>1369</i>&nbsp;
<i>1370</i>&nbsp;                return null;
<i>1371</i>&nbsp;            } else {
<i>1372</i>&nbsp;                return retObj;
<b class="nc"><i>1373</i>&nbsp;            }</b>
<i>1374</i>&nbsp;        }
<b class="nc"><i>1375</i>&nbsp;    }</b>
<b class="nc"><i>1376</i>&nbsp;</b>
<b class="nc"><i>1377</i>&nbsp;    protected void resolveKeyRefs() {</b>
<b class="nc"><i>1378</i>&nbsp;        for(int i = 0; i &lt; this.fKeyrefStackPos; ++i) {</b>
<i>1379</i>&nbsp;            XSDocumentInfo keyrefSchemaDoc = this.fKeyrefsMapXSDocumentInfo[i];
<i>1380</i>&nbsp;            keyrefSchemaDoc.fNamespaceSupport.makeGlobal();
<i>1381</i>&nbsp;            keyrefSchemaDoc.fNamespaceSupport.setEffectiveContext(this.fKeyrefNamespaceContext[i]);
<i>1382</i>&nbsp;            SchemaGrammar keyrefGrammar = this.fGrammarBucket.getGrammar(keyrefSchemaDoc.fTargetNamespace);
<b class="nc"><i>1383</i>&nbsp;            DOMUtil.setHidden(this.fKeyrefs[i], this.fHiddenNodes);</b>
<i>1384</i>&nbsp;            this.fKeyrefTraverser.traverse(this.fKeyrefs[i], this.fKeyrefElems[i], keyrefSchemaDoc, keyrefGrammar);
<b class="nc"><i>1385</i>&nbsp;        }</b>
<b class="nc"><i>1386</i>&nbsp;</b>
<b class="nc"><i>1387</i>&nbsp;    }</b>
<i>1388</i>&nbsp;
<b class="nc"><i>1389</i>&nbsp;    protected Map getIDRegistry() {</b>
<i>1390</i>&nbsp;        return this.fUnparsedIdentityConstraintRegistry;
<i>1391</i>&nbsp;    }
<i>1392</i>&nbsp;
<b class="nc"><i>1393</i>&nbsp;    protected Map getIDRegistry_sub() {</b>
<b class="nc"><i>1394</i>&nbsp;        return this.fUnparsedIdentityConstraintRegistrySub;</b>
<b class="nc"><i>1395</i>&nbsp;    }</b>
<b class="nc"><i>1396</i>&nbsp;</b>
<b class="nc"><i>1397</i>&nbsp;    protected void storeKeyRef(Element keyrefToStore, XSDocumentInfo schemaDoc, XSElementDecl currElemDecl) {</b>
<i>1398</i>&nbsp;        String keyrefName = DOMUtil.getAttrValue(keyrefToStore, SchemaSymbols.ATT_NAME);
<i>1399</i>&nbsp;        if(keyrefName.length() != 0) {
<i>1400</i>&nbsp;            String elemArray = schemaDoc.fTargetNamespace == null?&quot;,&quot; + keyrefName:schemaDoc.fTargetNamespace + &quot;,&quot; + keyrefName;
<b class="nc"><i>1401</i>&nbsp;            this.checkForDuplicateNames(elemArray, 5, this.fUnparsedIdentityConstraintRegistry, this.fUnparsedIdentityConstraintRegistrySub, keyrefToStore, schemaDoc);</b>
<b class="nc"><i>1402</i>&nbsp;        }</b>
<i>1403</i>&nbsp;
<b class="nc"><i>1404</i>&nbsp;        if(this.fKeyrefStackPos == this.fKeyrefs.length) {</b>
<b class="nc"><i>1405</i>&nbsp;            Element[] elemArray1 = new Element[this.fKeyrefStackPos + 2];</b>
<i>1406</i>&nbsp;            System.arraycopy(this.fKeyrefs, 0, elemArray1, 0, this.fKeyrefStackPos);
<b class="nc"><i>1407</i>&nbsp;            this.fKeyrefs = elemArray1;</b>
<b class="nc"><i>1408</i>&nbsp;            XSElementDecl[] declArray = new XSElementDecl[this.fKeyrefStackPos + 2];</b>
<i>1409</i>&nbsp;            System.arraycopy(this.fKeyrefElems, 0, declArray, 0, this.fKeyrefStackPos);
<b class="nc"><i>1410</i>&nbsp;            this.fKeyrefElems = declArray;</b>
<b class="nc"><i>1411</i>&nbsp;            String[][] stringArray = new String[this.fKeyrefStackPos + 2][];</b>
<i>1412</i>&nbsp;            System.arraycopy(this.fKeyrefNamespaceContext, 0, stringArray, 0, this.fKeyrefStackPos);
<b class="nc"><i>1413</i>&nbsp;            this.fKeyrefNamespaceContext = stringArray;</b>
<b class="nc"><i>1414</i>&nbsp;            XSDocumentInfo[] xsDocumentInfo = new XSDocumentInfo[this.fKeyrefStackPos + 2];</b>
<i>1415</i>&nbsp;            System.arraycopy(this.fKeyrefsMapXSDocumentInfo, 0, xsDocumentInfo, 0, this.fKeyrefStackPos);
<b class="nc"><i>1416</i>&nbsp;            this.fKeyrefsMapXSDocumentInfo = xsDocumentInfo;</b>
<b class="nc"><i>1417</i>&nbsp;        }</b>
<i>1418</i>&nbsp;
<b class="nc"><i>1419</i>&nbsp;        this.fKeyrefs[this.fKeyrefStackPos] = keyrefToStore;</b>
<b class="nc"><i>1420</i>&nbsp;        this.fKeyrefElems[this.fKeyrefStackPos] = currElemDecl;</b>
<i>1421</i>&nbsp;        this.fKeyrefNamespaceContext[this.fKeyrefStackPos] = schemaDoc.fNamespaceSupport.getEffectiveLocalContext();
<b class="nc"><i>1422</i>&nbsp;        this.fKeyrefsMapXSDocumentInfo[this.fKeyrefStackPos++] = schemaDoc;</b>
<i>1423</i>&nbsp;    }
<i>1424</i>&nbsp;
<i>1425</i>&nbsp;    private Element resolveSchema(XSDDescription desc, boolean mustResolve, Element referElement, boolean usePairs) {
<i>1426</i>&nbsp;        XMLInputSource schemaSource = null;
<b class="nc"><i>1427</i>&nbsp;</b>
<b class="nc"><i>1428</i>&nbsp;        try {</b>
<i>1429</i>&nbsp;            Map ex = usePairs?this.fLocationPairs:EMPTY_TABLE;
<b class="nc"><i>1430</i>&nbsp;            schemaSource = XMLSchemaLoader.resolveDocument(desc, ex, this.fEntityResolver);</b>
<b class="nc"><i>1431</i>&nbsp;        } catch (IOException var7) {</b>
<b class="nc"><i>1432</i>&nbsp;            if(mustResolve) {</b>
<i>1433</i>&nbsp;                this.reportSchemaError(&quot;schema_reference.4&quot;, new Object[]{desc.getLocationHints()[0]}, referElement);
<i>1434</i>&nbsp;            } else {
<b class="nc"><i>1435</i>&nbsp;                this.reportSchemaWarning(&quot;schema_reference.4&quot;, new Object[]{desc.getLocationHints()[0]}, referElement);</b>
<i>1436</i>&nbsp;            }
<b class="nc"><i>1437</i>&nbsp;        }</b>
<i>1438</i>&nbsp;
<b class="nc"><i>1439</i>&nbsp;        return schemaSource instanceof DOMInputSource?this.getSchemaDocument(desc.getTargetNamespace(), (DOMInputSource)((DOMInputSource)schemaSource), mustResolve, desc.getContextType(), referElement):(schemaSource instanceof SAXInputSource?this.getSchemaDocument(desc.getTargetNamespace(), (SAXInputSource)((SAXInputSource)schemaSource), mustResolve, desc.getContextType(), referElement):(schemaSource instanceof StAXInputSource?this.getSchemaDocument(desc.getTargetNamespace(), (StAXInputSource)((StAXInputSource)schemaSource), mustResolve, desc.getContextType(), referElement):(schemaSource instanceof XSInputSource?this.getSchemaDocument((XSInputSource)schemaSource, desc):this.getSchemaDocument(desc.getTargetNamespace(), (XMLInputSource)schemaSource, mustResolve, desc.getContextType(), referElement))));</b>
<b class="nc"><i>1440</i>&nbsp;    }</b>
<b class="nc"><i>1441</i>&nbsp;</b>
<i>1442</i>&nbsp;    private Element resolveSchema(XMLInputSource schemaSource, XSDDescription desc, boolean mustResolve, Element referElement) {
<b class="nc"><i>1443</i>&nbsp;        return schemaSource instanceof DOMInputSource?this.getSchemaDocument(desc.getTargetNamespace(), (DOMInputSource)((DOMInputSource)schemaSource), mustResolve, desc.getContextType(), referElement):(schemaSource instanceof SAXInputSource?this.getSchemaDocument(desc.getTargetNamespace(), (SAXInputSource)((SAXInputSource)schemaSource), mustResolve, desc.getContextType(), referElement):(schemaSource instanceof StAXInputSource?this.getSchemaDocument(desc.getTargetNamespace(), (StAXInputSource)((StAXInputSource)schemaSource), mustResolve, desc.getContextType(), referElement):(schemaSource instanceof XSInputSource?this.getSchemaDocument((XSInputSource)schemaSource, desc):this.getSchemaDocument(desc.getTargetNamespace(), (XMLInputSource)schemaSource, mustResolve, desc.getContextType(), referElement))));</b>
<b class="nc"><i>1444</i>&nbsp;    }</b>
<b class="nc"><i>1445</i>&nbsp;</b>
<i>1446</i>&nbsp;    private XMLInputSource resolveSchemaSource(XSDDescription desc, boolean mustResolve, Element referElement, boolean usePairs) {
<b class="nc"><i>1447</i>&nbsp;        XMLInputSource schemaSource = null;</b>
<b class="nc"><i>1448</i>&nbsp;</b>
<b class="nc"><i>1449</i>&nbsp;        try {</b>
<i>1450</i>&nbsp;            Map ex = usePairs?this.fLocationPairs:EMPTY_TABLE;
<b class="nc"><i>1451</i>&nbsp;            schemaSource = XMLSchemaLoader.resolveDocument(desc, ex, this.fEntityResolver);</b>
<b class="nc"><i>1452</i>&nbsp;        } catch (IOException var7) {</b>
<b class="nc"><i>1453</i>&nbsp;            if(mustResolve) {</b>
<i>1454</i>&nbsp;                this.reportSchemaError(&quot;schema_reference.4&quot;, new Object[]{desc.getLocationHints()[0]}, referElement);
<b class="nc"><i>1455</i>&nbsp;            } else {</b>
<b class="nc"><i>1456</i>&nbsp;                this.reportSchemaWarning(&quot;schema_reference.4&quot;, new Object[]{desc.getLocationHints()[0]}, referElement);</b>
<b class="nc"><i>1457</i>&nbsp;            }</b>
<i>1458</i>&nbsp;        }
<b class="nc"><i>1459</i>&nbsp;</b>
<b class="nc"><i>1460</i>&nbsp;        return schemaSource;</b>
<b class="nc"><i>1461</i>&nbsp;    }</b>
<i>1462</i>&nbsp;
<b class="nc"><i>1463</i>&nbsp;    private Element getSchemaDocument(String schemaNamespace, XMLInputSource schemaSource, boolean mustResolve, short referType, Element referElement) {</b>
<b class="nc"><i>1464</i>&nbsp;        boolean hasInput = true;</b>
<b class="nc"><i>1465</i>&nbsp;        IOException exception = null;</b>
<i>1466</i>&nbsp;        Element schemaElement = null;
<b class="nc"><i>1467</i>&nbsp;</b>
<i>1468</i>&nbsp;        try {
<i>1469</i>&nbsp;            if(schemaSource != null &amp;&amp; (schemaSource.getSystemId() != null || schemaSource.getByteStream() != null || schemaSource.getCharacterStream() != null)) {
<i>1470</i>&nbsp;                XSDHandler.XSDKey ex = null;
<b class="nc"><i>1471</i>&nbsp;                String schemaId = null;</b>
<b class="nc"><i>1472</i>&nbsp;                if(referType != 3) {</b>
<b class="nc"><i>1473</i>&nbsp;                    schemaId = XMLEntityManager.expandSystemId(schemaSource.getSystemId(), schemaSource.getBaseSystemId(), false);</b>
<i>1474</i>&nbsp;                    ex = new XSDHandler.XSDKey(schemaId, referType, schemaNamespace);
<i>1475</i>&nbsp;                    if((schemaElement = (Element)this.fTraversed.get(ex)) != null) {
<i>1476</i>&nbsp;                        this.fLastSchemaWasDuplicate = true;
<i>1477</i>&nbsp;                        return schemaElement;
<i>1478</i>&nbsp;                    }
<b class="nc"><i>1479</i>&nbsp;</b>
<b class="nc"><i>1480</i>&nbsp;                    if(referType == 2 || referType == 0 || referType == 1) {</b>
<i>1481</i>&nbsp;                        String schemaDocument = SecuritySupport.checkAccess(schemaId, this.fAccessExternalSchema, &quot;all&quot;);
<b class="nc"><i>1482</i>&nbsp;                        if(schemaDocument != null) {</b>
<b class="nc"><i>1483</i>&nbsp;                            this.reportSchemaFatalError(&quot;schema_reference.access&quot;, new Object[]{SecuritySupport.sanitizePath(schemaId), schemaDocument}, referElement);</b>
<b class="nc"><i>1484</i>&nbsp;                        }</b>
<i>1485</i>&nbsp;                    }
<i>1486</i>&nbsp;                }
<i>1487</i>&nbsp;
<i>1488</i>&nbsp;                this.fSchemaParser.parse(schemaSource);
<b class="nc"><i>1489</i>&nbsp;                Document schemaDocument1 = this.fSchemaParser.getDocument();</b>
<b class="nc"><i>1490</i>&nbsp;                schemaElement = schemaDocument1 != null?DOMUtil.getRoot(schemaDocument1):null;</b>
<b class="nc"><i>1491</i>&nbsp;                return this.getSchemaDocument0(ex, schemaId, schemaElement);</b>
<b class="nc"><i>1492</i>&nbsp;            }</b>
<b class="nc"><i>1493</i>&nbsp;</b>
<i>1494</i>&nbsp;            hasInput = false;
<i>1495</i>&nbsp;        } catch (IOException var12) {
<b class="nc"><i>1496</i>&nbsp;            exception = var12;</b>
<b class="nc"><i>1497</i>&nbsp;        }</b>
<i>1498</i>&nbsp;
<i>1499</i>&nbsp;        return this.getSchemaDocument1(mustResolve, hasInput, schemaSource, referElement, exception);
<b class="nc"><i>1500</i>&nbsp;    }</b>
<b class="nc"><i>1501</i>&nbsp;</b>
<i>1502</i>&nbsp;    private Element getSchemaDocument(String schemaNamespace, SAXInputSource schemaSource, boolean mustResolve, short referType, Element referElement) {
<b class="nc"><i>1503</i>&nbsp;        Object parser = schemaSource.getXMLReader();</b>
<b class="nc"><i>1504</i>&nbsp;        InputSource inputSource = schemaSource.getInputSource();</b>
<b class="nc"><i>1505</i>&nbsp;        boolean hasInput = true;</b>
<i>1506</i>&nbsp;        IOException exception = null;
<i>1507</i>&nbsp;        Element schemaElement = null;
<b class="nc"><i>1508</i>&nbsp;</b>
<i>1509</i>&nbsp;        try {
<i>1510</i>&nbsp;            if(inputSource != null &amp;&amp; (inputSource.getSystemId() != null || inputSource.getByteStream() != null || inputSource.getCharacterStream() != null)) {
<b class="nc"><i>1511</i>&nbsp;                XSDHandler.XSDKey ioe = null;</b>
<i>1512</i>&nbsp;                String schemaId = null;
<b class="nc"><i>1513</i>&nbsp;                if(referType != 3) {</b>
<b class="nc"><i>1514</i>&nbsp;                    schemaId = XMLEntityManager.expandSystemId(inputSource.getSystemId(), schemaSource.getBaseSystemId(), false);</b>
<i>1515</i>&nbsp;                    ioe = new XSDHandler.XSDKey(schemaId, referType, schemaNamespace);
<b class="nc"><i>1516</i>&nbsp;                    if((schemaElement = (Element)this.fTraversed.get(ioe)) != null) {</b>
<b class="nc"><i>1517</i>&nbsp;                        this.fLastSchemaWasDuplicate = true;</b>
<i>1518</i>&nbsp;                        return schemaElement;
<b class="nc"><i>1519</i>&nbsp;                    }</b>
<b class="nc"><i>1520</i>&nbsp;                }</b>
<i>1521</i>&nbsp;
<b class="nc"><i>1522</i>&nbsp;                boolean namespacePrefixes = false;</b>
<b class="nc"><i>1523</i>&nbsp;                if(parser != null) {</b>
<i>1524</i>&nbsp;                    try {
<i>1525</i>&nbsp;                        namespacePrefixes = ((XMLReader)parser).getFeature(&quot;http://xml.org/sax/features/namespace-prefixes&quot;);
<i>1526</i>&nbsp;                    } catch (SAXException var21) {
<b class="nc"><i>1527</i>&nbsp;                        ;</b>
<b class="nc"><i>1528</i>&nbsp;                    }</b>
<i>1529</i>&nbsp;                } else {
<b class="nc"><i>1530</i>&nbsp;                    try {</b>
<b class="nc"><i>1531</i>&nbsp;                        parser = XMLReaderFactory.createXMLReader();</b>
<i>1532</i>&nbsp;                    } catch (SAXException var20) {
<b class="nc"><i>1533</i>&nbsp;                        parser = new SAXParser();</b>
<b class="nc"><i>1534</i>&nbsp;                    }</b>
<i>1535</i>&nbsp;
<b class="nc"><i>1536</i>&nbsp;                    try {</b>
<i>1537</i>&nbsp;                        ((XMLReader)parser).setFeature(&quot;http://xml.org/sax/features/namespace-prefixes&quot;, true);
<i>1538</i>&nbsp;                        namespacePrefixes = true;
<i>1539</i>&nbsp;                        if(parser instanceof SAXParser) {
<i>1540</i>&nbsp;                            Object stringsInternalized = this.fSchemaParser.getProperty(&quot;http://apache.org/xml/properties/security-manager&quot;);
<b class="nc"><i>1541</i>&nbsp;                            if(stringsInternalized != null) {</b>
<i>1542</i>&nbsp;                                ((XMLReader)parser).setProperty(&quot;http://apache.org/xml/properties/security-manager&quot;, stringsInternalized);
<b class="nc"><i>1543</i>&nbsp;                            }</b>
<i>1544</i>&nbsp;                        }
<i>1545</i>&nbsp;                    } catch (SAXException var19) {
<i>1546</i>&nbsp;                        ;
<i>1547</i>&nbsp;                    }
<i>1548</i>&nbsp;
<i>1549</i>&nbsp;                    try {
<i>1550</i>&nbsp;                        ((XMLReader)parser).setProperty(&quot;http://javax.xml.XMLConstants/property/accessExternalDTD&quot;, this.fAccessExternalDTD);
<i>1551</i>&nbsp;                    } catch (SAXNotRecognizedException var18) {
<i>1552</i>&nbsp;                        System.err.println(&quot;Warning: &quot; + parser.getClass().getName() + &quot;: &quot; + var18.getMessage());
<i>1553</i>&nbsp;                    }
<i>1554</i>&nbsp;                }
<i>1555</i>&nbsp;
<b class="nc"><i>1556</i>&nbsp;                boolean stringsInternalized1 = false;</b>
<i>1557</i>&nbsp;
<b class="nc"><i>1558</i>&nbsp;                try {</b>
<b class="nc"><i>1559</i>&nbsp;                    stringsInternalized1 = ((XMLReader)parser).getFeature(&quot;http://xml.org/sax/features/string-interning&quot;);</b>
<i>1560</i>&nbsp;                } catch (SAXException var17) {
<b class="nc"><i>1561</i>&nbsp;                    ;</b>
<b class="nc"><i>1562</i>&nbsp;                }</b>
<i>1563</i>&nbsp;
<b class="nc"><i>1564</i>&nbsp;                if(this.fXSContentHandler == null) {</b>
<b class="nc"><i>1565</i>&nbsp;                    this.fXSContentHandler = new SchemaContentHandler();</b>
<i>1566</i>&nbsp;                }
<b class="nc"><i>1567</i>&nbsp;</b>
<i>1568</i>&nbsp;                this.fXSContentHandler.reset(this.fSchemaParser, this.fSymbolTable, namespacePrefixes, stringsInternalized1);
<b class="nc"><i>1569</i>&nbsp;                ((XMLReader)parser).setContentHandler(this.fXSContentHandler);</b>
<b class="nc"><i>1570</i>&nbsp;                ((XMLReader)parser).setErrorHandler(this.fErrorReporter.getSAXErrorHandler());</b>
<b class="nc"><i>1571</i>&nbsp;                ((XMLReader)parser).parse(inputSource);</b>
<i>1572</i>&nbsp;
<b class="nc"><i>1573</i>&nbsp;                try {</b>
<b class="nc"><i>1574</i>&nbsp;                    ((XMLReader)parser).setContentHandler((ContentHandler)null);</b>
<b class="nc"><i>1575</i>&nbsp;                    ((XMLReader)parser).setErrorHandler((ErrorHandler)null);</b>
<i>1576</i>&nbsp;                } catch (Exception var16) {
<b class="nc"><i>1577</i>&nbsp;                    ;</b>
<b class="nc"><i>1578</i>&nbsp;                }</b>
<i>1579</i>&nbsp;
<b class="nc"><i>1580</i>&nbsp;                Document schemaDocument = this.fXSContentHandler.getDocument();</b>
<i>1581</i>&nbsp;                schemaElement = schemaDocument != null?DOMUtil.getRoot(schemaDocument):null;
<i>1582</i>&nbsp;                return this.getSchemaDocument0(ioe, schemaId, schemaElement);
<b class="nc"><i>1583</i>&nbsp;            }</b>
<i>1584</i>&nbsp;
<b class="nc"><i>1585</i>&nbsp;            hasInput = false;</b>
<i>1586</i>&nbsp;        } catch (SAXParseException var22) {
<i>1587</i>&nbsp;            throw XSDHandler.SAX2XNIUtil.createXMLParseException(var22);
<i>1588</i>&nbsp;        } catch (SAXException var23) {
<i>1589</i>&nbsp;            throw XSDHandler.SAX2XNIUtil.createXNIException(var23);
<i>1590</i>&nbsp;        } catch (IOException var24) {
<i>1591</i>&nbsp;            exception = var24;
<i>1592</i>&nbsp;        }
<i>1593</i>&nbsp;
<i>1594</i>&nbsp;        return this.getSchemaDocument1(mustResolve, hasInput, schemaSource, referElement, exception);
<i>1595</i>&nbsp;    }
<i>1596</i>&nbsp;
<i>1597</i>&nbsp;    private Element getSchemaDocument(String schemaNamespace, DOMInputSource schemaSource, boolean mustResolve, short referType, Element referElement) {
<b class="nc"><i>1598</i>&nbsp;        boolean hasInput = true;</b>
<b class="nc"><i>1599</i>&nbsp;        IOException exception = null;</b>
<b class="nc"><i>1600</i>&nbsp;        Element schemaElement = null;</b>
<b class="nc"><i>1601</i>&nbsp;        Element schemaRootElement = null;</b>
<b class="nc"><i>1602</i>&nbsp;        Node node = schemaSource.getNode();</b>
<i>1603</i>&nbsp;        short nodeType = -1;
<i>1604</i>&nbsp;        if(node != null) {
<b class="nc"><i>1605</i>&nbsp;            nodeType = node.getNodeType();</b>
<b class="nc"><i>1606</i>&nbsp;            if(nodeType == 9) {</b>
<i>1607</i>&nbsp;                schemaRootElement = DOMUtil.getRoot((Document)node);
<i>1608</i>&nbsp;            } else if(nodeType == 1) {
<i>1609</i>&nbsp;                schemaRootElement = (Element)node;
<i>1610</i>&nbsp;            }
<i>1611</i>&nbsp;        }
<i>1612</i>&nbsp;
<b class="nc"><i>1613</i>&nbsp;        try {</b>
<i>1614</i>&nbsp;            if(schemaRootElement != null) {
<i>1615</i>&nbsp;                XSDHandler.XSDKey ioe = null;
<i>1616</i>&nbsp;                String schemaId = null;
<b class="nc"><i>1617</i>&nbsp;                if(referType != 3) {</b>
<i>1618</i>&nbsp;                    schemaId = XMLEntityManager.expandSystemId(schemaSource.getSystemId(), schemaSource.getBaseSystemId(), false);
<i>1619</i>&nbsp;                    boolean isDocument = nodeType == 9;
<i>1620</i>&nbsp;                    if(!isDocument) {
<i>1621</i>&nbsp;                        Node parent = schemaRootElement.getParentNode();
<i>1622</i>&nbsp;                        if(parent != null) {
<i>1623</i>&nbsp;                            isDocument = parent.getNodeType() == 9;
<i>1624</i>&nbsp;                        }
<i>1625</i>&nbsp;                    }
<b class="nc"><i>1626</i>&nbsp;</b>
<b class="nc"><i>1627</i>&nbsp;                    if(isDocument) {</b>
<b class="nc"><i>1628</i>&nbsp;                        ioe = new XSDHandler.XSDKey(schemaId, referType, schemaNamespace);</b>
<i>1629</i>&nbsp;                        if((schemaElement = (Element)this.fTraversed.get(ioe)) != null) {
<b class="nc"><i>1630</i>&nbsp;                            this.fLastSchemaWasDuplicate = true;</b>
<i>1631</i>&nbsp;                            return schemaElement;
<i>1632</i>&nbsp;                        }
<i>1633</i>&nbsp;                    }
<i>1634</i>&nbsp;                }
<b class="nc"><i>1635</i>&nbsp;</b>
<b class="nc"><i>1636</i>&nbsp;                return this.getSchemaDocument0(ioe, schemaId, schemaRootElement);</b>
<b class="nc"><i>1637</i>&nbsp;            }</b>
<b class="nc"><i>1638</i>&nbsp;</b>
<b class="nc"><i>1639</i>&nbsp;            hasInput = false;</b>
<b class="nc"><i>1640</i>&nbsp;        } catch (IOException var16) {</b>
<b class="nc"><i>1641</i>&nbsp;            exception = var16;</b>
<b class="nc"><i>1642</i>&nbsp;        }</b>
<b class="nc"><i>1643</i>&nbsp;</b>
<b class="nc"><i>1644</i>&nbsp;        return this.getSchemaDocument1(mustResolve, hasInput, schemaSource, referElement, exception);</b>
<i>1645</i>&nbsp;    }
<b class="nc"><i>1646</i>&nbsp;</b>
<b class="nc"><i>1647</i>&nbsp;    private Element getSchemaDocument(String schemaNamespace, StAXInputSource schemaSource, boolean mustResolve, short referType, Element referElement) {</b>
<b class="nc"><i>1648</i>&nbsp;        Object exception = null;</b>
<i>1649</i>&nbsp;        Element schemaElement = null;
<i>1650</i>&nbsp;
<b class="nc"><i>1651</i>&nbsp;        try {</b>
<b class="nc"><i>1652</i>&nbsp;            boolean e = schemaSource.shouldConsumeRemainingContent();</b>
<b class="nc"><i>1653</i>&nbsp;            XMLStreamReader slw1 = schemaSource.getXMLStreamReader();</b>
<i>1654</i>&nbsp;            XMLEventReader eventReader = schemaSource.getXMLEventReader();
<b class="nc"><i>1655</i>&nbsp;            XSDHandler.XSDKey key = null;</b>
<i>1656</i>&nbsp;            String schemaId = null;
<i>1657</i>&nbsp;            if(referType != 3) {
<i>1658</i>&nbsp;                schemaId = XMLEntityManager.expandSystemId(schemaSource.getSystemId(), schemaSource.getBaseSystemId(), false);
<i>1659</i>&nbsp;                boolean schemaDocument = e;
<i>1660</i>&nbsp;                if(!e) {
<i>1661</i>&nbsp;                    if(slw1 != null) {
<i>1662</i>&nbsp;                        schemaDocument = slw1.getEventType() == 7;
<i>1663</i>&nbsp;                    } else {
<i>1664</i>&nbsp;                        schemaDocument = eventReader.peek().isStartDocument();
<i>1665</i>&nbsp;                    }
<i>1666</i>&nbsp;                }
<i>1667</i>&nbsp;
<i>1668</i>&nbsp;                if(schemaDocument) {
<b class="nc"><i>1669</i>&nbsp;                    key = new XSDHandler.XSDKey(schemaId, referType, schemaNamespace);</b>
<i>1670</i>&nbsp;                    if((schemaElement = (Element)this.fTraversed.get(key)) != null) {
<b class="nc"><i>1671</i>&nbsp;                        this.fLastSchemaWasDuplicate = true;</b>
<i>1672</i>&nbsp;                        return schemaElement;
<b class="nc"><i>1673</i>&nbsp;                    }</b>
<b class="nc"><i>1674</i>&nbsp;                }</b>
<b class="nc"><i>1675</i>&nbsp;            }</b>
<i>1676</i>&nbsp;
<i>1677</i>&nbsp;            if(this.fStAXSchemaParser == null) {
<i>1678</i>&nbsp;                this.fStAXSchemaParser = new StAXSchemaParser();
<i>1679</i>&nbsp;            }
<b class="nc"><i>1680</i>&nbsp;</b>
<i>1681</i>&nbsp;            this.fStAXSchemaParser.reset(this.fSchemaParser, this.fSymbolTable);
<i>1682</i>&nbsp;            if(slw1 != null) {
<i>1683</i>&nbsp;                this.fStAXSchemaParser.parse(slw1);
<b class="nc"><i>1684</i>&nbsp;                if(e) {</b>
<b class="nc"><i>1685</i>&nbsp;                    while(slw1.hasNext()) {</b>
<b class="nc"><i>1686</i>&nbsp;                        slw1.next();</b>
<b class="nc"><i>1687</i>&nbsp;                    }</b>
<i>1688</i>&nbsp;                }
<b class="nc"><i>1689</i>&nbsp;            } else {</b>
<b class="nc"><i>1690</i>&nbsp;                this.fStAXSchemaParser.parse(eventReader);</b>
<i>1691</i>&nbsp;                if(e) {
<b class="nc"><i>1692</i>&nbsp;                    while(eventReader.hasNext()) {</b>
<b class="nc"><i>1693</i>&nbsp;                        eventReader.nextEvent();</b>
<i>1694</i>&nbsp;                    }
<i>1695</i>&nbsp;                }
<b class="nc"><i>1696</i>&nbsp;            }</b>
<i>1697</i>&nbsp;
<i>1698</i>&nbsp;            Document schemaDocument1 = this.fStAXSchemaParser.getDocument();
<b class="nc"><i>1699</i>&nbsp;            schemaElement = schemaDocument1 != null?DOMUtil.getRoot(schemaDocument1):null;</b>
<b class="nc"><i>1700</i>&nbsp;            return this.getSchemaDocument0(key, schemaId, schemaElement);</b>
<b class="nc"><i>1701</i>&nbsp;        } catch (XMLStreamException var14) {</b>
<b class="nc"><i>1702</i>&nbsp;            StAXLocationWrapper slw = new StAXLocationWrapper();</b>
<b class="nc"><i>1703</i>&nbsp;            slw.setLocation(var14.getLocation());</b>
<i>1704</i>&nbsp;            throw new XMLParseException(slw, var14.getMessage(), var14);
<b class="nc"><i>1705</i>&nbsp;        } catch (IOException var15) {</b>
<i>1706</i>&nbsp;            return this.getSchemaDocument1(mustResolve, true, schemaSource, referElement, var15);
<b class="nc"><i>1707</i>&nbsp;        }</b>
<i>1708</i>&nbsp;    }
<i>1709</i>&nbsp;
<i>1710</i>&nbsp;    private Element getSchemaDocument0(XSDHandler.XSDKey key, String schemaId, Element schemaElement) {
<b class="nc"><i>1711</i>&nbsp;        if(key != null) {</b>
<i>1712</i>&nbsp;            this.fTraversed.put(key, schemaElement);
<i>1713</i>&nbsp;        }
<i>1714</i>&nbsp;
<b class="nc"><i>1715</i>&nbsp;        if(schemaId != null) {</b>
<b class="nc"><i>1716</i>&nbsp;            this.fDoc2SystemId.put(schemaElement, schemaId);</b>
<b class="nc"><i>1717</i>&nbsp;        }</b>
<i>1718</i>&nbsp;
<b class="nc"><i>1719</i>&nbsp;        this.fLastSchemaWasDuplicate = false;</b>
<b class="nc"><i>1720</i>&nbsp;        return schemaElement;</b>
<i>1721</i>&nbsp;    }
<b class="nc"><i>1722</i>&nbsp;</b>
<i>1723</i>&nbsp;    private Element getSchemaDocument1(boolean mustResolve, boolean hasInput, XMLInputSource schemaSource, Element referElement, IOException ioe) {
<i>1724</i>&nbsp;        if(mustResolve) {
<i>1725</i>&nbsp;            if(hasInput) {
<b class="nc"><i>1726</i>&nbsp;                this.reportSchemaError(&quot;schema_reference.4&quot;, new Object[]{schemaSource.getSystemId()}, referElement, ioe);</b>
<i>1727</i>&nbsp;            } else {
<b class="nc"><i>1728</i>&nbsp;                this.reportSchemaError(&quot;schema_reference.4&quot;, new Object[]{schemaSource == null?&quot;&quot;:schemaSource.getSystemId()}, referElement, ioe);</b>
<i>1729</i>&nbsp;            }
<b class="nc"><i>1730</i>&nbsp;        } else if(hasInput) {</b>
<i>1731</i>&nbsp;            this.reportSchemaWarning(&quot;schema_reference.4&quot;, new Object[]{schemaSource.getSystemId()}, referElement, ioe);
<i>1732</i>&nbsp;        }
<b class="nc"><i>1733</i>&nbsp;</b>
<b class="nc"><i>1734</i>&nbsp;        this.fLastSchemaWasDuplicate = false;</b>
<b class="nc"><i>1735</i>&nbsp;        return null;</b>
<i>1736</i>&nbsp;    }
<b class="nc"><i>1737</i>&nbsp;</b>
<i>1738</i>&nbsp;    private Element getSchemaDocument(XSInputSource schemaSource, XSDDescription desc) {
<b class="nc"><i>1739</i>&nbsp;        SchemaGrammar[] grammars = schemaSource.getGrammars();</b>
<b class="nc"><i>1740</i>&nbsp;        short referType = desc.getContextType();</b>
<i>1741</i>&nbsp;        if(grammars != null &amp;&amp; grammars.length &gt; 0) {
<b class="nc"><i>1742</i>&nbsp;            Vector components1 = this.expandGrammars(grammars);</b>
<i>1743</i>&nbsp;            if(this.fNamespaceGrowth || !this.existingGrammars(components1)) {
<b class="nc"><i>1744</i>&nbsp;                this.addGrammars(components1);</b>
<b class="nc"><i>1745</i>&nbsp;                if(referType == 3) {</b>
<i>1746</i>&nbsp;                    desc.setTargetNamespace(grammars[0].getTargetNamespace());
<b class="nc"><i>1747</i>&nbsp;                }</b>
<b class="nc"><i>1748</i>&nbsp;            }</b>
<b class="nc"><i>1749</i>&nbsp;        } else {</b>
<b class="nc"><i>1750</i>&nbsp;            XSObject[] components = schemaSource.getComponents();</b>
<b class="nc"><i>1751</i>&nbsp;            if(components != null &amp;&amp; components.length &gt; 0) {</b>
<i>1752</i>&nbsp;                HashMap importDependencies = new HashMap();
<b class="nc"><i>1753</i>&nbsp;                Vector expandedComponents = this.expandComponents(components, importDependencies);</b>
<i>1754</i>&nbsp;                if(this.fNamespaceGrowth || this.canAddComponents(expandedComponents)) {
<b class="nc"><i>1755</i>&nbsp;                    this.addGlobalComponents(expandedComponents, importDependencies);</b>
<i>1756</i>&nbsp;                    if(referType == 3) {
<b class="nc"><i>1757</i>&nbsp;                        desc.setTargetNamespace(components[0].getNamespace());</b>
<i>1758</i>&nbsp;                    }
<i>1759</i>&nbsp;                }
<i>1760</i>&nbsp;            }
<i>1761</i>&nbsp;        }
<i>1762</i>&nbsp;
<i>1763</i>&nbsp;        return null;
<i>1764</i>&nbsp;    }
<i>1765</i>&nbsp;
<i>1766</i>&nbsp;    private Vector expandGrammars(SchemaGrammar[] grammars) {
<i>1767</i>&nbsp;        Vector currGrammars = new Vector();
<i>1768</i>&nbsp;
<i>1769</i>&nbsp;        for(int sg1 = 0; sg1 &lt; grammars.length; ++sg1) {
<i>1770</i>&nbsp;            if(!currGrammars.contains(grammars[sg1])) {
<i>1771</i>&nbsp;                currGrammars.add(grammars[sg1]);
<b class="nc"><i>1772</i>&nbsp;            }</b>
<i>1773</i>&nbsp;        }
<b class="nc"><i>1774</i>&nbsp;</b>
<i>1775</i>&nbsp;        for(int i = 0; i &lt; currGrammars.size(); ++i) {
<i>1776</i>&nbsp;            SchemaGrammar var8 = (SchemaGrammar)currGrammars.elementAt(i);
<i>1777</i>&nbsp;            Vector gs = var8.getImportedGrammars();
<i>1778</i>&nbsp;            if(gs != null) {
<i>1779</i>&nbsp;                for(int j = gs.size() - 1; j &gt;= 0; --j) {
<i>1780</i>&nbsp;                    SchemaGrammar sg2 = (SchemaGrammar)gs.elementAt(j);
<i>1781</i>&nbsp;                    if(!currGrammars.contains(sg2)) {
<b class="nc"><i>1782</i>&nbsp;                        currGrammars.addElement(sg2);</b>
<i>1783</i>&nbsp;                    }
<i>1784</i>&nbsp;                }
<i>1785</i>&nbsp;            }
<i>1786</i>&nbsp;        }
<i>1787</i>&nbsp;
<i>1788</i>&nbsp;        return currGrammars;
<i>1789</i>&nbsp;    }
<i>1790</i>&nbsp;
<b class="nc"><i>1791</i>&nbsp;    private boolean existingGrammars(Vector grammars) {</b>
<b class="nc"><i>1792</i>&nbsp;        int length = grammars.size();</b>
<b class="nc"><i>1793</i>&nbsp;        XSDDescription desc = new XSDDescription();</b>
<b class="nc"><i>1794</i>&nbsp;</b>
<b class="nc"><i>1795</i>&nbsp;        for(int i = 0; i &lt; length; ++i) {</b>
<b class="nc"><i>1796</i>&nbsp;            SchemaGrammar sg1 = (SchemaGrammar)grammars.elementAt(i);</b>
<b class="nc"><i>1797</i>&nbsp;            desc.setNamespace(sg1.getTargetNamespace());</b>
<b class="nc"><i>1798</i>&nbsp;            SchemaGrammar sg2 = this.findGrammar(desc, false);</b>
<i>1799</i>&nbsp;            if(sg2 != null) {
<i>1800</i>&nbsp;                return true;
<i>1801</i>&nbsp;            }
<b class="nc"><i>1802</i>&nbsp;        }</b>
<b class="nc"><i>1803</i>&nbsp;</b>
<i>1804</i>&nbsp;        return false;
<i>1805</i>&nbsp;    }
<i>1806</i>&nbsp;
<b class="nc"><i>1807</i>&nbsp;    private boolean canAddComponents(Vector components) {</b>
<b class="nc"><i>1808</i>&nbsp;        int size = components.size();</b>
<b class="nc"><i>1809</i>&nbsp;        XSDDescription desc = new XSDDescription();</b>
<b class="nc"><i>1810</i>&nbsp;</b>
<b class="nc"><i>1811</i>&nbsp;        for(int i = 0; i &lt; size; ++i) {</b>
<b class="nc"><i>1812</i>&nbsp;            XSObject component = (XSObject)components.elementAt(i);</b>
<i>1813</i>&nbsp;            if(!this.canAddComponent(component, desc)) {
<i>1814</i>&nbsp;                return false;
<b class="nc"><i>1815</i>&nbsp;            }</b>
<i>1816</i>&nbsp;        }
<i>1817</i>&nbsp;
<b class="nc"><i>1818</i>&nbsp;        return true;</b>
<b class="nc"><i>1819</i>&nbsp;    }</b>
<i>1820</i>&nbsp;
<i>1821</i>&nbsp;    private boolean canAddComponent(XSObject component, XSDDescription desc) {
<i>1822</i>&nbsp;        desc.setNamespace(component.getNamespace());
<b class="nc"><i>1823</i>&nbsp;        SchemaGrammar sg = this.findGrammar(desc, false);</b>
<b class="nc"><i>1824</i>&nbsp;        if(sg == null) {</b>
<b class="nc"><i>1825</i>&nbsp;            return true;</b>
<i>1826</i>&nbsp;        } else if(sg.isImmutable()) {
<i>1827</i>&nbsp;            return false;
<i>1828</i>&nbsp;        } else {
<i>1829</i>&nbsp;            short componentType = component.getType();
<b class="nc"><i>1830</i>&nbsp;            String name = component.getName();</b>
<i>1831</i>&nbsp;            switch(componentType) {
<i>1832</i>&nbsp;            case 1:
<i>1833</i>&nbsp;                if(sg.getGlobalAttributeDecl(name) == component) {
<i>1834</i>&nbsp;                    return true;
<b class="nc"><i>1835</i>&nbsp;                }</b>
<b class="nc"><i>1836</i>&nbsp;                break;</b>
<i>1837</i>&nbsp;            case 2:
<i>1838</i>&nbsp;                if(sg.getGlobalElementDecl(name) == component) {
<i>1839</i>&nbsp;                    return true;
<i>1840</i>&nbsp;                }
<b class="nc"><i>1841</i>&nbsp;                break;</b>
<b class="nc"><i>1842</i>&nbsp;            case 3:</b>
<i>1843</i>&nbsp;                if(sg.getGlobalTypeDecl(name) == component) {
<i>1844</i>&nbsp;                    return true;
<i>1845</i>&nbsp;                }
<i>1846</i>&nbsp;                break;
<i>1847</i>&nbsp;            case 4:
<i>1848</i>&nbsp;            case 7:
<i>1849</i>&nbsp;            case 8:
<i>1850</i>&nbsp;            case 9:
<b class="nc"><i>1851</i>&nbsp;            case 10:</b>
<b class="nc"><i>1852</i>&nbsp;            default:</b>
<b class="nc"><i>1853</i>&nbsp;                return true;</b>
<b class="nc"><i>1854</i>&nbsp;            case 5:</b>
<b class="nc"><i>1855</i>&nbsp;                if(sg.getGlobalAttributeDecl(name) == component) {</b>
<b class="nc"><i>1856</i>&nbsp;                    return true;</b>
<b class="nc"><i>1857</i>&nbsp;                }</b>
<b class="nc"><i>1858</i>&nbsp;                break;</b>
<b class="nc"><i>1859</i>&nbsp;            case 6:</b>
<b class="nc"><i>1860</i>&nbsp;                if(sg.getGlobalGroupDecl(name) == component) {</b>
<b class="nc"><i>1861</i>&nbsp;                    return true;</b>
<i>1862</i>&nbsp;                }
<i>1863</i>&nbsp;                break;
<i>1864</i>&nbsp;            case 11:
<i>1865</i>&nbsp;                if(sg.getGlobalNotationDecl(name) == component) {
<i>1866</i>&nbsp;                    return true;
<b class="nc"><i>1867</i>&nbsp;                }</b>
<b class="nc"><i>1868</i>&nbsp;            }</b>
<b class="nc"><i>1869</i>&nbsp;</b>
<b class="nc"><i>1870</i>&nbsp;            return false;</b>
<i>1871</i>&nbsp;        }
<i>1872</i>&nbsp;    }
<i>1873</i>&nbsp;
<i>1874</i>&nbsp;    private void addGrammars(Vector grammars) {
<i>1875</i>&nbsp;        int length = grammars.size();
<b class="nc"><i>1876</i>&nbsp;        XSDDescription desc = new XSDDescription();</b>
<b class="nc"><i>1877</i>&nbsp;</b>
<b class="nc"><i>1878</i>&nbsp;        for(int i = 0; i &lt; length; ++i) {</b>
<b class="nc"><i>1879</i>&nbsp;            SchemaGrammar sg1 = (SchemaGrammar)grammars.elementAt(i);</b>
<b class="nc"><i>1880</i>&nbsp;            desc.setNamespace(sg1.getTargetNamespace());</b>
<b class="nc"><i>1881</i>&nbsp;            SchemaGrammar sg2 = this.findGrammar(desc, this.fNamespaceGrowth);</b>
<b class="nc"><i>1882</i>&nbsp;            if(sg1 != sg2) {</b>
<i>1883</i>&nbsp;                this.addGrammarComponents(sg1, sg2);
<b class="nc"><i>1884</i>&nbsp;            }</b>
<b class="nc"><i>1885</i>&nbsp;        }</b>
<b class="nc"><i>1886</i>&nbsp;</b>
<b class="nc"><i>1887</i>&nbsp;    }</b>
<b class="nc"><i>1888</i>&nbsp;</b>
<b class="nc"><i>1889</i>&nbsp;    private void addGrammarComponents(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {</b>
<b class="nc"><i>1890</i>&nbsp;        if(dstGrammar == null) {</b>
<i>1891</i>&nbsp;            this.createGrammarFrom(srcGrammar);
<b class="nc"><i>1892</i>&nbsp;        } else {</b>
<b class="nc"><i>1893</i>&nbsp;            SchemaGrammar tmpGrammar = dstGrammar;</b>
<b class="nc"><i>1894</i>&nbsp;            if(dstGrammar.isImmutable()) {</b>
<b class="nc"><i>1895</i>&nbsp;                tmpGrammar = this.createGrammarFrom(dstGrammar);</b>
<b class="nc"><i>1896</i>&nbsp;            }</b>
<b class="nc"><i>1897</i>&nbsp;</b>
<b class="nc"><i>1898</i>&nbsp;            this.addNewGrammarLocations(srcGrammar, tmpGrammar);</b>
<b class="nc"><i>1899</i>&nbsp;            this.addNewImportedGrammars(srcGrammar, tmpGrammar);</b>
<i>1900</i>&nbsp;            this.addNewGrammarComponents(srcGrammar, tmpGrammar);
<i>1901</i>&nbsp;        }
<b class="nc"><i>1902</i>&nbsp;    }</b>
<b class="nc"><i>1903</i>&nbsp;</b>
<b class="nc"><i>1904</i>&nbsp;    private SchemaGrammar createGrammarFrom(SchemaGrammar grammar) {</b>
<b class="nc"><i>1905</i>&nbsp;        SchemaGrammar newGrammar = new SchemaGrammar(grammar);</b>
<b class="nc"><i>1906</i>&nbsp;        this.fGrammarBucket.putGrammar(newGrammar);</b>
<i>1907</i>&nbsp;        this.updateImportListWith(newGrammar);
<b class="nc"><i>1908</i>&nbsp;        this.updateImportListFor(newGrammar);</b>
<i>1909</i>&nbsp;        return newGrammar;
<i>1910</i>&nbsp;    }
<b class="nc"><i>1911</i>&nbsp;</b>
<b class="nc"><i>1912</i>&nbsp;    private void addNewGrammarLocations(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {</b>
<b class="nc"><i>1913</i>&nbsp;        StringList locations = srcGrammar.getDocumentLocations();</b>
<b class="nc"><i>1914</i>&nbsp;        int locSize = locations.size();</b>
<b class="nc"><i>1915</i>&nbsp;        StringList locations2 = dstGrammar.getDocumentLocations();</b>
<i>1916</i>&nbsp;
<b class="nc"><i>1917</i>&nbsp;        for(int i = 0; i &lt; locSize; ++i) {</b>
<i>1918</i>&nbsp;            String loc = locations.item(i);
<i>1919</i>&nbsp;            if(!locations2.contains(loc)) {
<b class="nc"><i>1920</i>&nbsp;                dstGrammar.addDocument((Object)null, loc);</b>
<b class="nc"><i>1921</i>&nbsp;            }</b>
<i>1922</i>&nbsp;        }
<i>1923</i>&nbsp;
<i>1924</i>&nbsp;    }
<b class="nc"><i>1925</i>&nbsp;</b>
<b class="nc"><i>1926</i>&nbsp;    private void addNewImportedGrammars(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {</b>
<b class="nc"><i>1927</i>&nbsp;        Vector igs1 = srcGrammar.getImportedGrammars();</b>
<b class="nc"><i>1928</i>&nbsp;        if(igs1 != null) {</b>
<b class="nc"><i>1929</i>&nbsp;            Vector igs2 = dstGrammar.getImportedGrammars();</b>
<b class="nc"><i>1930</i>&nbsp;            if(igs2 == null) {</b>
<b class="nc"><i>1931</i>&nbsp;                igs2 = (Vector)igs1.clone();</b>
<b class="nc"><i>1932</i>&nbsp;                dstGrammar.setImportedGrammars(igs2);</b>
<b class="nc"><i>1933</i>&nbsp;            } else {</b>
<b class="nc"><i>1934</i>&nbsp;                this.updateImportList(igs1, igs2);</b>
<b class="nc"><i>1935</i>&nbsp;            }</b>
<i>1936</i>&nbsp;        }
<b class="nc"><i>1937</i>&nbsp;</b>
<b class="nc"><i>1938</i>&nbsp;    }</b>
<i>1939</i>&nbsp;
<i>1940</i>&nbsp;    private void updateImportList(Vector importedSrc, Vector importedDst) {
<b class="nc"><i>1941</i>&nbsp;        int size = importedSrc.size();</b>
<i>1942</i>&nbsp;
<i>1943</i>&nbsp;        for(int i = 0; i &lt; size; ++i) {
<i>1944</i>&nbsp;            SchemaGrammar sg = (SchemaGrammar)importedSrc.elementAt(i);
<i>1945</i>&nbsp;            if(!this.containedImportedGrammar(importedDst, sg)) {
<i>1946</i>&nbsp;                importedDst.add(sg);
<b class="nc"><i>1947</i>&nbsp;            }</b>
<i>1948</i>&nbsp;        }
<b class="nc"><i>1949</i>&nbsp;</b>
<b class="nc"><i>1950</i>&nbsp;    }</b>
<i>1951</i>&nbsp;
<b class="nc"><i>1952</i>&nbsp;    private void addNewGrammarComponents(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {</b>
<b class="nc"><i>1953</i>&nbsp;        dstGrammar.resetComponents();</b>
<i>1954</i>&nbsp;        this.addGlobalElementDecls(srcGrammar, dstGrammar);
<b class="nc"><i>1955</i>&nbsp;        this.addGlobalAttributeDecls(srcGrammar, dstGrammar);</b>
<i>1956</i>&nbsp;        this.addGlobalAttributeGroupDecls(srcGrammar, dstGrammar);
<i>1957</i>&nbsp;        this.addGlobalGroupDecls(srcGrammar, dstGrammar);
<i>1958</i>&nbsp;        this.addGlobalTypeDecls(srcGrammar, dstGrammar);
<b class="nc"><i>1959</i>&nbsp;        this.addGlobalNotationDecls(srcGrammar, dstGrammar);</b>
<b class="nc"><i>1960</i>&nbsp;    }</b>
<b class="nc"><i>1961</i>&nbsp;</b>
<b class="nc"><i>1962</i>&nbsp;    private void addGlobalElementDecls(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {</b>
<i>1963</i>&nbsp;        XSNamedMap components = srcGrammar.getComponents((short)2);
<i>1964</i>&nbsp;        int len = components.getLength();
<b class="nc"><i>1965</i>&nbsp;</b>
<i>1966</i>&nbsp;        XSElementDecl srcDecl;
<i>1967</i>&nbsp;        XSElementDecl dstDecl;
<b class="nc"><i>1968</i>&nbsp;        for(int componentsExt = 0; componentsExt &lt; len; ++componentsExt) {</b>
<i>1969</i>&nbsp;            srcDecl = (XSElementDecl)components.item(componentsExt);
<i>1970</i>&nbsp;            dstDecl = dstGrammar.getGlobalElementDecl(srcDecl.getName());
<i>1971</i>&nbsp;            if(dstDecl == null) {
<b class="nc"><i>1972</i>&nbsp;                dstGrammar.addGlobalElementDecl(srcDecl);</b>
<b class="nc"><i>1973</i>&nbsp;            } else if(dstDecl != srcDecl) {</b>
<b class="nc"><i>1974</i>&nbsp;                ;</b>
<b class="nc"><i>1975</i>&nbsp;            }</b>
<i>1976</i>&nbsp;        }
<i>1977</i>&nbsp;
<b class="nc"><i>1978</i>&nbsp;        ObjectList var13 = srcGrammar.getComponentsExt((short)2);</b>
<b class="nc"><i>1979</i>&nbsp;        len = var13.getLength();</b>
<i>1980</i>&nbsp;
<i>1981</i>&nbsp;        for(int i = 0; i &lt; len; i += 2) {
<b class="nc"><i>1982</i>&nbsp;            String key = (String)var13.item(i);</b>
<b class="nc"><i>1983</i>&nbsp;            int index = key.indexOf(44);</b>
<b class="nc"><i>1984</i>&nbsp;            String location = key.substring(0, index);</b>
<b class="nc"><i>1985</i>&nbsp;            String name = key.substring(index + 1, key.length());</b>
<i>1986</i>&nbsp;            srcDecl = (XSElementDecl)var13.item(i + 1);
<i>1987</i>&nbsp;            dstDecl = dstGrammar.getGlobalElementDecl(name, location);
<b class="nc"><i>1988</i>&nbsp;            if(dstDecl == null) {</b>
<b class="nc"><i>1989</i>&nbsp;                dstGrammar.addGlobalElementDecl(srcDecl, location);</b>
<b class="nc"><i>1990</i>&nbsp;            } else if(dstDecl != srcDecl) {</b>
<b class="nc"><i>1991</i>&nbsp;                ;</b>
<i>1992</i>&nbsp;            }
<i>1993</i>&nbsp;        }
<b class="nc"><i>1994</i>&nbsp;</b>
<i>1995</i>&nbsp;    }
<i>1996</i>&nbsp;
<b class="nc"><i>1997</i>&nbsp;    private void addGlobalAttributeDecls(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {</b>
<b class="nc"><i>1998</i>&nbsp;        XSNamedMap components = srcGrammar.getComponents((short)1);</b>
<i>1999</i>&nbsp;        int len = components.getLength();
<i>2000</i>&nbsp;
<b class="nc"><i>2001</i>&nbsp;        XSAttributeDecl srcDecl;</b>
<i>2002</i>&nbsp;        XSAttributeDecl dstDecl;
<i>2003</i>&nbsp;        for(int componentsExt = 0; componentsExt &lt; len; ++componentsExt) {
<b class="nc"><i>2004</i>&nbsp;            srcDecl = (XSAttributeDecl)components.item(componentsExt);</b>
<b class="nc"><i>2005</i>&nbsp;            dstDecl = dstGrammar.getGlobalAttributeDecl(srcDecl.getName());</b>
<i>2006</i>&nbsp;            if(dstDecl == null) {
<b class="nc"><i>2007</i>&nbsp;                dstGrammar.addGlobalAttributeDecl(srcDecl);</b>
<i>2008</i>&nbsp;            } else if(dstDecl != srcDecl &amp;&amp; !this.fTolerateDuplicates) {
<i>2009</i>&nbsp;                this.reportSharingError(srcDecl.getNamespace(), srcDecl.getName());
<b class="nc"><i>2010</i>&nbsp;            }</b>
<b class="nc"><i>2011</i>&nbsp;        }</b>
<i>2012</i>&nbsp;
<i>2013</i>&nbsp;        ObjectList var13 = srcGrammar.getComponentsExt((short)1);
<b class="nc"><i>2014</i>&nbsp;        len = var13.getLength();</b>
<i>2015</i>&nbsp;
<b class="nc"><i>2016</i>&nbsp;        for(int i = 0; i &lt; len; i += 2) {</b>
<b class="nc"><i>2017</i>&nbsp;            String key = (String)var13.item(i);</b>
<b class="nc"><i>2018</i>&nbsp;            int index = key.indexOf(44);</b>
<i>2019</i>&nbsp;            String location = key.substring(0, index);
<i>2020</i>&nbsp;            String name = key.substring(index + 1, key.length());
<b class="nc"><i>2021</i>&nbsp;            srcDecl = (XSAttributeDecl)var13.item(i + 1);</b>
<i>2022</i>&nbsp;            dstDecl = dstGrammar.getGlobalAttributeDecl(name, location);
<b class="nc"><i>2023</i>&nbsp;            if(dstDecl == null) {</b>
<b class="nc"><i>2024</i>&nbsp;                dstGrammar.addGlobalAttributeDecl(srcDecl, location);</b>
<i>2025</i>&nbsp;            } else if(dstDecl != srcDecl) {
<b class="nc"><i>2026</i>&nbsp;                ;</b>
<b class="nc"><i>2027</i>&nbsp;            }</b>
<b class="nc"><i>2028</i>&nbsp;        }</b>
<i>2029</i>&nbsp;
<b class="nc"><i>2030</i>&nbsp;    }</b>
<b class="nc"><i>2031</i>&nbsp;</b>
<i>2032</i>&nbsp;    private void addGlobalAttributeGroupDecls(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {
<i>2033</i>&nbsp;        XSNamedMap components = srcGrammar.getComponents((short)5);
<i>2034</i>&nbsp;        int len = components.getLength();
<i>2035</i>&nbsp;
<i>2036</i>&nbsp;        XSAttributeGroupDecl srcDecl;
<i>2037</i>&nbsp;        XSAttributeGroupDecl dstDecl;
<i>2038</i>&nbsp;        for(int componentsExt = 0; componentsExt &lt; len; ++componentsExt) {
<i>2039</i>&nbsp;            srcDecl = (XSAttributeGroupDecl)components.item(componentsExt);
<i>2040</i>&nbsp;            dstDecl = dstGrammar.getGlobalAttributeGroupDecl(srcDecl.getName());
<b class="nc"><i>2041</i>&nbsp;            if(dstDecl == null) {</b>
<i>2042</i>&nbsp;                dstGrammar.addGlobalAttributeGroupDecl(srcDecl);
<b class="nc"><i>2043</i>&nbsp;            } else if(dstDecl != srcDecl &amp;&amp; !this.fTolerateDuplicates) {</b>
<b class="nc"><i>2044</i>&nbsp;                this.reportSharingError(srcDecl.getNamespace(), srcDecl.getName());</b>
<i>2045</i>&nbsp;            }
<i>2046</i>&nbsp;        }
<b class="nc"><i>2047</i>&nbsp;</b>
<b class="nc"><i>2048</i>&nbsp;        ObjectList var13 = srcGrammar.getComponentsExt((short)5);</b>
<b class="nc"><i>2049</i>&nbsp;        len = var13.getLength();</b>
<i>2050</i>&nbsp;
<b class="nc"><i>2051</i>&nbsp;        for(int i = 0; i &lt; len; i += 2) {</b>
<b class="nc"><i>2052</i>&nbsp;            String key = (String)var13.item(i);</b>
<b class="nc"><i>2053</i>&nbsp;            int index = key.indexOf(44);</b>
<b class="nc"><i>2054</i>&nbsp;            String location = key.substring(0, index);</b>
<b class="nc"><i>2055</i>&nbsp;            String name = key.substring(index + 1, key.length());</b>
<b class="nc"><i>2056</i>&nbsp;            srcDecl = (XSAttributeGroupDecl)var13.item(i + 1);</b>
<b class="nc"><i>2057</i>&nbsp;            dstDecl = dstGrammar.getGlobalAttributeGroupDecl(name, location);</b>
<i>2058</i>&nbsp;            if(dstDecl == null) {
<b class="nc"><i>2059</i>&nbsp;                dstGrammar.addGlobalAttributeGroupDecl(srcDecl, location);</b>
<i>2060</i>&nbsp;            } else if(dstDecl != srcDecl) {
<b class="nc"><i>2061</i>&nbsp;                ;</b>
<b class="nc"><i>2062</i>&nbsp;            }</b>
<i>2063</i>&nbsp;        }
<i>2064</i>&nbsp;
<i>2065</i>&nbsp;    }
<i>2066</i>&nbsp;
<i>2067</i>&nbsp;    private void addGlobalNotationDecls(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {
<i>2068</i>&nbsp;        XSNamedMap components = srcGrammar.getComponents((short)11);
<b class="nc"><i>2069</i>&nbsp;        int len = components.getLength();</b>
<b class="nc"><i>2070</i>&nbsp;</b>
<b class="nc"><i>2071</i>&nbsp;        XSNotationDecl srcDecl;</b>
<b class="nc"><i>2072</i>&nbsp;        XSNotationDecl dstDecl;</b>
<b class="nc"><i>2073</i>&nbsp;        for(int componentsExt = 0; componentsExt &lt; len; ++componentsExt) {</b>
<b class="nc"><i>2074</i>&nbsp;            srcDecl = (XSNotationDecl)components.item(componentsExt);</b>
<b class="nc"><i>2075</i>&nbsp;            dstDecl = dstGrammar.getGlobalNotationDecl(srcDecl.getName());</b>
<i>2076</i>&nbsp;            if(dstDecl == null) {
<b class="nc"><i>2077</i>&nbsp;                dstGrammar.addGlobalNotationDecl(srcDecl);</b>
<b class="nc"><i>2078</i>&nbsp;            } else if(dstDecl != srcDecl &amp;&amp; !this.fTolerateDuplicates) {</b>
<b class="nc"><i>2079</i>&nbsp;                this.reportSharingError(srcDecl.getNamespace(), srcDecl.getName());</b>
<i>2080</i>&nbsp;            }
<i>2081</i>&nbsp;        }
<b class="nc"><i>2082</i>&nbsp;</b>
<i>2083</i>&nbsp;        ObjectList var13 = srcGrammar.getComponentsExt((short)11);
<i>2084</i>&nbsp;        len = var13.getLength();
<i>2085</i>&nbsp;
<i>2086</i>&nbsp;        for(int i = 0; i &lt; len; i += 2) {
<i>2087</i>&nbsp;            String key = (String)var13.item(i);
<i>2088</i>&nbsp;            int index = key.indexOf(44);
<i>2089</i>&nbsp;            String location = key.substring(0, index);
<i>2090</i>&nbsp;            String name = key.substring(index + 1, key.length());
<i>2091</i>&nbsp;            srcDecl = (XSNotationDecl)var13.item(i + 1);
<i>2092</i>&nbsp;            dstDecl = dstGrammar.getGlobalNotationDecl(name, location);
<i>2093</i>&nbsp;            if(dstDecl == null) {
<b class="nc"><i>2094</i>&nbsp;                dstGrammar.addGlobalNotationDecl(srcDecl, location);</b>
<i>2095</i>&nbsp;            } else if(dstDecl != srcDecl) {
<b class="nc"><i>2096</i>&nbsp;                ;</b>
<b class="nc"><i>2097</i>&nbsp;            }</b>
<b class="nc"><i>2098</i>&nbsp;        }</b>
<b class="nc"><i>2099</i>&nbsp;</b>
<b class="nc"><i>2100</i>&nbsp;    }</b>
<b class="nc"><i>2101</i>&nbsp;</b>
<b class="nc"><i>2102</i>&nbsp;    private void addGlobalGroupDecls(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {</b>
<b class="nc"><i>2103</i>&nbsp;        XSNamedMap components = srcGrammar.getComponents((short)6);</b>
<b class="nc"><i>2104</i>&nbsp;        int len = components.getLength();</b>
<b class="nc"><i>2105</i>&nbsp;</b>
<b class="nc"><i>2106</i>&nbsp;        XSGroupDecl srcDecl;</b>
<b class="nc"><i>2107</i>&nbsp;        XSGroupDecl dstDecl;</b>
<b class="nc"><i>2108</i>&nbsp;        for(int componentsExt = 0; componentsExt &lt; len; ++componentsExt) {</b>
<b class="nc"><i>2109</i>&nbsp;            srcDecl = (XSGroupDecl)components.item(componentsExt);</b>
<b class="nc"><i>2110</i>&nbsp;            dstDecl = dstGrammar.getGlobalGroupDecl(srcDecl.getName());</b>
<b class="nc"><i>2111</i>&nbsp;            if(dstDecl == null) {</b>
<b class="nc"><i>2112</i>&nbsp;                dstGrammar.addGlobalGroupDecl(srcDecl);</b>
<b class="nc"><i>2113</i>&nbsp;            } else if(srcDecl != dstDecl &amp;&amp; !this.fTolerateDuplicates) {</b>
<i>2114</i>&nbsp;                this.reportSharingError(srcDecl.getNamespace(), srcDecl.getName());
<i>2115</i>&nbsp;            }
<b class="nc"><i>2116</i>&nbsp;        }</b>
<b class="nc"><i>2117</i>&nbsp;</b>
<b class="nc"><i>2118</i>&nbsp;        ObjectList var13 = srcGrammar.getComponentsExt((short)6);</b>
<b class="nc"><i>2119</i>&nbsp;        len = var13.getLength();</b>
<b class="nc"><i>2120</i>&nbsp;</b>
<b class="nc"><i>2121</i>&nbsp;        for(int i = 0; i &lt; len; i += 2) {</b>
<i>2122</i>&nbsp;            String key = (String)var13.item(i);
<i>2123</i>&nbsp;            int index = key.indexOf(44);
<i>2124</i>&nbsp;            String location = key.substring(0, index);
<i>2125</i>&nbsp;            String name = key.substring(index + 1, key.length());
<i>2126</i>&nbsp;            srcDecl = (XSGroupDecl)var13.item(i + 1);
<i>2127</i>&nbsp;            dstDecl = dstGrammar.getGlobalGroupDecl(name, location);
<i>2128</i>&nbsp;            if(dstDecl == null) {
<i>2129</i>&nbsp;                dstGrammar.addGlobalGroupDecl(srcDecl, location);
<i>2130</i>&nbsp;            } else if(dstDecl != srcDecl) {
<i>2131</i>&nbsp;                ;
<i>2132</i>&nbsp;            }
<i>2133</i>&nbsp;        }
<i>2134</i>&nbsp;
<b class="nc"><i>2135</i>&nbsp;    }</b>
<i>2136</i>&nbsp;
<i>2137</i>&nbsp;    private void addGlobalTypeDecls(SchemaGrammar srcGrammar, SchemaGrammar dstGrammar) {
<b class="nc"><i>2138</i>&nbsp;        XSNamedMap components = srcGrammar.getComponents((short)3);</b>
<i>2139</i>&nbsp;        int len = components.getLength();
<b class="nc"><i>2140</i>&nbsp;</b>
<b class="nc"><i>2141</i>&nbsp;        XSTypeDefinition srcDecl;</b>
<i>2142</i>&nbsp;        XSTypeDefinition dstDecl;
<i>2143</i>&nbsp;        for(int componentsExt = 0; componentsExt &lt; len; ++componentsExt) {
<i>2144</i>&nbsp;            srcDecl = (XSTypeDefinition)components.item(componentsExt);
<b class="nc"><i>2145</i>&nbsp;            dstDecl = dstGrammar.getGlobalTypeDecl(srcDecl.getName());</b>
<b class="nc"><i>2146</i>&nbsp;            if(dstDecl == null) {</b>
<b class="nc"><i>2147</i>&nbsp;                dstGrammar.addGlobalTypeDecl(srcDecl);</b>
<b class="nc"><i>2148</i>&nbsp;            } else if(dstDecl != srcDecl &amp;&amp; !this.fTolerateDuplicates) {</b>
<b class="nc"><i>2149</i>&nbsp;                this.reportSharingError(srcDecl.getNamespace(), srcDecl.getName());</b>
<i>2150</i>&nbsp;            }
<i>2151</i>&nbsp;        }
<b class="nc"><i>2152</i>&nbsp;</b>
<b class="nc"><i>2153</i>&nbsp;        ObjectList var13 = srcGrammar.getComponentsExt((short)3);</b>
<b class="nc"><i>2154</i>&nbsp;        len = var13.getLength();</b>
<i>2155</i>&nbsp;
<i>2156</i>&nbsp;        for(int i = 0; i &lt; len; i += 2) {
<b class="nc"><i>2157</i>&nbsp;            String key = (String)var13.item(i);</b>
<b class="nc"><i>2158</i>&nbsp;            int index = key.indexOf(44);</b>
<b class="nc"><i>2159</i>&nbsp;            String location = key.substring(0, index);</b>
<i>2160</i>&nbsp;            String name = key.substring(index + 1, key.length());
<b class="nc"><i>2161</i>&nbsp;            srcDecl = (XSTypeDefinition)var13.item(i + 1);</b>
<i>2162</i>&nbsp;            dstDecl = dstGrammar.getGlobalTypeDecl(name, location);
<i>2163</i>&nbsp;            if(dstDecl == null) {
<b class="nc"><i>2164</i>&nbsp;                dstGrammar.addGlobalTypeDecl(srcDecl, location);</b>
<b class="nc"><i>2165</i>&nbsp;            } else if(dstDecl != srcDecl) {</b>
<i>2166</i>&nbsp;                ;
<i>2167</i>&nbsp;            }
<i>2168</i>&nbsp;        }
<b class="nc"><i>2169</i>&nbsp;</b>
<b class="nc"><i>2170</i>&nbsp;    }</b>
<i>2171</i>&nbsp;
<b class="nc"><i>2172</i>&nbsp;    private Vector expandComponents(XSObject[] components, Map&lt;String, Vector&gt; dependencies) {</b>
<b class="nc"><i>2173</i>&nbsp;        Vector newComponents = new Vector();</b>
<b class="nc"><i>2174</i>&nbsp;</b>
<b class="nc"><i>2175</i>&nbsp;        int i;</b>
<i>2176</i>&nbsp;        for(i = 0; i &lt; components.length; ++i) {
<i>2177</i>&nbsp;            if(!newComponents.contains(components[i])) {
<b class="nc"><i>2178</i>&nbsp;                newComponents.add(components[i]);</b>
<b class="nc"><i>2179</i>&nbsp;            }</b>
<i>2180</i>&nbsp;        }
<i>2181</i>&nbsp;
<b class="nc"><i>2182</i>&nbsp;        for(i = 0; i &lt; newComponents.size(); ++i) {</b>
<b class="nc"><i>2183</i>&nbsp;            XSObject component = (XSObject)newComponents.elementAt(i);</b>
<i>2184</i>&nbsp;            this.expandRelatedComponents(component, newComponents, dependencies);
<b class="nc"><i>2185</i>&nbsp;        }</b>
<i>2186</i>&nbsp;
<i>2187</i>&nbsp;        return newComponents;
<b class="nc"><i>2188</i>&nbsp;    }</b>
<b class="nc"><i>2189</i>&nbsp;</b>
<b class="nc"><i>2190</i>&nbsp;    private void expandRelatedComponents(XSObject component, Vector componentList, Map&lt;String, Vector&gt; dependencies) {</b>
<i>2191</i>&nbsp;        short componentType = component.getType();
<b class="nc"><i>2192</i>&nbsp;        switch(componentType) {</b>
<i>2193</i>&nbsp;        case 1:
<i>2194</i>&nbsp;            this.expandRelatedAttributeComponents((XSAttributeDeclaration)component, componentList, component.getNamespace(), dependencies);
<i>2195</i>&nbsp;            break;
<b class="nc"><i>2196</i>&nbsp;        case 3:</b>
<i>2197</i>&nbsp;            this.expandRelatedTypeComponents((XSTypeDefinition)component, componentList, component.getNamespace(), dependencies);
<i>2198</i>&nbsp;        case 4:
<b class="nc"><i>2199</i>&nbsp;        case 7:</b>
<i>2200</i>&nbsp;        case 8:
<i>2201</i>&nbsp;        case 9:
<b class="nc"><i>2202</i>&nbsp;        case 10:</b>
<i>2203</i>&nbsp;        case 11:
<i>2204</i>&nbsp;        default:
<i>2205</i>&nbsp;            break;
<i>2206</i>&nbsp;        case 5:
<i>2207</i>&nbsp;            this.expandRelatedAttributeGroupComponents((XSAttributeGroupDefinition)component, componentList, component.getNamespace(), dependencies);
<i>2208</i>&nbsp;        case 2:
<i>2209</i>&nbsp;            this.expandRelatedElementComponents((XSElementDeclaration)component, componentList, component.getNamespace(), dependencies);
<i>2210</i>&nbsp;            break;
<i>2211</i>&nbsp;        case 6:
<i>2212</i>&nbsp;            this.expandRelatedModelGroupDefinitionComponents((XSModelGroupDefinition)component, componentList, component.getNamespace(), dependencies);
<i>2213</i>&nbsp;        }
<i>2214</i>&nbsp;
<i>2215</i>&nbsp;    }
<b class="nc"><i>2216</i>&nbsp;</b>
<b class="nc"><i>2217</i>&nbsp;    private void expandRelatedAttributeComponents(XSAttributeDeclaration decl, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {</b>
<b class="nc"><i>2218</i>&nbsp;        this.addRelatedType(decl.getTypeDefinition(), componentList, namespace, dependencies);</b>
<b class="nc"><i>2219</i>&nbsp;    }</b>
<i>2220</i>&nbsp;
<i>2221</i>&nbsp;    private void expandRelatedElementComponents(XSElementDeclaration decl, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<b class="nc"><i>2222</i>&nbsp;        this.addRelatedType(decl.getTypeDefinition(), componentList, namespace, dependencies);</b>
<b class="nc"><i>2223</i>&nbsp;        XSElementDeclaration subElemDecl = decl.getSubstitutionGroupAffiliation();</b>
<b class="nc"><i>2224</i>&nbsp;        if(subElemDecl != null) {</b>
<i>2225</i>&nbsp;            this.addRelatedElement(subElemDecl, componentList, namespace, dependencies);
<b class="nc"><i>2226</i>&nbsp;        }</b>
<b class="nc"><i>2227</i>&nbsp;</b>
<i>2228</i>&nbsp;    }
<i>2229</i>&nbsp;
<b class="nc"><i>2230</i>&nbsp;    private void expandRelatedTypeComponents(XSTypeDefinition type, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {</b>
<b class="nc"><i>2231</i>&nbsp;        if(type instanceof XSComplexTypeDecl) {</b>
<b class="nc"><i>2232</i>&nbsp;            this.expandRelatedComplexTypeComponents((XSComplexTypeDecl)type, componentList, namespace, dependencies);</b>
<i>2233</i>&nbsp;        } else if(type instanceof XSSimpleTypeDecl) {
<i>2234</i>&nbsp;            this.expandRelatedSimpleTypeComponents((XSSimpleTypeDefinition)type, componentList, namespace, dependencies);
<b class="nc"><i>2235</i>&nbsp;        }</b>
<b class="nc"><i>2236</i>&nbsp;</b>
<b class="nc"><i>2237</i>&nbsp;    }</b>
<i>2238</i>&nbsp;
<i>2239</i>&nbsp;    private void expandRelatedModelGroupDefinitionComponents(XSModelGroupDefinition modelGroupDef, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<b class="nc"><i>2240</i>&nbsp;        this.expandRelatedModelGroupComponents(modelGroupDef.getModelGroup(), componentList, namespace, dependencies);</b>
<i>2241</i>&nbsp;    }
<i>2242</i>&nbsp;
<i>2243</i>&nbsp;    private void expandRelatedAttributeGroupComponents(XSAttributeGroupDefinition attrGroup, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<i>2244</i>&nbsp;        this.expandRelatedAttributeUsesComponents(attrGroup.getAttributeUses(), componentList, namespace, dependencies);
<i>2245</i>&nbsp;    }
<i>2246</i>&nbsp;
<i>2247</i>&nbsp;    private void expandRelatedComplexTypeComponents(XSComplexTypeDecl type, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<b class="nc"><i>2248</i>&nbsp;        this.addRelatedType(type.getBaseType(), componentList, namespace, dependencies);</b>
<b class="nc"><i>2249</i>&nbsp;        this.expandRelatedAttributeUsesComponents(type.getAttributeUses(), componentList, namespace, dependencies);</b>
<i>2250</i>&nbsp;        XSParticle particle = type.getParticle();
<i>2251</i>&nbsp;        if(particle != null) {
<b class="nc"><i>2252</i>&nbsp;            this.expandRelatedParticleComponents(particle, componentList, namespace, dependencies);</b>
<i>2253</i>&nbsp;        }
<i>2254</i>&nbsp;
<b class="nc"><i>2255</i>&nbsp;    }</b>
<i>2256</i>&nbsp;
<i>2257</i>&nbsp;    private void expandRelatedSimpleTypeComponents(XSSimpleTypeDefinition type, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<i>2258</i>&nbsp;        XSTypeDefinition baseType = type.getBaseType();
<b class="nc"><i>2259</i>&nbsp;        if(baseType != null) {</b>
<b class="nc"><i>2260</i>&nbsp;            this.addRelatedType(baseType, componentList, namespace, dependencies);</b>
<b class="nc"><i>2261</i>&nbsp;        }</b>
<b class="nc"><i>2262</i>&nbsp;</b>
<b class="nc"><i>2263</i>&nbsp;        XSSimpleTypeDefinition itemType = type.getItemType();</b>
<i>2264</i>&nbsp;        if(itemType != null) {
<i>2265</i>&nbsp;            this.addRelatedType(itemType, componentList, namespace, dependencies);
<b class="nc"><i>2266</i>&nbsp;        }</b>
<b class="nc"><i>2267</i>&nbsp;</b>
<i>2268</i>&nbsp;        XSSimpleTypeDefinition primitiveType = type.getPrimitiveType();
<b class="nc"><i>2269</i>&nbsp;        if(primitiveType != null) {</b>
<b class="nc"><i>2270</i>&nbsp;            this.addRelatedType(primitiveType, componentList, namespace, dependencies);</b>
<i>2271</i>&nbsp;        }
<i>2272</i>&nbsp;
<i>2273</i>&nbsp;        XSObjectList memberTypes = type.getMemberTypes();
<b class="nc"><i>2274</i>&nbsp;        if(memberTypes.size() &gt; 0) {</b>
<b class="nc"><i>2275</i>&nbsp;            for(int i = 0; i &lt; memberTypes.size(); ++i) {</b>
<b class="nc"><i>2276</i>&nbsp;                this.addRelatedType((XSTypeDefinition)memberTypes.item(i), componentList, namespace, dependencies);</b>
<i>2277</i>&nbsp;            }
<i>2278</i>&nbsp;        }
<b class="nc"><i>2279</i>&nbsp;</b>
<b class="nc"><i>2280</i>&nbsp;    }</b>
<b class="nc"><i>2281</i>&nbsp;</b>
<i>2282</i>&nbsp;    private void expandRelatedAttributeUsesComponents(XSObjectList attrUses, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<b class="nc"><i>2283</i>&nbsp;        int attrUseSize = attrUses == null?0:attrUses.size();</b>
<b class="nc"><i>2284</i>&nbsp;</b>
<i>2285</i>&nbsp;        for(int i = 0; i &lt; attrUseSize; ++i) {
<i>2286</i>&nbsp;            this.expandRelatedAttributeUseComponents((XSAttributeUse)attrUses.item(i), componentList, namespace, dependencies);
<b class="nc"><i>2287</i>&nbsp;        }</b>
<b class="nc"><i>2288</i>&nbsp;</b>
<i>2289</i>&nbsp;    }
<b class="nc"><i>2290</i>&nbsp;</b>
<i>2291</i>&nbsp;    private void expandRelatedAttributeUseComponents(XSAttributeUse component, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<i>2292</i>&nbsp;        this.addRelatedAttribute(component.getAttrDeclaration(), componentList, namespace, dependencies);
<b class="nc"><i>2293</i>&nbsp;    }</b>
<b class="nc"><i>2294</i>&nbsp;</b>
<b class="nc"><i>2295</i>&nbsp;    private void expandRelatedParticleComponents(XSParticle component, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {</b>
<i>2296</i>&nbsp;        XSTerm term = component.getTerm();
<i>2297</i>&nbsp;        switch(term.getType()) {
<b class="nc"><i>2298</i>&nbsp;        case 2:</b>
<i>2299</i>&nbsp;            this.addRelatedElement((XSElementDeclaration)term, componentList, namespace, dependencies);
<i>2300</i>&nbsp;            break;
<i>2301</i>&nbsp;        case 7:
<i>2302</i>&nbsp;            this.expandRelatedModelGroupComponents((XSModelGroup)term, componentList, namespace, dependencies);
<i>2303</i>&nbsp;        }
<i>2304</i>&nbsp;
<i>2305</i>&nbsp;    }
<b class="nc"><i>2306</i>&nbsp;</b>
<b class="nc"><i>2307</i>&nbsp;    private void expandRelatedModelGroupComponents(XSModelGroup modelGroup, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {</b>
<i>2308</i>&nbsp;        XSObjectList particles = modelGroup.getParticles();
<i>2309</i>&nbsp;        int length = particles == null?0:particles.getLength();
<b class="nc"><i>2310</i>&nbsp;</b>
<i>2311</i>&nbsp;        for(int i = 0; i &lt; length; ++i) {
<i>2312</i>&nbsp;            this.expandRelatedParticleComponents((XSParticle)particles.item(i), componentList, namespace, dependencies);
<i>2313</i>&nbsp;        }
<i>2314</i>&nbsp;
<i>2315</i>&nbsp;    }
<i>2316</i>&nbsp;
<i>2317</i>&nbsp;    private void addRelatedType(XSTypeDefinition type, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<i>2318</i>&nbsp;        if(!type.getAnonymous()) {
<b class="nc"><i>2319</i>&nbsp;            if(!type.getNamespace().equals(SchemaSymbols.URI_SCHEMAFORSCHEMA) &amp;&amp; !componentList.contains(type)) {</b>
<b class="nc"><i>2320</i>&nbsp;                Vector importedNamespaces = this.findDependentNamespaces(namespace, dependencies);</b>
<b class="nc"><i>2321</i>&nbsp;                this.addNamespaceDependency(namespace, type.getNamespace(), importedNamespaces);</b>
<i>2322</i>&nbsp;                componentList.add(type);
<b class="nc"><i>2323</i>&nbsp;            }</b>
<b class="nc"><i>2324</i>&nbsp;        } else {</b>
<b class="nc"><i>2325</i>&nbsp;            this.expandRelatedTypeComponents(type, componentList, namespace, dependencies);</b>
<i>2326</i>&nbsp;        }
<b class="nc"><i>2327</i>&nbsp;</b>
<i>2328</i>&nbsp;    }
<i>2329</i>&nbsp;
<i>2330</i>&nbsp;    private void addRelatedElement(XSElementDeclaration decl, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {
<b class="nc"><i>2331</i>&nbsp;        if(decl.getScope() == 1) {</b>
<b class="nc"><i>2332</i>&nbsp;            if(!componentList.contains(decl)) {</b>
<i>2333</i>&nbsp;                Vector importedNamespaces = this.findDependentNamespaces(namespace, dependencies);
<b class="nc"><i>2334</i>&nbsp;                this.addNamespaceDependency(namespace, decl.getNamespace(), importedNamespaces);</b>
<b class="nc"><i>2335</i>&nbsp;                componentList.add(decl);</b>
<b class="nc"><i>2336</i>&nbsp;            }</b>
<b class="nc"><i>2337</i>&nbsp;        } else {</b>
<i>2338</i>&nbsp;            this.expandRelatedElementComponents(decl, componentList, namespace, dependencies);
<b class="nc"><i>2339</i>&nbsp;        }</b>
<b class="nc"><i>2340</i>&nbsp;</b>
<b class="nc"><i>2341</i>&nbsp;    }</b>
<i>2342</i>&nbsp;
<b class="nc"><i>2343</i>&nbsp;    private void addRelatedAttribute(XSAttributeDeclaration decl, Vector componentList, String namespace, Map&lt;String, Vector&gt; dependencies) {</b>
<i>2344</i>&nbsp;        if(decl.getScope() == 1) {
<i>2345</i>&nbsp;            if(!componentList.contains(decl)) {
<i>2346</i>&nbsp;                Vector importedNamespaces = this.findDependentNamespaces(namespace, dependencies);
<b class="nc"><i>2347</i>&nbsp;                this.addNamespaceDependency(namespace, decl.getNamespace(), importedNamespaces);</b>
<b class="nc"><i>2348</i>&nbsp;                componentList.add(decl);</b>
<i>2349</i>&nbsp;            }
<b class="nc"><i>2350</i>&nbsp;        } else {</b>
<i>2351</i>&nbsp;            this.expandRelatedAttributeComponents(decl, componentList, namespace, dependencies);
<b class="nc"><i>2352</i>&nbsp;        }</b>
<i>2353</i>&nbsp;
<b class="nc"><i>2354</i>&nbsp;    }</b>
<i>2355</i>&nbsp;
<i>2356</i>&nbsp;    private void addGlobalComponents(Vector components, Map&lt;String, Vector&gt; importDependencies) {
<i>2357</i>&nbsp;        XSDDescription desc = new XSDDescription();
<i>2358</i>&nbsp;        int size = components.size();
<i>2359</i>&nbsp;
<i>2360</i>&nbsp;        for(int i = 0; i &lt; size; ++i) {
<i>2361</i>&nbsp;            this.addGlobalComponent((XSObject)components.elementAt(i), desc);
<i>2362</i>&nbsp;        }
<i>2363</i>&nbsp;
<i>2364</i>&nbsp;        this.updateImportDependencies(importDependencies);
<i>2365</i>&nbsp;    }
<i>2366</i>&nbsp;
<i>2367</i>&nbsp;    private void addGlobalComponent(XSObject component, XSDDescription desc) {
<i>2368</i>&nbsp;        String namespace = component.getNamespace();
<i>2369</i>&nbsp;        desc.setNamespace(namespace);
<i>2370</i>&nbsp;        SchemaGrammar sg = this.getSchemaGrammar(desc);
<i>2371</i>&nbsp;        short componentType = component.getType();
<b class="nc"><i>2372</i>&nbsp;        String name = component.getName();</b>
<b class="nc"><i>2373</i>&nbsp;        switch(componentType) {</b>
<b class="nc"><i>2374</i>&nbsp;        case 1:</b>
<b class="nc"><i>2375</i>&nbsp;            if(((XSAttributeDecl)component).getScope() == 1) {</b>
<b class="nc"><i>2376</i>&nbsp;                if(sg.getGlobalAttributeDecl(name) == null) {</b>
<b class="nc"><i>2377</i>&nbsp;                    sg.addGlobalAttributeDecl((XSAttributeDecl)component);</b>
<b class="nc"><i>2378</i>&nbsp;                }</b>
<b class="nc"><i>2379</i>&nbsp;</b>
<b class="nc"><i>2380</i>&nbsp;                if(sg.getGlobalAttributeDecl(name, &quot;&quot;) == null) {</b>
<b class="nc"><i>2381</i>&nbsp;                    sg.addGlobalAttributeDecl((XSAttributeDecl)component, &quot;&quot;);</b>
<b class="nc"><i>2382</i>&nbsp;                }</b>
<b class="nc"><i>2383</i>&nbsp;            }</b>
<i>2384</i>&nbsp;            break;
<i>2385</i>&nbsp;        case 2:
<i>2386</i>&nbsp;            if(((XSElementDecl)component).getScope() == 1) {
<i>2387</i>&nbsp;                sg.addGlobalElementDeclAll((XSElementDecl)component);
<i>2388</i>&nbsp;                if(sg.getGlobalElementDecl(name) == null) {
<i>2389</i>&nbsp;                    sg.addGlobalElementDecl((XSElementDecl)component);
<i>2390</i>&nbsp;                }
<i>2391</i>&nbsp;
<i>2392</i>&nbsp;                if(sg.getGlobalElementDecl(name, &quot;&quot;) == null) {
<i>2393</i>&nbsp;                    sg.addGlobalElementDecl((XSElementDecl)component, &quot;&quot;);
<i>2394</i>&nbsp;                }
<b class="nc"><i>2395</i>&nbsp;            }</b>
<b class="nc"><i>2396</i>&nbsp;            break;</b>
<b class="nc"><i>2397</i>&nbsp;        case 3:</b>
<b class="nc"><i>2398</i>&nbsp;            if(!((XSTypeDefinition)component).getAnonymous()) {</b>
<b class="nc"><i>2399</i>&nbsp;                if(sg.getGlobalTypeDecl(name) == null) {</b>
<b class="nc"><i>2400</i>&nbsp;                    sg.addGlobalTypeDecl((XSTypeDefinition)component);</b>
<i>2401</i>&nbsp;                }
<b class="nc"><i>2402</i>&nbsp;</b>
<b class="nc"><i>2403</i>&nbsp;                if(sg.getGlobalTypeDecl(name, &quot;&quot;) == null) {</b>
<b class="nc"><i>2404</i>&nbsp;                    sg.addGlobalTypeDecl((XSTypeDefinition)component, &quot;&quot;);</b>
<b class="nc"><i>2405</i>&nbsp;                }</b>
<b class="nc"><i>2406</i>&nbsp;            }</b>
<b class="nc"><i>2407</i>&nbsp;        case 4:</b>
<b class="nc"><i>2408</i>&nbsp;        case 7:</b>
<b class="nc"><i>2409</i>&nbsp;        case 8:</b>
<b class="nc"><i>2410</i>&nbsp;        case 9:</b>
<i>2411</i>&nbsp;        case 10:
<i>2412</i>&nbsp;        default:
<b class="nc"><i>2413</i>&nbsp;            break;</b>
<b class="nc"><i>2414</i>&nbsp;        case 5:</b>
<b class="nc"><i>2415</i>&nbsp;            if(sg.getGlobalAttributeDecl(name) == null) {</b>
<b class="nc"><i>2416</i>&nbsp;                sg.addGlobalAttributeGroupDecl((XSAttributeGroupDecl)component);</b>
<b class="nc"><i>2417</i>&nbsp;            }</b>
<b class="nc"><i>2418</i>&nbsp;</b>
<i>2419</i>&nbsp;            if(sg.getGlobalAttributeDecl(name, &quot;&quot;) == null) {
<b class="nc"><i>2420</i>&nbsp;                sg.addGlobalAttributeGroupDecl((XSAttributeGroupDecl)component, &quot;&quot;);</b>
<i>2421</i>&nbsp;            }
<i>2422</i>&nbsp;            break;
<i>2423</i>&nbsp;        case 6:
<i>2424</i>&nbsp;            if(sg.getGlobalGroupDecl(name) == null) {
<i>2425</i>&nbsp;                sg.addGlobalGroupDecl((XSGroupDecl)component);
<i>2426</i>&nbsp;            }
<b class="nc"><i>2427</i>&nbsp;</b>
<i>2428</i>&nbsp;            if(sg.getGlobalGroupDecl(name, &quot;&quot;) == null) {
<i>2429</i>&nbsp;                sg.addGlobalGroupDecl((XSGroupDecl)component, &quot;&quot;);
<i>2430</i>&nbsp;            }
<i>2431</i>&nbsp;            break;
<i>2432</i>&nbsp;        case 11:
<i>2433</i>&nbsp;            if(sg.getGlobalNotationDecl(name) == null) {
<i>2434</i>&nbsp;                sg.addGlobalNotationDecl((XSNotationDecl)component);
<i>2435</i>&nbsp;            }
<i>2436</i>&nbsp;
<i>2437</i>&nbsp;            if(sg.getGlobalNotationDecl(name, &quot;&quot;) == null) {
<i>2438</i>&nbsp;                sg.addGlobalNotationDecl((XSNotationDecl)component, &quot;&quot;);
<i>2439</i>&nbsp;            }
<i>2440</i>&nbsp;        }
<i>2441</i>&nbsp;
<i>2442</i>&nbsp;    }
<i>2443</i>&nbsp;
<b class="nc"><i>2444</i>&nbsp;    private void updateImportDependencies(Map&lt;String, Vector&gt; table) {</b>
<b class="nc"><i>2445</i>&nbsp;        if(table != null) {</b>
<i>2446</i>&nbsp;            Iterator i$ = table.entrySet().iterator();
<b class="nc"><i>2447</i>&nbsp;</b>
<i>2448</i>&nbsp;            while(i$.hasNext()) {
<b class="nc"><i>2449</i>&nbsp;                Entry entry = (Entry)i$.next();</b>
<b class="nc"><i>2450</i>&nbsp;                String namespace = (String)entry.getKey();</b>
<i>2451</i>&nbsp;                Vector importList = (Vector)entry.getValue();
<i>2452</i>&nbsp;                if(importList.size() &gt; 0) {
<i>2453</i>&nbsp;                    this.expandImportList(namespace, importList);
<i>2454</i>&nbsp;                }
<i>2455</i>&nbsp;            }
<i>2456</i>&nbsp;
<i>2457</i>&nbsp;        }
<i>2458</i>&nbsp;    }
<i>2459</i>&nbsp;
<i>2460</i>&nbsp;    private void expandImportList(String namespace, Vector namespaceList) {
<i>2461</i>&nbsp;        SchemaGrammar sg = this.fGrammarBucket.getGrammar(namespace);
<i>2462</i>&nbsp;        if(sg != null) {
<i>2463</i>&nbsp;            Vector isgs = sg.getImportedGrammars();
<i>2464</i>&nbsp;            if(isgs == null) {
<i>2465</i>&nbsp;                isgs = new Vector();
<i>2466</i>&nbsp;                this.addImportList(sg, isgs, namespaceList);
<i>2467</i>&nbsp;                sg.setImportedGrammars(isgs);
<b class="nc"><i>2468</i>&nbsp;            } else {</b>
<b class="nc"><i>2469</i>&nbsp;                this.updateImportList(sg, isgs, namespaceList);</b>
<i>2470</i>&nbsp;            }
<b class="nc"><i>2471</i>&nbsp;        }</b>
<i>2472</i>&nbsp;
<i>2473</i>&nbsp;    }
<i>2474</i>&nbsp;
<b class="nc"><i>2475</i>&nbsp;    private void addImportList(SchemaGrammar sg, Vector importedGrammars, Vector namespaceList) {</b>
<i>2476</i>&nbsp;        int size = namespaceList.size();
<b class="nc"><i>2477</i>&nbsp;</b>
<b class="nc"><i>2478</i>&nbsp;        for(int i = 0; i &lt; size; ++i) {</b>
<b class="nc"><i>2479</i>&nbsp;            SchemaGrammar isg = this.fGrammarBucket.getGrammar((String)namespaceList.elementAt(i));</b>
<b class="nc"><i>2480</i>&nbsp;            if(isg != null) {</b>
<i>2481</i>&nbsp;                importedGrammars.add(isg);
<i>2482</i>&nbsp;            }
<i>2483</i>&nbsp;        }
<i>2484</i>&nbsp;
<i>2485</i>&nbsp;    }
<b class="nc"><i>2486</i>&nbsp;</b>
<i>2487</i>&nbsp;    private void updateImportList(SchemaGrammar sg, Vector importedGrammars, Vector namespaceList) {
<i>2488</i>&nbsp;        int size = namespaceList.size();
<i>2489</i>&nbsp;
<i>2490</i>&nbsp;        for(int i = 0; i &lt; size; ++i) {
<i>2491</i>&nbsp;            SchemaGrammar isg = this.fGrammarBucket.getGrammar((String)namespaceList.elementAt(i));
<i>2492</i>&nbsp;            if(isg != null &amp;&amp; !this.containedImportedGrammar(importedGrammars, isg)) {
<i>2493</i>&nbsp;                importedGrammars.add(isg);
<b class="nc"><i>2494</i>&nbsp;            }</b>
<b class="nc"><i>2495</i>&nbsp;        }</b>
<i>2496</i>&nbsp;
<b class="nc"><i>2497</i>&nbsp;    }</b>
<b class="nc"><i>2498</i>&nbsp;</b>
<i>2499</i>&nbsp;    private boolean containedImportedGrammar(Vector importedGrammar, SchemaGrammar grammar) {
<i>2500</i>&nbsp;        int size = importedGrammar.size();
<i>2501</i>&nbsp;
<i>2502</i>&nbsp;        for(int i = 0; i &lt; size; ++i) {
<i>2503</i>&nbsp;            SchemaGrammar sg = (SchemaGrammar)importedGrammar.elementAt(i);
<i>2504</i>&nbsp;            if(this.null2EmptyString(sg.getTargetNamespace()).equals(this.null2EmptyString(grammar.getTargetNamespace()))) {
<i>2505</i>&nbsp;                return true;
<i>2506</i>&nbsp;            }
<b class="nc"><i>2507</i>&nbsp;        }</b>
<b class="nc"><i>2508</i>&nbsp;</b>
<b class="nc"><i>2509</i>&nbsp;        return false;</b>
<b class="nc"><i>2510</i>&nbsp;    }</b>
<i>2511</i>&nbsp;
<b class="nc"><i>2512</i>&nbsp;    private SchemaGrammar getSchemaGrammar(XSDDescription desc) {</b>
<b class="nc"><i>2513</i>&nbsp;        SchemaGrammar sg = this.findGrammar(desc, this.fNamespaceGrowth);</b>
<i>2514</i>&nbsp;        if(sg == null) {
<b class="nc"><i>2515</i>&nbsp;            sg = new SchemaGrammar(desc.getNamespace(), desc.makeClone(), this.fSymbolTable);</b>
<b class="nc"><i>2516</i>&nbsp;            this.fGrammarBucket.putGrammar(sg);</b>
<b class="nc"><i>2517</i>&nbsp;        } else if(sg.isImmutable()) {</b>
<b class="nc"><i>2518</i>&nbsp;            sg = this.createGrammarFrom(sg);</b>
<i>2519</i>&nbsp;        }
<b class="nc"><i>2520</i>&nbsp;</b>
<i>2521</i>&nbsp;        return sg;
<i>2522</i>&nbsp;    }
<i>2523</i>&nbsp;
<b class="nc"><i>2524</i>&nbsp;    private Vector findDependentNamespaces(String namespace, Map table) {</b>
<i>2525</i>&nbsp;        String ns = this.null2EmptyString(namespace);
<i>2526</i>&nbsp;        Vector namespaceList = (Vector)this.getFromMap(table, ns);
<i>2527</i>&nbsp;        if(namespaceList == null) {
<b class="nc"><i>2528</i>&nbsp;            namespaceList = new Vector();</b>
<i>2529</i>&nbsp;            table.put(ns, namespaceList);
<i>2530</i>&nbsp;        }
<i>2531</i>&nbsp;
<b class="nc"><i>2532</i>&nbsp;        return namespaceList;</b>
<i>2533</i>&nbsp;    }
<i>2534</i>&nbsp;
<i>2535</i>&nbsp;    private void addNamespaceDependency(String namespace1, String namespace2, Vector list) {
<b class="nc"><i>2536</i>&nbsp;        String ns1 = this.null2EmptyString(namespace1);</b>
<b class="nc"><i>2537</i>&nbsp;        String ns2 = this.null2EmptyString(namespace2);</b>
<i>2538</i>&nbsp;        if(!ns1.equals(ns2) &amp;&amp; !list.contains(ns2)) {
<i>2539</i>&nbsp;            list.add(ns2);
<i>2540</i>&nbsp;        }
<b class="nc"><i>2541</i>&nbsp;</b>
<i>2542</i>&nbsp;    }
<i>2543</i>&nbsp;
<i>2544</i>&nbsp;    private void reportSharingError(String namespace, String name) {
<i>2545</i>&nbsp;        String qName = namespace == null?&quot;,&quot; + name:namespace + &quot;,&quot; + name;
<i>2546</i>&nbsp;        this.reportSchemaError(&quot;sch-props-correct.2&quot;, new Object[]{qName}, (Element)null);
<i>2547</i>&nbsp;    }
<i>2548</i>&nbsp;
<i>2549</i>&nbsp;    private void createTraversers() {
<i>2550</i>&nbsp;        this.fAttributeChecker = new XSAttributeChecker(this);
<i>2551</i>&nbsp;        this.fAttributeGroupTraverser = new XSDAttributeGroupTraverser(this, this.fAttributeChecker);
<b class="nc"><i>2552</i>&nbsp;        this.fAttributeTraverser = new XSDAttributeTraverser(this, this.fAttributeChecker);</b>
<i>2553</i>&nbsp;        this.fComplexTypeTraverser = new XSDComplexTypeTraverser(this, this.fAttributeChecker);
<i>2554</i>&nbsp;        this.fElementTraverser = new XSDElementTraverser(this, this.fAttributeChecker);
<i>2555</i>&nbsp;        this.fGroupTraverser = new XSDGroupTraverser(this, this.fAttributeChecker);
<i>2556</i>&nbsp;        this.fKeyrefTraverser = new XSDKeyrefTraverser(this, this.fAttributeChecker);
<i>2557</i>&nbsp;        this.fNotationTraverser = new XSDNotationTraverser(this, this.fAttributeChecker);
<b class="nc"><i>2558</i>&nbsp;        this.fSimpleTypeTraverser = new XSDSimpleTypeTraverser(this, this.fAttributeChecker);</b>
<b class="nc"><i>2559</i>&nbsp;        this.fUniqueOrKeyTraverser = new XSDUniqueOrKeyTraverser(this, this.fAttributeChecker);</b>
<b class="nc"><i>2560</i>&nbsp;        this.fWildCardTraverser = new XSDWildcardTraverser(this, this.fAttributeChecker);</b>
<b class="nc"><i>2561</i>&nbsp;    }</b>
<i>2562</i>&nbsp;
<i>2563</i>&nbsp;    void prepareForParse() {
<b class="nc"><i>2564</i>&nbsp;        this.fTraversed.clear();</b>
<i>2565</i>&nbsp;        this.fDoc2SystemId.clear();
<i>2566</i>&nbsp;        this.fHiddenNodes.clear();
<i>2567</i>&nbsp;        this.fLastSchemaWasDuplicate = false;
<i>2568</i>&nbsp;    }
<i>2569</i>&nbsp;
<b class="nc"><i>2570</i>&nbsp;    void prepareForTraverse() {</b>
<b class="nc"><i>2571</i>&nbsp;        if(!this.registryEmpty) {</b>
<b class="nc"><i>2572</i>&nbsp;            this.fUnparsedAttributeRegistry.clear();</b>
<b class="nc"><i>2573</i>&nbsp;            this.fUnparsedAttributeGroupRegistry.clear();</b>
<i>2574</i>&nbsp;            this.fUnparsedElementRegistry.clear();
<i>2575</i>&nbsp;            this.fUnparsedGroupRegistry.clear();
<b class="nc"><i>2576</i>&nbsp;            this.fUnparsedIdentityConstraintRegistry.clear();</b>
<b class="nc"><i>2577</i>&nbsp;            this.fUnparsedNotationRegistry.clear();</b>
<b class="nc"><i>2578</i>&nbsp;            this.fUnparsedTypeRegistry.clear();</b>
<b class="nc"><i>2579</i>&nbsp;            this.fUnparsedAttributeRegistrySub.clear();</b>
<i>2580</i>&nbsp;            this.fUnparsedAttributeGroupRegistrySub.clear();
<i>2581</i>&nbsp;            this.fUnparsedElementRegistrySub.clear();
<b class="nc"><i>2582</i>&nbsp;            this.fUnparsedGroupRegistrySub.clear();</b>
<i>2583</i>&nbsp;            this.fUnparsedIdentityConstraintRegistrySub.clear();
<b class="nc"><i>2584</i>&nbsp;            this.fUnparsedNotationRegistrySub.clear();</b>
<i>2585</i>&nbsp;            this.fUnparsedTypeRegistrySub.clear();
<i>2586</i>&nbsp;        }
<i>2587</i>&nbsp;
<i>2588</i>&nbsp;        int locale;
<i>2589</i>&nbsp;        for(locale = 1; locale &lt;= 7; ++locale) {
<i>2590</i>&nbsp;            if(this.fUnparsedRegistriesExt[locale] != null) {
<i>2591</i>&nbsp;                this.fUnparsedRegistriesExt[locale].clear();
<b class="nc"><i>2592</i>&nbsp;            }</b>
<b class="nc"><i>2593</i>&nbsp;        }</b>
<b class="nc"><i>2594</i>&nbsp;</b>
<b class="nc"><i>2595</i>&nbsp;        this.fDependencyMap.clear();</b>
<b class="nc"><i>2596</i>&nbsp;        this.fDoc2XSDocumentMap.clear();</b>
<b class="nc"><i>2597</i>&nbsp;        if(this.fRedefine2XSDMap != null) {</b>
<i>2598</i>&nbsp;            this.fRedefine2XSDMap.clear();
<i>2599</i>&nbsp;        }
<b class="nc"><i>2600</i>&nbsp;</b>
<b class="nc"><i>2601</i>&nbsp;        if(this.fRedefine2NSSupport != null) {</b>
<i>2602</i>&nbsp;            this.fRedefine2NSSupport.clear();
<i>2603</i>&nbsp;        }
<b class="nc"><i>2604</i>&nbsp;</b>
<i>2605</i>&nbsp;        this.fAllTNSs.removeAllElements();
<i>2606</i>&nbsp;        this.fImportMap.clear();
<i>2607</i>&nbsp;        this.fRoot = null;
<b class="nc"><i>2608</i>&nbsp;</b>
<b class="nc"><i>2609</i>&nbsp;        for(locale = 0; locale &lt; this.fLocalElemStackPos; ++locale) {</b>
<i>2610</i>&nbsp;            this.fParticle[locale] = null;
<i>2611</i>&nbsp;            this.fLocalElementDecl[locale] = null;
<i>2612</i>&nbsp;            this.fLocalElementDecl_schema[locale] = null;
<i>2613</i>&nbsp;            this.fLocalElemNamespaceContext[locale] = null;
<i>2614</i>&nbsp;        }
<i>2615</i>&nbsp;
<i>2616</i>&nbsp;        this.fLocalElemStackPos = 0;
<i>2617</i>&nbsp;
<i>2618</i>&nbsp;        for(locale = 0; locale &lt; this.fKeyrefStackPos; ++locale) {
<i>2619</i>&nbsp;            this.fKeyrefs[locale] = null;
<i>2620</i>&nbsp;            this.fKeyrefElems[locale] = null;
<i>2621</i>&nbsp;            this.fKeyrefNamespaceContext[locale] = null;
<i>2622</i>&nbsp;            this.fKeyrefsMapXSDocumentInfo[locale] = null;
<i>2623</i>&nbsp;        }
<i>2624</i>&nbsp;
<i>2625</i>&nbsp;        this.fKeyrefStackPos = 0;
<i>2626</i>&nbsp;        if(this.fAttributeChecker == null) {
<i>2627</i>&nbsp;            this.createTraversers();
<i>2628</i>&nbsp;        }
<i>2629</i>&nbsp;
<i>2630</i>&nbsp;        Locale var2 = this.fErrorReporter.getLocale();
<i>2631</i>&nbsp;        this.fAttributeChecker.reset(this.fSymbolTable);
<i>2632</i>&nbsp;        this.fAttributeGroupTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2633</i>&nbsp;        this.fAttributeTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2634</i>&nbsp;        this.fComplexTypeTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2635</i>&nbsp;        this.fElementTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2636</i>&nbsp;        this.fGroupTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2637</i>&nbsp;        this.fKeyrefTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2638</i>&nbsp;        this.fNotationTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2639</i>&nbsp;        this.fSimpleTypeTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2640</i>&nbsp;        this.fUniqueOrKeyTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2641</i>&nbsp;        this.fWildCardTraverser.reset(this.fSymbolTable, this.fValidateAnnotations, var2);
<i>2642</i>&nbsp;        this.fRedefinedRestrictedAttributeGroupRegistry.clear();
<i>2643</i>&nbsp;        this.fRedefinedRestrictedGroupRegistry.clear();
<i>2644</i>&nbsp;        this.fGlobalAttrDecls.clear();
<i>2645</i>&nbsp;        this.fGlobalAttrGrpDecls.clear();
<i>2646</i>&nbsp;        this.fGlobalElemDecls.clear();
<i>2647</i>&nbsp;        this.fGlobalGroupDecls.clear();
<i>2648</i>&nbsp;        this.fGlobalNotationDecls.clear();
<i>2649</i>&nbsp;        this.fGlobalIDConstraintDecls.clear();
<i>2650</i>&nbsp;        this.fGlobalTypeDecls.clear();
<i>2651</i>&nbsp;    }
<i>2652</i>&nbsp;
<i>2653</i>&nbsp;    public void setDeclPool(XSDeclarationPool declPool) {
<i>2654</i>&nbsp;        this.fDeclPool = declPool;
<i>2655</i>&nbsp;    }
<i>2656</i>&nbsp;
<i>2657</i>&nbsp;    public void setDVFactory(SchemaDVFactory dvFactory) {
<i>2658</i>&nbsp;        this.fDVFactory = dvFactory;
<i>2659</i>&nbsp;    }
<i>2660</i>&nbsp;
<i>2661</i>&nbsp;    public SchemaDVFactory getDVFactory() {
<i>2662</i>&nbsp;        return this.fDVFactory;
<b class="nc"><i>2663</i>&nbsp;    }</b>
<b class="nc"><i>2664</i>&nbsp;</b>
<b class="nc"><i>2665</i>&nbsp;    public void reset(XMLComponentManager componentManager) {</b>
<b class="nc"><i>2666</i>&nbsp;        this.fSymbolTable = (SymbolTable)componentManager.getProperty(&quot;http://apache.org/xml/properties/internal/symbol-table&quot;);</b>
<i>2667</i>&nbsp;        this.fSecureProcessing = null;
<i>2668</i>&nbsp;        if(componentManager != null) {
<i>2669</i>&nbsp;            this.fSecureProcessing = (XMLSecurityManager)componentManager.getProperty(&quot;http://apache.org/xml/properties/security-manager&quot;, (Object)null);
<i>2670</i>&nbsp;        }
<i>2671</i>&nbsp;
<b class="nc"><i>2672</i>&nbsp;        this.fEntityResolver = (XMLEntityResolver)componentManager.getProperty(&quot;http://apache.org/xml/properties/internal/entity-manager&quot;);</b>
<i>2673</i>&nbsp;        XMLEntityResolver er = (XMLEntityResolver)componentManager.getProperty(&quot;http://apache.org/xml/properties/internal/entity-resolver&quot;);
<i>2674</i>&nbsp;        if(er != null) {
<i>2675</i>&nbsp;            this.fSchemaParser.setEntityResolver(er);
<b class="nc"><i>2676</i>&nbsp;        }</b>
<b class="nc"><i>2677</i>&nbsp;</b>
<i>2678</i>&nbsp;        this.fErrorReporter = (XMLErrorReporter)componentManager.getProperty(&quot;http://apache.org/xml/properties/internal/error-reporter&quot;);
<b class="nc"><i>2679</i>&nbsp;</b>
<i>2680</i>&nbsp;        try {
<i>2681</i>&nbsp;            XMLErrorHandler securityPropertyMgr = this.fErrorReporter.getErrorHandler();
<b class="nc"><i>2682</i>&nbsp;            if(securityPropertyMgr != this.fSchemaParser.getProperty(&quot;http://apache.org/xml/properties/internal/error-handler&quot;)) {</b>
<i>2683</i>&nbsp;                this.fSchemaParser.setProperty(&quot;http://apache.org/xml/properties/internal/error-handler&quot;, securityPropertyMgr != null?securityPropertyMgr:new DefaultErrorHandler());
<b class="nc"><i>2684</i>&nbsp;                if(this.fAnnotationValidator != null) {</b>
<b class="nc"><i>2685</i>&nbsp;                    this.fAnnotationValidator.setProperty(&quot;http://apache.org/xml/properties/internal/error-handler&quot;, securityPropertyMgr != null?securityPropertyMgr:new DefaultErrorHandler());</b>
<i>2686</i>&nbsp;                }
<i>2687</i>&nbsp;            }
<i>2688</i>&nbsp;
<b class="nc"><i>2689</i>&nbsp;            Locale currentLocale = this.fErrorReporter.getLocale();</b>
<b class="nc"><i>2690</i>&nbsp;            if(currentLocale != this.fSchemaParser.getProperty(&quot;http://apache.org/xml/properties/locale&quot;)) {</b>
<i>2691</i>&nbsp;                this.fSchemaParser.setProperty(&quot;http://apache.org/xml/properties/locale&quot;, currentLocale);
<i>2692</i>&nbsp;                if(this.fAnnotationValidator != null) {
<b class="nc"><i>2693</i>&nbsp;                    this.fAnnotationValidator.setProperty(&quot;http://apache.org/xml/properties/locale&quot;, currentLocale);</b>
<b class="nc"><i>2694</i>&nbsp;                }</b>
<i>2695</i>&nbsp;            }
<i>2696</i>&nbsp;        } catch (XMLConfigurationException var11) {
<b class="nc"><i>2697</i>&nbsp;            ;</b>
<i>2698</i>&nbsp;        }
<i>2699</i>&nbsp;
<i>2700</i>&nbsp;        this.fValidateAnnotations = componentManager.getFeature(&quot;http://apache.org/xml/features/validate-annotations&quot;, false);
<i>2701</i>&nbsp;        this.fHonourAllSchemaLocations = componentManager.getFeature(&quot;http://apache.org/xml/features/honour-all-schemaLocations&quot;, false);
<i>2702</i>&nbsp;        this.fNamespaceGrowth = componentManager.getFeature(&quot;http://apache.org/xml/features/namespace-growth&quot;, false);
<i>2703</i>&nbsp;        this.fTolerateDuplicates = componentManager.getFeature(&quot;http://apache.org/xml/features/internal/tolerate-duplicates&quot;, false);
<i>2704</i>&nbsp;
<b class="nc"><i>2705</i>&nbsp;        try {</b>
<i>2706</i>&nbsp;            this.fSchemaParser.setFeature(&quot;http://apache.org/xml/features/continue-after-fatal-error&quot;, this.fErrorReporter.getFeature(&quot;http://apache.org/xml/features/continue-after-fatal-error&quot;));
<i>2707</i>&nbsp;        } catch (XMLConfigurationException var10) {
<i>2708</i>&nbsp;            ;
<i>2709</i>&nbsp;        }
<i>2710</i>&nbsp;
<i>2711</i>&nbsp;        try {
<i>2712</i>&nbsp;            if(componentManager.getFeature(&quot;http://apache.org/xml/features/allow-java-encodings&quot;, false)) {
<i>2713</i>&nbsp;                this.fSchemaParser.setFeature(&quot;http://apache.org/xml/features/allow-java-encodings&quot;, true);
<i>2714</i>&nbsp;            }
<i>2715</i>&nbsp;        } catch (XMLConfigurationException var9) {
<i>2716</i>&nbsp;            ;
<i>2717</i>&nbsp;        }
<i>2718</i>&nbsp;
<i>2719</i>&nbsp;        try {
<i>2720</i>&nbsp;            if(componentManager.getFeature(&quot;http://apache.org/xml/features/standard-uri-conformant&quot;, false)) {
<i>2721</i>&nbsp;                this.fSchemaParser.setFeature(&quot;http://apache.org/xml/features/standard-uri-conformant&quot;, true);
<i>2722</i>&nbsp;            }
<i>2723</i>&nbsp;        } catch (XMLConfigurationException var8) {
<i>2724</i>&nbsp;            ;
<i>2725</i>&nbsp;        }
<i>2726</i>&nbsp;
<i>2727</i>&nbsp;        try {
<i>2728</i>&nbsp;            this.fGrammarPool = (XMLGrammarPool)componentManager.getProperty(&quot;http://apache.org/xml/properties/internal/grammar-pool&quot;);
<i>2729</i>&nbsp;        } catch (XMLConfigurationException var7) {
<i>2730</i>&nbsp;            this.fGrammarPool = null;
<i>2731</i>&nbsp;        }
<i>2732</i>&nbsp;
<i>2733</i>&nbsp;        try {
<i>2734</i>&nbsp;            if(componentManager.getFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, false)) {
<i>2735</i>&nbsp;                this.fSchemaParser.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);
<i>2736</i>&nbsp;            }
<i>2737</i>&nbsp;        } catch (XMLConfigurationException var6) {
<i>2738</i>&nbsp;            ;
<i>2739</i>&nbsp;        }
<i>2740</i>&nbsp;
<i>2741</i>&nbsp;        try {
<i>2742</i>&nbsp;            Object securityPropertyMgr1 = componentManager.getProperty(&quot;http://apache.org/xml/properties/security-manager&quot;, (Object)null);
<i>2743</i>&nbsp;            if(securityPropertyMgr1 != null) {
<i>2744</i>&nbsp;                this.fSchemaParser.setProperty(&quot;http://apache.org/xml/properties/security-manager&quot;, securityPropertyMgr1);
<i>2745</i>&nbsp;            }
<i>2746</i>&nbsp;        } catch (XMLConfigurationException var5) {
<i>2747</i>&nbsp;            ;
<i>2748</i>&nbsp;        }
<i>2749</i>&nbsp;
<i>2750</i>&nbsp;        XMLSecurityPropertyManager securityPropertyMgr2 = (XMLSecurityPropertyManager)componentManager.getProperty(&quot;http://www.oracle.com/xml/jaxp/properties/xmlSecurityPropertyManager&quot;);
<i>2751</i>&nbsp;        this.fSchemaParser.setProperty(&quot;http://www.oracle.com/xml/jaxp/properties/xmlSecurityPropertyManager&quot;, securityPropertyMgr2);
<i>2752</i>&nbsp;        this.fAccessExternalDTD = securityPropertyMgr2.getValue(Property.ACCESS_EXTERNAL_DTD);
<i>2753</i>&nbsp;        this.fAccessExternalSchema = securityPropertyMgr2.getValue(Property.ACCESS_EXTERNAL_SCHEMA);
<i>2754</i>&nbsp;    }
<i>2755</i>&nbsp;
<i>2756</i>&nbsp;    void traverseLocalElements() {
<i>2757</i>&nbsp;        this.fElementTraverser.fDeferTraversingLocalElements = false;
<i>2758</i>&nbsp;
<i>2759</i>&nbsp;        for(int i = 0; i &lt; this.fLocalElemStackPos; ++i) {
<i>2760</i>&nbsp;            Element currElem = this.fLocalElementDecl[i];
<i>2761</i>&nbsp;            XSDocumentInfo currSchema = this.fLocalElementDecl_schema[i];
<i>2762</i>&nbsp;            SchemaGrammar currGrammar = this.fGrammarBucket.getGrammar(currSchema.fTargetNamespace);
<i>2763</i>&nbsp;            this.fElementTraverser.traverseLocal(this.fParticle[i], currElem, currSchema, currGrammar, this.fAllContext[i], this.fParent[i], this.fLocalElemNamespaceContext[i]);
<i>2764</i>&nbsp;            if(this.fParticle[i].fType == 0) {
<i>2765</i>&nbsp;                XSModelGroupImpl group = null;
<i>2766</i>&nbsp;                if(this.fParent[i] instanceof XSComplexTypeDecl) {
<i>2767</i>&nbsp;                    XSParticle p = ((XSComplexTypeDecl)this.fParent[i]).getParticle();
<i>2768</i>&nbsp;                    if(p != null) {
<i>2769</i>&nbsp;                        group = (XSModelGroupImpl)p.getTerm();
<i>2770</i>&nbsp;                    }
<i>2771</i>&nbsp;                } else {
<i>2772</i>&nbsp;                    group = ((XSGroupDecl)this.fParent[i]).fModelGroup;
<i>2773</i>&nbsp;                }
<i>2774</i>&nbsp;
<i>2775</i>&nbsp;                if(group != null) {
<i>2776</i>&nbsp;                    this.removeParticle(group, this.fParticle[i]);
<i>2777</i>&nbsp;                }
<i>2778</i>&nbsp;            }
<i>2779</i>&nbsp;        }
<i>2780</i>&nbsp;
<i>2781</i>&nbsp;    }
<i>2782</i>&nbsp;
<i>2783</i>&nbsp;    private boolean removeParticle(XSModelGroupImpl group, XSParticleDecl particle) {
<i>2784</i>&nbsp;        for(int i = 0; i &lt; group.fParticleCount; ++i) {
<i>2785</i>&nbsp;            XSParticleDecl member = group.fParticles[i];
<i>2786</i>&nbsp;            if(member == particle) {
<i>2787</i>&nbsp;                for(int j = i; j &lt; group.fParticleCount - 1; ++j) {
<i>2788</i>&nbsp;                    group.fParticles[j] = group.fParticles[j + 1];
<i>2789</i>&nbsp;                }
<i>2790</i>&nbsp;
<i>2791</i>&nbsp;                --group.fParticleCount;
<i>2792</i>&nbsp;                return true;
<i>2793</i>&nbsp;            }
<i>2794</i>&nbsp;
<i>2795</i>&nbsp;            if(member.fType == 3 &amp;&amp; this.removeParticle((XSModelGroupImpl)member.fValue, particle)) {
<i>2796</i>&nbsp;                return true;
<i>2797</i>&nbsp;            }
<i>2798</i>&nbsp;        }
<i>2799</i>&nbsp;
<i>2800</i>&nbsp;        return false;
<i>2801</i>&nbsp;    }
<i>2802</i>&nbsp;
<i>2803</i>&nbsp;    void fillInLocalElemInfo(Element elmDecl, XSDocumentInfo schemaDoc, int allContextFlags, XSObject parent, XSParticleDecl particle) {
<i>2804</i>&nbsp;        if(this.fParticle.length == this.fLocalElemStackPos) {
<i>2805</i>&nbsp;            XSParticleDecl[] newStackP = new XSParticleDecl[this.fLocalElemStackPos + 10];
<i>2806</i>&nbsp;            System.arraycopy(this.fParticle, 0, newStackP, 0, this.fLocalElemStackPos);
<i>2807</i>&nbsp;            this.fParticle = newStackP;
<i>2808</i>&nbsp;            Element[] newStackE = new Element[this.fLocalElemStackPos + 10];
<i>2809</i>&nbsp;            System.arraycopy(this.fLocalElementDecl, 0, newStackE, 0, this.fLocalElemStackPos);
<i>2810</i>&nbsp;            this.fLocalElementDecl = newStackE;
<i>2811</i>&nbsp;            XSDocumentInfo[] newStackE_schema = new XSDocumentInfo[this.fLocalElemStackPos + 10];
<i>2812</i>&nbsp;            System.arraycopy(this.fLocalElementDecl_schema, 0, newStackE_schema, 0, this.fLocalElemStackPos);
<i>2813</i>&nbsp;            this.fLocalElementDecl_schema = newStackE_schema;
<i>2814</i>&nbsp;            int[] newStackI = new int[this.fLocalElemStackPos + 10];
<i>2815</i>&nbsp;            System.arraycopy(this.fAllContext, 0, newStackI, 0, this.fLocalElemStackPos);
<i>2816</i>&nbsp;            this.fAllContext = newStackI;
<i>2817</i>&nbsp;            XSObject[] newStackC = new XSObject[this.fLocalElemStackPos + 10];
<i>2818</i>&nbsp;            System.arraycopy(this.fParent, 0, newStackC, 0, this.fLocalElemStackPos);
<i>2819</i>&nbsp;            this.fParent = newStackC;
<i>2820</i>&nbsp;            String[][] newStackN = new String[this.fLocalElemStackPos + 10][];
<i>2821</i>&nbsp;            System.arraycopy(this.fLocalElemNamespaceContext, 0, newStackN, 0, this.fLocalElemStackPos);
<i>2822</i>&nbsp;            this.fLocalElemNamespaceContext = newStackN;
<i>2823</i>&nbsp;        }
<i>2824</i>&nbsp;
<i>2825</i>&nbsp;        this.fParticle[this.fLocalElemStackPos] = particle;
<i>2826</i>&nbsp;        this.fLocalElementDecl[this.fLocalElemStackPos] = elmDecl;
<i>2827</i>&nbsp;        this.fLocalElementDecl_schema[this.fLocalElemStackPos] = schemaDoc;
<i>2828</i>&nbsp;        this.fAllContext[this.fLocalElemStackPos] = allContextFlags;
<i>2829</i>&nbsp;        this.fParent[this.fLocalElemStackPos] = parent;
<i>2830</i>&nbsp;        this.fLocalElemNamespaceContext[this.fLocalElemStackPos++] = schemaDoc.fNamespaceSupport.getEffectiveLocalContext();
<i>2831</i>&nbsp;    }
<i>2832</i>&nbsp;
<i>2833</i>&nbsp;    void checkForDuplicateNames(String qName, int declType, Map&lt;String, Element&gt; registry, Map&lt;String, XSDocumentInfo&gt; registry_sub, Element currComp, XSDocumentInfo currSchema) {
<i>2834</i>&nbsp;        Object objElem = null;
<i>2835</i>&nbsp;        if((objElem = registry.get(qName)) == null) {
<i>2836</i>&nbsp;            if(this.fNamespaceGrowth &amp;&amp; !this.fTolerateDuplicates) {
<i>2837</i>&nbsp;                this.checkForDuplicateNames(qName, declType, currComp);
<i>2838</i>&nbsp;            }
<i>2839</i>&nbsp;
<i>2840</i>&nbsp;            registry.put(qName, currComp);
<i>2841</i>&nbsp;            registry_sub.put(qName, currSchema);
<i>2842</i>&nbsp;        } else {
<i>2843</i>&nbsp;            Element collidingElem = (Element)objElem;
<i>2844</i>&nbsp;            XSDocumentInfo collidingElemSchema = (XSDocumentInfo)registry_sub.get(qName);
<i>2845</i>&nbsp;            if(collidingElem == currComp) {
<i>2846</i>&nbsp;                return;
<i>2847</i>&nbsp;            }
<i>2848</i>&nbsp;
<i>2849</i>&nbsp;            Element elemParent = null;
<i>2850</i>&nbsp;            XSDocumentInfo redefinedSchema = null;
<i>2851</i>&nbsp;            boolean collidedWithRedefine = true;
<i>2852</i>&nbsp;            if(DOMUtil.getLocalName(elemParent = DOMUtil.getParent(collidingElem)).equals(SchemaSymbols.ELT_REDEFINE)) {
<i>2853</i>&nbsp;                redefinedSchema = this.fRedefine2XSDMap != null?(XSDocumentInfo)((XSDocumentInfo)this.fRedefine2XSDMap.get(elemParent)):null;
<i>2854</i>&nbsp;            } else if(DOMUtil.getLocalName(DOMUtil.getParent(currComp)).equals(SchemaSymbols.ELT_REDEFINE)) {
<i>2855</i>&nbsp;                redefinedSchema = collidingElemSchema;
<i>2856</i>&nbsp;                collidedWithRedefine = false;
<i>2857</i>&nbsp;            }
<i>2858</i>&nbsp;
<i>2859</i>&nbsp;            if(redefinedSchema != null) {
<i>2860</i>&nbsp;                if(collidingElemSchema == currSchema) {
<i>2861</i>&nbsp;                    this.reportSchemaError(&quot;sch-props-correct.2&quot;, new Object[]{qName}, currComp);
<i>2862</i>&nbsp;                    return;
<i>2863</i>&nbsp;                }
<i>2864</i>&nbsp;
<i>2865</i>&nbsp;                String newName = qName.substring(qName.lastIndexOf(44) + 1) + &quot;_fn3dktizrknc9pi&quot;;
<i>2866</i>&nbsp;                if(redefinedSchema == currSchema) {
<i>2867</i>&nbsp;                    currComp.setAttribute(SchemaSymbols.ATT_NAME, newName);
<i>2868</i>&nbsp;                    if(currSchema.fTargetNamespace == null) {
<i>2869</i>&nbsp;                        registry.put(&quot;,&quot; + newName, currComp);
<i>2870</i>&nbsp;                        registry_sub.put(&quot;,&quot; + newName, currSchema);
<i>2871</i>&nbsp;                    } else {
<i>2872</i>&nbsp;                        registry.put(currSchema.fTargetNamespace + &quot;,&quot; + newName, currComp);
<i>2873</i>&nbsp;                        registry_sub.put(currSchema.fTargetNamespace + &quot;,&quot; + newName, currSchema);
<i>2874</i>&nbsp;                    }
<i>2875</i>&nbsp;
<i>2876</i>&nbsp;                    if(currSchema.fTargetNamespace == null) {
<i>2877</i>&nbsp;                        this.checkForDuplicateNames(&quot;,&quot; + newName, declType, registry, registry_sub, currComp, currSchema);
<i>2878</i>&nbsp;                    } else {
<i>2879</i>&nbsp;                        this.checkForDuplicateNames(currSchema.fTargetNamespace + &quot;,&quot; + newName, declType, registry, registry_sub, currComp, currSchema);
<i>2880</i>&nbsp;                    }
<i>2881</i>&nbsp;                } else if(collidedWithRedefine) {
<i>2882</i>&nbsp;                    if(currSchema.fTargetNamespace == null) {
<i>2883</i>&nbsp;                        this.checkForDuplicateNames(&quot;,&quot; + newName, declType, registry, registry_sub, currComp, currSchema);
<i>2884</i>&nbsp;                    } else {
<i>2885</i>&nbsp;                        this.checkForDuplicateNames(currSchema.fTargetNamespace + &quot;,&quot; + newName, declType, registry, registry_sub, currComp, currSchema);
<i>2886</i>&nbsp;                    }
<i>2887</i>&nbsp;                } else {
<i>2888</i>&nbsp;                    this.reportSchemaError(&quot;sch-props-correct.2&quot;, new Object[]{qName}, currComp);
<i>2889</i>&nbsp;                }
<i>2890</i>&nbsp;            } else if(!this.fTolerateDuplicates) {
<i>2891</i>&nbsp;                this.reportSchemaError(&quot;sch-props-correct.2&quot;, new Object[]{qName}, currComp);
<i>2892</i>&nbsp;            } else if(this.fUnparsedRegistriesExt[declType] != null &amp;&amp; this.fUnparsedRegistriesExt[declType].get(qName) == currSchema) {
<i>2893</i>&nbsp;                this.reportSchemaError(&quot;sch-props-correct.2&quot;, new Object[]{qName}, currComp);
<i>2894</i>&nbsp;            }
<i>2895</i>&nbsp;        }
<i>2896</i>&nbsp;
<i>2897</i>&nbsp;        if(this.fTolerateDuplicates) {
<i>2898</i>&nbsp;            if(this.fUnparsedRegistriesExt[declType] == null) {
<i>2899</i>&nbsp;                this.fUnparsedRegistriesExt[declType] = new HashMap();
<i>2900</i>&nbsp;            }
<i>2901</i>&nbsp;
<i>2902</i>&nbsp;            this.fUnparsedRegistriesExt[declType].put(qName, currSchema);
<i>2903</i>&nbsp;        }
<i>2904</i>&nbsp;
<i>2905</i>&nbsp;    }
<i>2906</i>&nbsp;
<i>2907</i>&nbsp;    void checkForDuplicateNames(String qName, int declType, Element currComp) {
<i>2908</i>&nbsp;        int namespaceEnd = qName.indexOf(44);
<i>2909</i>&nbsp;        String namespace = qName.substring(0, namespaceEnd);
<i>2910</i>&nbsp;        SchemaGrammar grammar = this.fGrammarBucket.getGrammar(this.emptyString2Null(namespace));
<i>2911</i>&nbsp;        if(grammar != null) {
<i>2912</i>&nbsp;            Object obj = this.getGlobalDeclFromGrammar(grammar, declType, qName.substring(namespaceEnd + 1));
<i>2913</i>&nbsp;            if(obj != null) {
<i>2914</i>&nbsp;                this.reportSchemaError(&quot;sch-props-correct.2&quot;, new Object[]{qName}, currComp);
<i>2915</i>&nbsp;            }
<i>2916</i>&nbsp;        }
<i>2917</i>&nbsp;
<i>2918</i>&nbsp;    }
<i>2919</i>&nbsp;
<i>2920</i>&nbsp;    private void renameRedefiningComponents(XSDocumentInfo currSchema, Element child, String componentType, String oldName, String newName) {
<i>2921</i>&nbsp;        Element processedBaseName;
<i>2922</i>&nbsp;        if(componentType.equals(SchemaSymbols.ELT_SIMPLETYPE)) {
<i>2923</i>&nbsp;            processedBaseName = DOMUtil.getFirstChildElement(child);
<i>2924</i>&nbsp;            if(processedBaseName == null) {
<i>2925</i>&nbsp;                this.reportSchemaError(&quot;src-redefine.5.a.a&quot;, (Object[])null, child);
<i>2926</i>&nbsp;            } else {
<i>2927</i>&nbsp;                String groupRefsCount = DOMUtil.getLocalName(processedBaseName);
<i>2928</i>&nbsp;                if(groupRefsCount.equals(SchemaSymbols.ELT_ANNOTATION)) {
<i>2929</i>&nbsp;                    processedBaseName = DOMUtil.getNextSiblingElement(processedBaseName);
<i>2930</i>&nbsp;                }
<i>2931</i>&nbsp;
<i>2932</i>&nbsp;                if(processedBaseName == null) {
<i>2933</i>&nbsp;                    this.reportSchemaError(&quot;src-redefine.5.a.a&quot;, (Object[])null, child);
<i>2934</i>&nbsp;                } else {
<i>2935</i>&nbsp;                    groupRefsCount = DOMUtil.getLocalName(processedBaseName);
<i>2936</i>&nbsp;                    if(!groupRefsCount.equals(SchemaSymbols.ELT_RESTRICTION)) {
<i>2937</i>&nbsp;                        this.reportSchemaError(&quot;src-redefine.5.a.b&quot;, new Object[]{groupRefsCount}, child);
<i>2938</i>&nbsp;                    } else {
<i>2939</i>&nbsp;                        Object[] greatGrandKidName = this.fAttributeChecker.checkAttributes(processedBaseName, false, currSchema);
<i>2940</i>&nbsp;                        QName attrs = (QName)greatGrandKidName[XSAttributeChecker.ATTIDX_BASE];
<i>2941</i>&nbsp;                        if(attrs != null &amp;&amp; attrs.uri == currSchema.fTargetNamespace &amp;&amp; attrs.localpart.equals(oldName)) {
<i>2942</i>&nbsp;                            if(attrs.prefix != null &amp;&amp; attrs.prefix.length() &gt; 0) {
<i>2943</i>&nbsp;                                processedBaseName.setAttribute(SchemaSymbols.ATT_BASE, attrs.prefix + &quot;:&quot; + newName);
<i>2944</i>&nbsp;                            } else {
<i>2945</i>&nbsp;                                processedBaseName.setAttribute(SchemaSymbols.ATT_BASE, newName);
<i>2946</i>&nbsp;                            }
<i>2947</i>&nbsp;                        } else {
<i>2948</i>&nbsp;                            this.reportSchemaError(&quot;src-redefine.5.a.c&quot;, new Object[]{groupRefsCount, (currSchema.fTargetNamespace == null?&quot;&quot;:currSchema.fTargetNamespace) + &quot;,&quot; + oldName}, child);
<i>2949</i>&nbsp;                        }
<i>2950</i>&nbsp;
<i>2951</i>&nbsp;                        this.fAttributeChecker.returnAttrArray(greatGrandKidName, currSchema);
<i>2952</i>&nbsp;                    }
<i>2953</i>&nbsp;                }
<i>2954</i>&nbsp;            }
<i>2955</i>&nbsp;        } else if(componentType.equals(SchemaSymbols.ELT_COMPLEXTYPE)) {
<i>2956</i>&nbsp;            processedBaseName = DOMUtil.getFirstChildElement(child);
<i>2957</i>&nbsp;            if(processedBaseName == null) {
<i>2958</i>&nbsp;                this.reportSchemaError(&quot;src-redefine.5.b.a&quot;, (Object[])null, child);
<i>2959</i>&nbsp;            } else {
<i>2960</i>&nbsp;                if(DOMUtil.getLocalName(processedBaseName).equals(SchemaSymbols.ELT_ANNOTATION)) {
<i>2961</i>&nbsp;                    processedBaseName = DOMUtil.getNextSiblingElement(processedBaseName);
<i>2962</i>&nbsp;                }
<i>2963</i>&nbsp;
<i>2964</i>&nbsp;                if(processedBaseName == null) {
<i>2965</i>&nbsp;                    this.reportSchemaError(&quot;src-redefine.5.b.a&quot;, (Object[])null, child);
<i>2966</i>&nbsp;                } else {
<i>2967</i>&nbsp;                    Element groupRefsCount1 = DOMUtil.getFirstChildElement(processedBaseName);
<i>2968</i>&nbsp;                    if(groupRefsCount1 == null) {
<i>2969</i>&nbsp;                        this.reportSchemaError(&quot;src-redefine.5.b.b&quot;, (Object[])null, processedBaseName);
<i>2970</i>&nbsp;                    } else {
<i>2971</i>&nbsp;                        String greatGrandKidName1 = DOMUtil.getLocalName(groupRefsCount1);
<i>2972</i>&nbsp;                        if(greatGrandKidName1.equals(SchemaSymbols.ELT_ANNOTATION)) {
<i>2973</i>&nbsp;                            groupRefsCount1 = DOMUtil.getNextSiblingElement(groupRefsCount1);
<i>2974</i>&nbsp;                        }
<i>2975</i>&nbsp;
<i>2976</i>&nbsp;                        if(groupRefsCount1 == null) {
<i>2977</i>&nbsp;                            this.reportSchemaError(&quot;src-redefine.5.b.b&quot;, (Object[])null, processedBaseName);
<i>2978</i>&nbsp;                        } else {
<i>2979</i>&nbsp;                            greatGrandKidName1 = DOMUtil.getLocalName(groupRefsCount1);
<i>2980</i>&nbsp;                            if(!greatGrandKidName1.equals(SchemaSymbols.ELT_RESTRICTION) &amp;&amp; !greatGrandKidName1.equals(SchemaSymbols.ELT_EXTENSION)) {
<i>2981</i>&nbsp;                                this.reportSchemaError(&quot;src-redefine.5.b.c&quot;, new Object[]{greatGrandKidName1}, groupRefsCount1);
<i>2982</i>&nbsp;                            } else {
<i>2983</i>&nbsp;                                Object[] attrs1 = this.fAttributeChecker.checkAttributes(groupRefsCount1, false, currSchema);
<i>2984</i>&nbsp;                                QName derivedBase = (QName)attrs1[XSAttributeChecker.ATTIDX_BASE];
<i>2985</i>&nbsp;                                if(derivedBase != null &amp;&amp; derivedBase.uri == currSchema.fTargetNamespace &amp;&amp; derivedBase.localpart.equals(oldName)) {
<i>2986</i>&nbsp;                                    if(derivedBase.prefix != null &amp;&amp; derivedBase.prefix.length() &gt; 0) {
<i>2987</i>&nbsp;                                        groupRefsCount1.setAttribute(SchemaSymbols.ATT_BASE, derivedBase.prefix + &quot;:&quot; + newName);
<i>2988</i>&nbsp;                                    } else {
<i>2989</i>&nbsp;                                        groupRefsCount1.setAttribute(SchemaSymbols.ATT_BASE, newName);
<i>2990</i>&nbsp;                                    }
<i>2991</i>&nbsp;                                } else {
<i>2992</i>&nbsp;                                    this.reportSchemaError(&quot;src-redefine.5.b.d&quot;, new Object[]{greatGrandKidName1, (currSchema.fTargetNamespace == null?&quot;&quot;:currSchema.fTargetNamespace) + &quot;,&quot; + oldName}, groupRefsCount1);
<i>2993</i>&nbsp;                                }
<i>2994</i>&nbsp;                            }
<i>2995</i>&nbsp;                        }
<i>2996</i>&nbsp;                    }
<i>2997</i>&nbsp;                }
<i>2998</i>&nbsp;            }
<i>2999</i>&nbsp;        } else {
<i>3000</i>&nbsp;            String processedBaseName1;
<i>3001</i>&nbsp;            int groupRefsCount2;
<i>3002</i>&nbsp;            if(componentType.equals(SchemaSymbols.ELT_ATTRIBUTEGROUP)) {
<i>3003</i>&nbsp;                processedBaseName1 = currSchema.fTargetNamespace == null?&quot;,&quot; + oldName:currSchema.fTargetNamespace + &quot;,&quot; + oldName;
<i>3004</i>&nbsp;                groupRefsCount2 = this.changeRedefineGroup(processedBaseName1, componentType, newName, child, currSchema);
<i>3005</i>&nbsp;                if(groupRefsCount2 &gt; 1) {
<i>3006</i>&nbsp;                    this.reportSchemaError(&quot;src-redefine.7.1&quot;, new Object[]{new Integer(groupRefsCount2)}, child);
<i>3007</i>&nbsp;                } else if(groupRefsCount2 != 1) {
<i>3008</i>&nbsp;                    if(currSchema.fTargetNamespace == null) {
<i>3009</i>&nbsp;                        this.fRedefinedRestrictedAttributeGroupRegistry.put(processedBaseName1, &quot;,&quot; + newName);
<i>3010</i>&nbsp;                    } else {
<i>3011</i>&nbsp;                        this.fRedefinedRestrictedAttributeGroupRegistry.put(processedBaseName1, currSchema.fTargetNamespace + &quot;,&quot; + newName);
<i>3012</i>&nbsp;                    }
<i>3013</i>&nbsp;                }
<i>3014</i>&nbsp;            } else if(componentType.equals(SchemaSymbols.ELT_GROUP)) {
<i>3015</i>&nbsp;                processedBaseName1 = currSchema.fTargetNamespace == null?&quot;,&quot; + oldName:currSchema.fTargetNamespace + &quot;,&quot; + oldName;
<i>3016</i>&nbsp;                groupRefsCount2 = this.changeRedefineGroup(processedBaseName1, componentType, newName, child, currSchema);
<i>3017</i>&nbsp;                if(groupRefsCount2 &gt; 1) {
<i>3018</i>&nbsp;                    this.reportSchemaError(&quot;src-redefine.6.1.1&quot;, new Object[]{new Integer(groupRefsCount2)}, child);
<i>3019</i>&nbsp;                } else if(groupRefsCount2 != 1) {
<i>3020</i>&nbsp;                    if(currSchema.fTargetNamespace == null) {
<i>3021</i>&nbsp;                        this.fRedefinedRestrictedGroupRegistry.put(processedBaseName1, &quot;,&quot; + newName);
<i>3022</i>&nbsp;                    } else {
<i>3023</i>&nbsp;                        this.fRedefinedRestrictedGroupRegistry.put(processedBaseName1, currSchema.fTargetNamespace + &quot;,&quot; + newName);
<i>3024</i>&nbsp;                    }
<i>3025</i>&nbsp;                }
<i>3026</i>&nbsp;            } else {
<i>3027</i>&nbsp;                this.reportSchemaError(&quot;Internal-Error&quot;, new Object[]{&quot;could not handle this particular &lt;redefine&gt;; please submit your schemas and instance document in a bug report!&quot;}, child);
<i>3028</i>&nbsp;            }
<i>3029</i>&nbsp;        }
<i>3030</i>&nbsp;
<i>3031</i>&nbsp;    }
<i>3032</i>&nbsp;
<i>3033</i>&nbsp;    private String findQName(String name, XSDocumentInfo schemaDoc) {
<i>3034</i>&nbsp;        SchemaNamespaceSupport currNSMap = schemaDoc.fNamespaceSupport;
<i>3035</i>&nbsp;        int colonPtr = name.indexOf(58);
<i>3036</i>&nbsp;        String prefix = XMLSymbols.EMPTY_STRING;
<i>3037</i>&nbsp;        if(colonPtr &gt; 0) {
<i>3038</i>&nbsp;            prefix = name.substring(0, colonPtr);
<i>3039</i>&nbsp;        }
<i>3040</i>&nbsp;
<i>3041</i>&nbsp;        String uri = currNSMap.getURI(this.fSymbolTable.addSymbol(prefix));
<i>3042</i>&nbsp;        String localpart = colonPtr == 0?name:name.substring(colonPtr + 1);
<i>3043</i>&nbsp;        if(prefix == XMLSymbols.EMPTY_STRING &amp;&amp; uri == null &amp;&amp; schemaDoc.fIsChameleonSchema) {
<i>3044</i>&nbsp;            uri = schemaDoc.fTargetNamespace;
<i>3045</i>&nbsp;        }
<i>3046</i>&nbsp;
<i>3047</i>&nbsp;        return uri == null?&quot;,&quot; + localpart:uri + &quot;,&quot; + localpart;
<i>3048</i>&nbsp;    }
<i>3049</i>&nbsp;
<i>3050</i>&nbsp;    private int changeRedefineGroup(String originalQName, String elementSought, String newName, Element curr, XSDocumentInfo schemaDoc) {
<i>3051</i>&nbsp;        int result = 0;
<i>3052</i>&nbsp;
<i>3053</i>&nbsp;        for(Element child = DOMUtil.getFirstChildElement(curr); child != null; child = DOMUtil.getNextSiblingElement(child)) {
<i>3054</i>&nbsp;            String name = DOMUtil.getLocalName(child);
<i>3055</i>&nbsp;            if(!name.equals(elementSought)) {
<i>3056</i>&nbsp;                result += this.changeRedefineGroup(originalQName, elementSought, newName, child, schemaDoc);
<i>3057</i>&nbsp;            } else {
<i>3058</i>&nbsp;                String ref = child.getAttribute(SchemaSymbols.ATT_REF);
<i>3059</i>&nbsp;                if(ref.length() != 0) {
<i>3060</i>&nbsp;                    String processedRef = this.findQName(ref, schemaDoc);
<i>3061</i>&nbsp;                    if(originalQName.equals(processedRef)) {
<i>3062</i>&nbsp;                        String prefix = XMLSymbols.EMPTY_STRING;
<i>3063</i>&nbsp;                        int colonptr = ref.indexOf(&quot;:&quot;);
<i>3064</i>&nbsp;                        if(colonptr &gt; 0) {
<i>3065</i>&nbsp;                            prefix = ref.substring(0, colonptr);
<i>3066</i>&nbsp;                            child.setAttribute(SchemaSymbols.ATT_REF, prefix + &quot;:&quot; + newName);
<i>3067</i>&nbsp;                        } else {
<i>3068</i>&nbsp;                            child.setAttribute(SchemaSymbols.ATT_REF, newName);
<i>3069</i>&nbsp;                        }
<i>3070</i>&nbsp;
<i>3071</i>&nbsp;                        ++result;
<i>3072</i>&nbsp;                        if(elementSought.equals(SchemaSymbols.ELT_GROUP)) {
<i>3073</i>&nbsp;                            String minOccurs = child.getAttribute(SchemaSymbols.ATT_MINOCCURS);
<i>3074</i>&nbsp;                            String maxOccurs = child.getAttribute(SchemaSymbols.ATT_MAXOCCURS);
<i>3075</i>&nbsp;                            if(maxOccurs.length() != 0 &amp;&amp; !maxOccurs.equals(&quot;1&quot;) || minOccurs.length() != 0 &amp;&amp; !minOccurs.equals(&quot;1&quot;)) {
<i>3076</i>&nbsp;                                this.reportSchemaError(&quot;src-redefine.6.1.2&quot;, new Object[]{ref}, child);
<i>3077</i>&nbsp;                            }
<i>3078</i>&nbsp;                        }
<i>3079</i>&nbsp;                    }
<i>3080</i>&nbsp;                }
<i>3081</i>&nbsp;            }
<i>3082</i>&nbsp;        }
<i>3083</i>&nbsp;
<i>3084</i>&nbsp;        return result;
<i>3085</i>&nbsp;    }
<i>3086</i>&nbsp;
<i>3087</i>&nbsp;    private XSDocumentInfo findXSDocumentForDecl(XSDocumentInfo currSchema, Element decl, XSDocumentInfo decl_Doc) {
<i>3088</i>&nbsp;        if(decl_Doc == null) {
<i>3089</i>&nbsp;            return null;
<i>3090</i>&nbsp;        } else {
<i>3091</i>&nbsp;            XSDocumentInfo declDocInfo = (XSDocumentInfo)decl_Doc;
<i>3092</i>&nbsp;            return declDocInfo;
<i>3093</i>&nbsp;        }
<i>3094</i>&nbsp;    }
<i>3095</i>&nbsp;
<i>3096</i>&nbsp;    private boolean nonAnnotationContent(Element elem) {
<i>3097</i>&nbsp;        for(Element child = DOMUtil.getFirstChildElement(elem); child != null; child = DOMUtil.getNextSiblingElement(child)) {
<i>3098</i>&nbsp;            if(!DOMUtil.getLocalName(child).equals(SchemaSymbols.ELT_ANNOTATION)) {
<i>3099</i>&nbsp;                return true;
<i>3100</i>&nbsp;            }
<i>3101</i>&nbsp;        }
<i>3102</i>&nbsp;
<i>3103</i>&nbsp;        return false;
<i>3104</i>&nbsp;    }
<i>3105</i>&nbsp;
<i>3106</i>&nbsp;    private void setSchemasVisible(XSDocumentInfo startSchema) {
<i>3107</i>&nbsp;        if(DOMUtil.isHidden(startSchema.fSchemaElement, this.fHiddenNodes)) {
<i>3108</i>&nbsp;            DOMUtil.setVisible(startSchema.fSchemaElement, this.fHiddenNodes);
<i>3109</i>&nbsp;            Vector dependingSchemas = (Vector)this.fDependencyMap.get(startSchema);
<i>3110</i>&nbsp;
<i>3111</i>&nbsp;            for(int i = 0; i &lt; dependingSchemas.size(); ++i) {
<i>3112</i>&nbsp;                this.setSchemasVisible((XSDocumentInfo)dependingSchemas.elementAt(i));
<i>3113</i>&nbsp;            }
<i>3114</i>&nbsp;        }
<i>3115</i>&nbsp;
<i>3116</i>&nbsp;    }
<i>3117</i>&nbsp;
<i>3118</i>&nbsp;    public SimpleLocator element2Locator(Element e) {
<i>3119</i>&nbsp;        if(!(e instanceof ElementImpl)) {
<i>3120</i>&nbsp;            return null;
<i>3121</i>&nbsp;        } else {
<i>3122</i>&nbsp;            SimpleLocator l = new SimpleLocator();
<i>3123</i>&nbsp;            return this.element2Locator(e, l)?l:null;
<i>3124</i>&nbsp;        }
<i>3125</i>&nbsp;    }
<i>3126</i>&nbsp;
<i>3127</i>&nbsp;    public boolean element2Locator(Element e, SimpleLocator l) {
<i>3128</i>&nbsp;        if(l == null) {
<i>3129</i>&nbsp;            return false;
<i>3130</i>&nbsp;        } else if(e instanceof ElementImpl) {
<i>3131</i>&nbsp;            ElementImpl ele = (ElementImpl)e;
<i>3132</i>&nbsp;            Document doc = ele.getOwnerDocument();
<i>3133</i>&nbsp;            String sid = (String)this.fDoc2SystemId.get(DOMUtil.getRoot(doc));
<i>3134</i>&nbsp;            int line = ele.getLineNumber();
<i>3135</i>&nbsp;            int column = ele.getColumnNumber();
<i>3136</i>&nbsp;            l.setValues(sid, sid, line, column, ele.getCharacterOffset());
<i>3137</i>&nbsp;            return true;
<i>3138</i>&nbsp;        } else {
<i>3139</i>&nbsp;            return false;
<i>3140</i>&nbsp;        }
<i>3141</i>&nbsp;    }
<i>3142</i>&nbsp;
<i>3143</i>&nbsp;    private Element getElementFromMap(Map&lt;String, Element&gt; registry, String declKey) {
<i>3144</i>&nbsp;        return registry == null?null:(Element)registry.get(declKey);
<i>3145</i>&nbsp;    }
<i>3146</i>&nbsp;
<i>3147</i>&nbsp;    private XSDocumentInfo getDocInfoFromMap(Map&lt;String, XSDocumentInfo&gt; registry, String declKey) {
<i>3148</i>&nbsp;        return registry == null?null:(XSDocumentInfo)registry.get(declKey);
<i>3149</i>&nbsp;    }
<i>3150</i>&nbsp;
<i>3151</i>&nbsp;    private Object getFromMap(Map registry, String key) {
<i>3152</i>&nbsp;        return registry == null?null:registry.get(key);
<i>3153</i>&nbsp;    }
<i>3154</i>&nbsp;
<i>3155</i>&nbsp;    void reportSchemaFatalError(String key, Object[] args, Element ele) {
<i>3156</i>&nbsp;        this.reportSchemaErr(key, args, ele, (short)2, (Exception)null);
<i>3157</i>&nbsp;    }
<i>3158</i>&nbsp;
<i>3159</i>&nbsp;    void reportSchemaError(String key, Object[] args, Element ele) {
<i>3160</i>&nbsp;        this.reportSchemaErr(key, args, ele, (short)1, (Exception)null);
<i>3161</i>&nbsp;    }
<i>3162</i>&nbsp;
<i>3163</i>&nbsp;    void reportSchemaError(String key, Object[] args, Element ele, Exception exception) {
<i>3164</i>&nbsp;        this.reportSchemaErr(key, args, ele, (short)1, exception);
<i>3165</i>&nbsp;    }
<i>3166</i>&nbsp;
<i>3167</i>&nbsp;    void reportSchemaWarning(String key, Object[] args, Element ele) {
<i>3168</i>&nbsp;        this.reportSchemaErr(key, args, ele, (short)0, (Exception)null);
<i>3169</i>&nbsp;    }
<i>3170</i>&nbsp;
<i>3171</i>&nbsp;    void reportSchemaWarning(String key, Object[] args, Element ele, Exception exception) {
<i>3172</i>&nbsp;        this.reportSchemaErr(key, args, ele, (short)0, exception);
<i>3173</i>&nbsp;    }
<i>3174</i>&nbsp;
<i>3175</i>&nbsp;    void reportSchemaErr(String key, Object[] args, Element ele, short type, Exception exception) {
<i>3176</i>&nbsp;        if(this.element2Locator(ele, this.xl)) {
<i>3177</i>&nbsp;            this.fErrorReporter.reportError(this.xl, &quot;http://www.w3.org/TR/xml-schema-1&quot;, key, args, type, exception);
<i>3178</i>&nbsp;        } else {
<i>3179</i>&nbsp;            this.fErrorReporter.reportError(&quot;http://www.w3.org/TR/xml-schema-1&quot;, key, args, type, exception);
<i>3180</i>&nbsp;        }
<i>3181</i>&nbsp;
<i>3182</i>&nbsp;    }
<i>3183</i>&nbsp;
<i>3184</i>&nbsp;    public void setGenerateSyntheticAnnotations(boolean state) {
<i>3185</i>&nbsp;        this.fSchemaParser.setFeature(&quot;http://apache.org/xml/features/generate-synthetic-annotations&quot;, state);
<i>3186</i>&nbsp;    }
<i>3187</i>&nbsp;
<i>3188</i>&nbsp;    private static final class SAX2XNIUtil extends ErrorHandlerWrapper {
<i>3189</i>&nbsp;        private SAX2XNIUtil() {
<i>3190</i>&nbsp;        }
<i>3191</i>&nbsp;
<i>3192</i>&nbsp;        public static XMLParseException createXMLParseException0(SAXParseException exception) {
<i>3193</i>&nbsp;            return createXMLParseException(exception);
<i>3194</i>&nbsp;        }
<i>3195</i>&nbsp;
<i>3196</i>&nbsp;        public static XNIException createXNIException0(SAXException exception) {
<i>3197</i>&nbsp;            return createXNIException(exception);
<i>3198</i>&nbsp;        }
<i>3199</i>&nbsp;    }
<i>3200</i>&nbsp;
<i>3201</i>&nbsp;    private static class XSDKey {
<i>3202</i>&nbsp;        String systemId;
<i>3203</i>&nbsp;        short referType;
<i>3204</i>&nbsp;        String referNS;
<i>3205</i>&nbsp;
<i>3206</i>&nbsp;        XSDKey(String systemId, short referType, String referNS) {
<i>3207</i>&nbsp;            this.systemId = systemId;
<i>3208</i>&nbsp;            this.referType = referType;
<i>3209</i>&nbsp;            this.referNS = referNS;
<i>3210</i>&nbsp;        }
<i>3211</i>&nbsp;
<i>3212</i>&nbsp;        public int hashCode() {
<i>3213</i>&nbsp;            return this.referNS == null?0:this.referNS.hashCode();
<i>3214</i>&nbsp;        }
<i>3215</i>&nbsp;
<i>3216</i>&nbsp;        public boolean equals(Object obj) {
<i>3217</i>&nbsp;            if(!(obj instanceof XSDHandler.XSDKey)) {
<i>3218</i>&nbsp;                return false;
<i>3219</i>&nbsp;            } else {
<i>3220</i>&nbsp;                XSDHandler.XSDKey key = (XSDHandler.XSDKey)obj;
<i>3221</i>&nbsp;                return this.referNS != key.referNS?false:this.systemId != null &amp;&amp; this.systemId.equals(key.systemId);
<i>3222</i>&nbsp;            }
<i>3223</i>&nbsp;        }
<i>3224</i>&nbsp;    }
<i>3225</i>&nbsp;
<i>3226</i>&nbsp;    private static class XSAnnotationGrammarPool implements XMLGrammarPool {
<i>3227</i>&nbsp;        private XSGrammarBucket fGrammarBucket;
<i>3228</i>&nbsp;        private Grammar[] fInitialGrammarSet;
<i>3229</i>&nbsp;
<i>3230</i>&nbsp;        private XSAnnotationGrammarPool() {
<i>3231</i>&nbsp;        }
<i>3232</i>&nbsp;
<i>3233</i>&nbsp;        public Grammar[] retrieveInitialGrammarSet(String grammarType) {
<i>3234</i>&nbsp;            if(grammarType != &quot;http://www.w3.org/2001/XMLSchema&quot;) {
<i>3235</i>&nbsp;                return new Grammar[0];
<i>3236</i>&nbsp;            } else {
<i>3237</i>&nbsp;                if(this.fInitialGrammarSet == null) {
<i>3238</i>&nbsp;                    if(this.fGrammarBucket == null) {
<i>3239</i>&nbsp;                        this.fInitialGrammarSet = new Grammar[]{Schema4Annotations.INSTANCE};
<i>3240</i>&nbsp;                    } else {
<i>3241</i>&nbsp;                        SchemaGrammar[] schemaGrammars = this.fGrammarBucket.getGrammars();
<i>3242</i>&nbsp;
<i>3243</i>&nbsp;                        for(int grammars = 0; grammars &lt; schemaGrammars.length; ++grammars) {
<i>3244</i>&nbsp;                            if(SchemaSymbols.URI_SCHEMAFORSCHEMA.equals(schemaGrammars[grammars].getTargetNamespace())) {
<i>3245</i>&nbsp;                                this.fInitialGrammarSet = schemaGrammars;
<i>3246</i>&nbsp;                                return this.fInitialGrammarSet;
<i>3247</i>&nbsp;                            }
<i>3248</i>&nbsp;                        }
<i>3249</i>&nbsp;
<i>3250</i>&nbsp;                        Grammar[] var4 = new Grammar[schemaGrammars.length + 1];
<i>3251</i>&nbsp;                        System.arraycopy(schemaGrammars, 0, var4, 0, schemaGrammars.length);
<i>3252</i>&nbsp;                        var4[var4.length - 1] = Schema4Annotations.INSTANCE;
<i>3253</i>&nbsp;                        this.fInitialGrammarSet = var4;
<i>3254</i>&nbsp;                    }
<i>3255</i>&nbsp;                }
<i>3256</i>&nbsp;
<i>3257</i>&nbsp;                return this.fInitialGrammarSet;
<i>3258</i>&nbsp;            }
<i>3259</i>&nbsp;        }
<i>3260</i>&nbsp;
<i>3261</i>&nbsp;        public void cacheGrammars(String grammarType, Grammar[] grammars) {
<i>3262</i>&nbsp;        }
<i>3263</i>&nbsp;
<i>3264</i>&nbsp;        public Grammar retrieveGrammar(XMLGrammarDescription desc) {
<i>3265</i>&nbsp;            if(desc.getGrammarType() == &quot;http://www.w3.org/2001/XMLSchema&quot;) {
<i>3266</i>&nbsp;                String tns = ((XMLSchemaDescription)desc).getTargetNamespace();
<i>3267</i>&nbsp;                if(this.fGrammarBucket != null) {
<i>3268</i>&nbsp;                    SchemaGrammar grammar = this.fGrammarBucket.getGrammar(tns);
<i>3269</i>&nbsp;                    if(grammar != null) {
<i>3270</i>&nbsp;                        return grammar;
<i>3271</i>&nbsp;                    }
<i>3272</i>&nbsp;                }
<i>3273</i>&nbsp;
<i>3274</i>&nbsp;                if(SchemaSymbols.URI_SCHEMAFORSCHEMA.equals(tns)) {
<i>3275</i>&nbsp;                    return Schema4Annotations.INSTANCE;
<i>3276</i>&nbsp;                }
<i>3277</i>&nbsp;            }
<i>3278</i>&nbsp;
<i>3279</i>&nbsp;            return null;
<i>3280</i>&nbsp;        }
<i>3281</i>&nbsp;
<i>3282</i>&nbsp;        public void refreshGrammars(XSGrammarBucket gBucket) {
<i>3283</i>&nbsp;            this.fGrammarBucket = gBucket;
<i>3284</i>&nbsp;            this.fInitialGrammarSet = null;
<i>3285</i>&nbsp;        }
<i>3286</i>&nbsp;
<i>3287</i>&nbsp;        public void lockPool() {
<i>3288</i>&nbsp;        }
<i>3289</i>&nbsp;
<i>3290</i>&nbsp;        public void unlockPool() {
<i>3291</i>&nbsp;        }
<i>3292</i>&nbsp;
<i>3293</i>&nbsp;        public void clear() {
<i>3294</i>&nbsp;        }
<i>3295</i>&nbsp;    }
<i>3296</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2014-12-10 02:36</div>
</div>
</body>
</html>
