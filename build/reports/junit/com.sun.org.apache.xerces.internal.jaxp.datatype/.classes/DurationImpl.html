


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: DurationImpl</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">com.sun.org.apache.xerces.internal.jaxp.datatype</a> ]
</div>

<h1>Coverage Summary for Class: DurationImpl (com.sun.org.apache.xerces.internal.jaxp.datatype)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DurationImpl</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 49)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 409)
  </span>
</td>
</tr>
  <tr>
    <td class="name">DurationImpl$DurationStream</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 52)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 413)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;//
<i>2</i>&nbsp;// Source code recreated from a .class file by IntelliJ IDEA
<i>3</i>&nbsp;// (powered by Fernflower decompiler)
<i>4</i>&nbsp;//
<i>5</i>&nbsp;
<i>6</i>&nbsp;package com.sun.org.apache.xerces.internal.jaxp.datatype;
<i>7</i>&nbsp;
<i>8</i>&nbsp;import com.sun.org.apache.xerces.internal.jaxp.datatype.XMLGregorianCalendarImpl;
<i>9</i>&nbsp;import com.sun.org.apache.xerces.internal.util.DatatypeMessageFormatter;
<i>10</i>&nbsp;import java.io.IOException;
<i>11</i>&nbsp;import java.io.ObjectStreamException;
<i>12</i>&nbsp;import java.io.Serializable;
<i>13</i>&nbsp;import java.math.BigDecimal;
<i>14</i>&nbsp;import java.math.BigInteger;
<i>15</i>&nbsp;import java.util.Calendar;
<i>16</i>&nbsp;import java.util.Date;
<i>17</i>&nbsp;import java.util.GregorianCalendar;
<i>18</i>&nbsp;import java.util.Locale;
<i>19</i>&nbsp;import java.util.TimeZone;
<i>20</i>&nbsp;import javax.xml.datatype.DatatypeConstants;
<i>21</i>&nbsp;import javax.xml.datatype.Duration;
<i>22</i>&nbsp;import javax.xml.datatype.XMLGregorianCalendar;
<i>23</i>&nbsp;import javax.xml.datatype.DatatypeConstants.Field;
<i>24</i>&nbsp;
<i>25</i>&nbsp;class DurationImpl extends Duration implements Serializable {
<i>26</i>&nbsp;    private static final int FIELD_NUM = 6;
<i>27</i>&nbsp;    private static final Field[] FIELDS;
<i>28</i>&nbsp;    private static final int[] FIELD_IDS;
<i>29</i>&nbsp;    private static final TimeZone GMT;
<i>30</i>&nbsp;    private static final BigDecimal ZERO;
<i>31</i>&nbsp;    protected int signum;
<i>32</i>&nbsp;    protected BigInteger years;
<i>33</i>&nbsp;    protected BigInteger months;
<i>34</i>&nbsp;    protected BigInteger days;
<i>35</i>&nbsp;    protected BigInteger hours;
<i>36</i>&nbsp;    protected BigInteger minutes;
<i>37</i>&nbsp;    protected BigDecimal seconds;
<i>38</i>&nbsp;    private static final XMLGregorianCalendar[] TEST_POINTS;
<i>39</i>&nbsp;    private static final BigDecimal[] FACTORS;
<i>40</i>&nbsp;    private static final long serialVersionUID = 1L;
<i>41</i>&nbsp;
<i>42</i>&nbsp;    public int getSign() {
<i>43</i>&nbsp;        return this.signum;
<i>44</i>&nbsp;    }
<i>45</i>&nbsp;
<i>46</i>&nbsp;    protected int calcSignum(boolean isPositive) {
<i>47</i>&nbsp;        return (this.years == null || this.years.signum() == 0) &amp;&amp; (this.months == null || this.months.signum() == 0) &amp;&amp; (this.days == null || this.days.signum() == 0) &amp;&amp; (this.hours == null || this.hours.signum() == 0) &amp;&amp; (this.minutes == null || this.minutes.signum() == 0) &amp;&amp; (this.seconds == null || this.seconds.signum() == 0)?0:(isPositive?1:-1);
<i>48</i>&nbsp;    }
<i>49</i>&nbsp;
<i>50</i>&nbsp;    protected DurationImpl(boolean isPositive, BigInteger years, BigInteger months, BigInteger days, BigInteger hours, BigInteger minutes, BigDecimal seconds) {
<i>51</i>&nbsp;        this.years = years;
<i>52</i>&nbsp;        this.months = months;
<i>53</i>&nbsp;        this.days = days;
<i>54</i>&nbsp;        this.hours = hours;
<i>55</i>&nbsp;        this.minutes = minutes;
<i>56</i>&nbsp;        this.seconds = seconds;
<i>57</i>&nbsp;        this.signum = this.calcSignum(isPositive);
<i>58</i>&nbsp;        if(years == null &amp;&amp; months == null &amp;&amp; days == null &amp;&amp; hours == null &amp;&amp; minutes == null &amp;&amp; seconds == null) {
<i>59</i>&nbsp;            throw new IllegalArgumentException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;AllFieldsNull&quot;, (Object[])null));
<i>60</i>&nbsp;        } else {
<i>61</i>&nbsp;            testNonNegative((BigInteger)years, DatatypeConstants.YEARS);
<i>62</i>&nbsp;            testNonNegative((BigInteger)months, DatatypeConstants.MONTHS);
<i>63</i>&nbsp;            testNonNegative((BigInteger)days, DatatypeConstants.DAYS);
<i>64</i>&nbsp;            testNonNegative((BigInteger)hours, DatatypeConstants.HOURS);
<i>65</i>&nbsp;            testNonNegative((BigInteger)minutes, DatatypeConstants.MINUTES);
<i>66</i>&nbsp;            testNonNegative((BigDecimal)seconds, DatatypeConstants.SECONDS);
<i>67</i>&nbsp;        }
<i>68</i>&nbsp;    }
<i>69</i>&nbsp;
<i>70</i>&nbsp;    protected static void testNonNegative(BigInteger n, Field f) {
<i>71</i>&nbsp;        if(n != null &amp;&amp; n.signum() &lt; 0) {
<i>72</i>&nbsp;            throw new IllegalArgumentException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;NegativeField&quot;, new Object[]{f.toString()}));
<i>73</i>&nbsp;        }
<i>74</i>&nbsp;    }
<i>75</i>&nbsp;
<i>76</i>&nbsp;    protected static void testNonNegative(BigDecimal n, Field f) {
<i>77</i>&nbsp;        if(n != null &amp;&amp; n.signum() &lt; 0) {
<i>78</i>&nbsp;            throw new IllegalArgumentException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;NegativeField&quot;, new Object[]{f.toString()}));
<i>79</i>&nbsp;        }
<i>80</i>&nbsp;    }
<i>81</i>&nbsp;
<i>82</i>&nbsp;    protected DurationImpl(boolean isPositive, int years, int months, int days, int hours, int minutes, int seconds) {
<i>83</i>&nbsp;        this(isPositive, wrap(years), wrap(months), wrap(days), wrap(hours), wrap(minutes), seconds != -2147483648?new BigDecimal(String.valueOf(seconds)):null);
<i>84</i>&nbsp;    }
<i>85</i>&nbsp;
<i>86</i>&nbsp;    protected static BigInteger wrap(int i) {
<i>87</i>&nbsp;        return i == -2147483648?null:new BigInteger(String.valueOf(i));
<i>88</i>&nbsp;    }
<i>89</i>&nbsp;
<i>90</i>&nbsp;    protected DurationImpl(long durationInMilliSeconds) {
<i>91</i>&nbsp;        long l = durationInMilliSeconds;
<i>92</i>&nbsp;        if(durationInMilliSeconds &gt; 0L) {
<i>93</i>&nbsp;            this.signum = 1;
<i>94</i>&nbsp;        } else if(durationInMilliSeconds &lt; 0L) {
<i>95</i>&nbsp;            this.signum = -1;
<i>96</i>&nbsp;            if(durationInMilliSeconds == -9223372036854775808L) {
<i>97</i>&nbsp;                l = durationInMilliSeconds + 1L;
<i>98</i>&nbsp;            }
<i>99</i>&nbsp;
<i>100</i>&nbsp;            l *= -1L;
<i>101</i>&nbsp;        } else {
<i>102</i>&nbsp;            this.signum = 0;
<i>103</i>&nbsp;        }
<i>104</i>&nbsp;
<i>105</i>&nbsp;        GregorianCalendar gregorianCalendar = new GregorianCalendar(GMT);
<i>106</i>&nbsp;        gregorianCalendar.setTimeInMillis(l);
<i>107</i>&nbsp;        long int2long = 0L;
<i>108</i>&nbsp;        int2long = (long)(gregorianCalendar.get(1) - 1970);
<i>109</i>&nbsp;        this.years = BigInteger.valueOf(int2long);
<i>110</i>&nbsp;        int2long = (long)gregorianCalendar.get(2);
<i>111</i>&nbsp;        this.months = BigInteger.valueOf(int2long);
<i>112</i>&nbsp;        int2long = (long)(gregorianCalendar.get(5) - 1);
<b class="nc"><i>113</i>&nbsp;        this.days = BigInteger.valueOf(int2long);</b>
<i>114</i>&nbsp;        int2long = (long)gregorianCalendar.get(11);
<i>115</i>&nbsp;        this.hours = BigInteger.valueOf(int2long);
<i>116</i>&nbsp;        int2long = (long)gregorianCalendar.get(12);
<i>117</i>&nbsp;        this.minutes = BigInteger.valueOf(int2long);
<i>118</i>&nbsp;        int2long = (long)(gregorianCalendar.get(13) * 1000 + gregorianCalendar.get(14));
<i>119</i>&nbsp;        this.seconds = BigDecimal.valueOf(int2long, 3);
<i>120</i>&nbsp;    }
<i>121</i>&nbsp;
<i>122</i>&nbsp;    protected DurationImpl(String lexicalRepresentation) throws IllegalArgumentException {
<i>123</i>&nbsp;        String s = lexicalRepresentation;
<i>124</i>&nbsp;        int[] idx = new int[1];
<b class="nc"><i>125</i>&nbsp;        int length = lexicalRepresentation.length();</b>
<i>126</i>&nbsp;        boolean timeRequired = false;
<i>127</i>&nbsp;        if(lexicalRepresentation == null) {
<i>128</i>&nbsp;            throw new NullPointerException();
<i>129</i>&nbsp;        } else {
<i>130</i>&nbsp;            idx[0] = 0;
<i>131</i>&nbsp;            boolean positive;
<i>132</i>&nbsp;            if(length != idx[0] &amp;&amp; lexicalRepresentation.charAt(idx[0]) == 45) {
<i>133</i>&nbsp;                ++idx[0];
<i>134</i>&nbsp;                positive = false;
<i>135</i>&nbsp;            } else {
<i>136</i>&nbsp;                positive = true;
<b class="nc"><i>137</i>&nbsp;            }</b>
<i>138</i>&nbsp;
<i>139</i>&nbsp;            int var10004;
<i>140</i>&nbsp;            int var10001;
<i>141</i>&nbsp;            if(length != idx[0]) {
<b class="nc"><i>142</i>&nbsp;                var10004 = idx[0];</b>
<i>143</i>&nbsp;                var10001 = idx[0];
<i>144</i>&nbsp;                idx[0] = var10004 + 1;
<i>145</i>&nbsp;                if(lexicalRepresentation.charAt(var10001) != 80) {
<i>146</i>&nbsp;                    throw new IllegalArgumentException(lexicalRepresentation);
<i>147</i>&nbsp;                }
<i>148</i>&nbsp;            }
<i>149</i>&nbsp;
<i>150</i>&nbsp;            int dateLen = 0;
<i>151</i>&nbsp;            String[] dateParts = new String[3];
<i>152</i>&nbsp;
<i>153</i>&nbsp;            int[] datePartsIndex;
<i>154</i>&nbsp;            for(datePartsIndex = new int[3]; length != idx[0] &amp;&amp; isDigit(s.charAt(idx[0])) &amp;&amp; dateLen &lt; 3; dateParts[dateLen++] = parsePiece(s, idx)) {
<i>155</i>&nbsp;                datePartsIndex[dateLen] = idx[0];
<i>156</i>&nbsp;            }
<i>157</i>&nbsp;
<i>158</i>&nbsp;            if(length != idx[0]) {
<i>159</i>&nbsp;                var10004 = idx[0];
<i>160</i>&nbsp;                var10001 = idx[0];
<i>161</i>&nbsp;                idx[0] = var10004 + 1;
<i>162</i>&nbsp;                if(s.charAt(var10001) != 84) {
<i>163</i>&nbsp;                    throw new IllegalArgumentException(s);
<i>164</i>&nbsp;                }
<i>165</i>&nbsp;
<i>166</i>&nbsp;                timeRequired = true;
<i>167</i>&nbsp;            }
<i>168</i>&nbsp;
<i>169</i>&nbsp;            int timeLen = 0;
<i>170</i>&nbsp;            String[] timeParts = new String[3];
<i>171</i>&nbsp;
<i>172</i>&nbsp;            int[] timePartsIndex;
<i>173</i>&nbsp;            for(timePartsIndex = new int[3]; length != idx[0] &amp;&amp; isDigitOrPeriod(s.charAt(idx[0])) &amp;&amp; timeLen &lt; 3; timeParts[timeLen++] = parsePiece(s, idx)) {
<i>174</i>&nbsp;                timePartsIndex[timeLen] = idx[0];
<i>175</i>&nbsp;            }
<i>176</i>&nbsp;
<i>177</i>&nbsp;            if(timeRequired &amp;&amp; timeLen == 0) {
<i>178</i>&nbsp;                throw new IllegalArgumentException(s);
<i>179</i>&nbsp;            } else if(length != idx[0]) {
<i>180</i>&nbsp;                throw new IllegalArgumentException(s);
<i>181</i>&nbsp;            } else if(dateLen == 0 &amp;&amp; timeLen == 0) {
<i>182</i>&nbsp;                throw new IllegalArgumentException(s);
<i>183</i>&nbsp;            } else {
<i>184</i>&nbsp;                organizeParts(s, dateParts, datePartsIndex, dateLen, &quot;YMD&quot;);
<i>185</i>&nbsp;                organizeParts(s, timeParts, timePartsIndex, timeLen, &quot;HMS&quot;);
<i>186</i>&nbsp;                this.years = parseBigInteger(s, dateParts[0], datePartsIndex[0]);
<i>187</i>&nbsp;                this.months = parseBigInteger(s, dateParts[1], datePartsIndex[1]);
<i>188</i>&nbsp;                this.days = parseBigInteger(s, dateParts[2], datePartsIndex[2]);
<i>189</i>&nbsp;                this.hours = parseBigInteger(s, timeParts[0], timePartsIndex[0]);
<i>190</i>&nbsp;                this.minutes = parseBigInteger(s, timeParts[1], timePartsIndex[1]);
<i>191</i>&nbsp;                this.seconds = parseBigDecimal(s, timeParts[2], timePartsIndex[2]);
<i>192</i>&nbsp;                this.signum = this.calcSignum(positive);
<i>193</i>&nbsp;            }
<b class="nc"><i>194</i>&nbsp;        }</b>
<i>195</i>&nbsp;    }
<i>196</i>&nbsp;
<i>197</i>&nbsp;    private static boolean isDigit(char ch) {
<i>198</i>&nbsp;        return 48 &lt;= ch &amp;&amp; ch &lt;= 57;
<i>199</i>&nbsp;    }
<i>200</i>&nbsp;
<i>201</i>&nbsp;    private static boolean isDigitOrPeriod(char ch) {
<i>202</i>&nbsp;        return isDigit(ch) || ch == 46;
<i>203</i>&nbsp;    }
<b class="nc"><i>204</i>&nbsp;</b>
<i>205</i>&nbsp;    private static String parsePiece(String whole, int[] idx) throws IllegalArgumentException {
<i>206</i>&nbsp;        int start;
<i>207</i>&nbsp;        for(start = idx[0]; idx[0] &lt; whole.length() &amp;&amp; isDigitOrPeriod(whole.charAt(idx[0])); ++idx[0]) {
<i>208</i>&nbsp;            ;
<i>209</i>&nbsp;        }
<b class="nc"><i>210</i>&nbsp;</b>
<i>211</i>&nbsp;        if(idx[0] == whole.length()) {
<i>212</i>&nbsp;            throw new IllegalArgumentException(whole);
<b class="nc"><i>213</i>&nbsp;        } else {</b>
<b class="nc"><i>214</i>&nbsp;            ++idx[0];</b>
<i>215</i>&nbsp;            return whole.substring(start, idx[0]);
<b class="nc"><i>216</i>&nbsp;        }</b>
<i>217</i>&nbsp;    }
<i>218</i>&nbsp;
<i>219</i>&nbsp;    private static void organizeParts(String whole, String[] parts, int[] partsIndex, int len, String tokens) throws IllegalArgumentException {
<i>220</i>&nbsp;        int idx = tokens.length();
<i>221</i>&nbsp;
<i>222</i>&nbsp;        for(int i = len - 1; i &gt;= 0; --i) {
<i>223</i>&nbsp;            int nidx = tokens.lastIndexOf(parts[i].charAt(parts[i].length() - 1), idx - 1);
<i>224</i>&nbsp;            if(nidx == -1) {
<i>225</i>&nbsp;                throw new IllegalArgumentException(whole);
<i>226</i>&nbsp;            }
<i>227</i>&nbsp;
<i>228</i>&nbsp;            for(int j = nidx + 1; j &lt; idx; ++j) {
<i>229</i>&nbsp;                parts[j] = null;
<i>230</i>&nbsp;            }
<i>231</i>&nbsp;
<i>232</i>&nbsp;            idx = nidx;
<i>233</i>&nbsp;            parts[nidx] = parts[i];
<i>234</i>&nbsp;            partsIndex[nidx] = partsIndex[i];
<i>235</i>&nbsp;        }
<i>236</i>&nbsp;
<i>237</i>&nbsp;        --idx;
<i>238</i>&nbsp;
<i>239</i>&nbsp;        while(idx &gt;= 0) {
<i>240</i>&nbsp;            parts[idx] = null;
<i>241</i>&nbsp;            --idx;
<i>242</i>&nbsp;        }
<i>243</i>&nbsp;
<i>244</i>&nbsp;    }
<i>245</i>&nbsp;
<i>246</i>&nbsp;    private static BigInteger parseBigInteger(String whole, String part, int index) throws IllegalArgumentException {
<i>247</i>&nbsp;        if(part == null) {
<b class="nc"><i>248</i>&nbsp;            return null;</b>
<i>249</i>&nbsp;        } else {
<b class="nc"><i>250</i>&nbsp;            part = part.substring(0, part.length() - 1);</b>
<b class="nc"><i>251</i>&nbsp;            return new BigInteger(part);</b>
<b class="nc"><i>252</i>&nbsp;        }</b>
<b class="nc"><i>253</i>&nbsp;    }</b>
<b class="nc"><i>254</i>&nbsp;</b>
<b class="nc"><i>255</i>&nbsp;    private static BigDecimal parseBigDecimal(String whole, String part, int index) throws IllegalArgumentException {</b>
<i>256</i>&nbsp;        if(part == null) {
<b class="nc"><i>257</i>&nbsp;            return null;</b>
<i>258</i>&nbsp;        } else {
<i>259</i>&nbsp;            part = part.substring(0, part.length() - 1);
<b class="nc"><i>260</i>&nbsp;            return new BigDecimal(part);</b>
<i>261</i>&nbsp;        }
<i>262</i>&nbsp;    }
<i>263</i>&nbsp;
<i>264</i>&nbsp;    public int compare(Duration rhs) {
<i>265</i>&nbsp;        BigInteger maxintAsBigInteger = BigInteger.valueOf(2147483647L);
<b class="nc"><i>266</i>&nbsp;        BigInteger minintAsBigInteger = BigInteger.valueOf(-2147483648L);</b>
<i>267</i>&nbsp;        if(this.years != null &amp;&amp; this.years.compareTo(maxintAsBigInteger) == 1) {
<i>268</i>&nbsp;            throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.YEARS.toString(), this.years.toString()}));
<i>269</i>&nbsp;        } else if(this.months != null &amp;&amp; this.months.compareTo(maxintAsBigInteger) == 1) {
<i>270</i>&nbsp;            throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.MONTHS.toString(), this.months.toString()}));
<b class="nc"><i>271</i>&nbsp;        } else if(this.days != null &amp;&amp; this.days.compareTo(maxintAsBigInteger) == 1) {</b>
<b class="nc"><i>272</i>&nbsp;            throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.DAYS.toString(), this.days.toString()}));</b>
<b class="nc"><i>273</i>&nbsp;        } else if(this.hours != null &amp;&amp; this.hours.compareTo(maxintAsBigInteger) == 1) {</b>
<b class="nc"><i>274</i>&nbsp;            throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.HOURS.toString(), this.hours.toString()}));</b>
<b class="nc"><i>275</i>&nbsp;        } else if(this.minutes != null &amp;&amp; this.minutes.compareTo(maxintAsBigInteger) == 1) {</b>
<b class="nc"><i>276</i>&nbsp;            throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.MINUTES.toString(), this.minutes.toString()}));</b>
<i>277</i>&nbsp;        } else if(this.seconds != null &amp;&amp; this.seconds.toBigInteger().compareTo(maxintAsBigInteger) == 1) {
<i>278</i>&nbsp;            throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.SECONDS.toString(), this.seconds.toString()}));
<i>279</i>&nbsp;        } else {
<i>280</i>&nbsp;            BigInteger rhsYears = (BigInteger)rhs.getField(DatatypeConstants.YEARS);
<i>281</i>&nbsp;            if(rhsYears != null &amp;&amp; rhsYears.compareTo(maxintAsBigInteger) == 1) {
<i>282</i>&nbsp;                throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.YEARS.toString(), rhsYears.toString()}));
<i>283</i>&nbsp;            } else {
<i>284</i>&nbsp;                BigInteger rhsMonths = (BigInteger)rhs.getField(DatatypeConstants.MONTHS);
<i>285</i>&nbsp;                if(rhsMonths != null &amp;&amp; rhsMonths.compareTo(maxintAsBigInteger) == 1) {
<i>286</i>&nbsp;                    throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.MONTHS.toString(), rhsMonths.toString()}));
<b class="nc"><i>287</i>&nbsp;                } else {</b>
<b class="nc"><i>288</i>&nbsp;                    BigInteger rhsDays = (BigInteger)rhs.getField(DatatypeConstants.DAYS);</b>
<i>289</i>&nbsp;                    if(rhsDays != null &amp;&amp; rhsDays.compareTo(maxintAsBigInteger) == 1) {
<i>290</i>&nbsp;                        throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.DAYS.toString(), rhsDays.toString()}));
<i>291</i>&nbsp;                    } else {
<i>292</i>&nbsp;                        BigInteger rhsHours = (BigInteger)rhs.getField(DatatypeConstants.HOURS);
<i>293</i>&nbsp;                        if(rhsHours != null &amp;&amp; rhsHours.compareTo(maxintAsBigInteger) == 1) {
<i>294</i>&nbsp;                            throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.HOURS.toString(), rhsHours.toString()}));
<i>295</i>&nbsp;                        } else {
<i>296</i>&nbsp;                            BigInteger rhsMinutes = (BigInteger)rhs.getField(DatatypeConstants.MINUTES);
<i>297</i>&nbsp;                            if(rhsMinutes != null &amp;&amp; rhsMinutes.compareTo(maxintAsBigInteger) == 1) {
<i>298</i>&nbsp;                                throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.MINUTES.toString(), rhsMinutes.toString()}));
<i>299</i>&nbsp;                            } else {
<i>300</i>&nbsp;                                BigDecimal rhsSecondsAsBigDecimal = (BigDecimal)rhs.getField(DatatypeConstants.SECONDS);
<i>301</i>&nbsp;                                BigInteger rhsSeconds = null;
<b class="nc"><i>302</i>&nbsp;                                if(rhsSecondsAsBigDecimal != null) {</b>
<i>303</i>&nbsp;                                    rhsSeconds = rhsSecondsAsBigDecimal.toBigInteger();
<b class="nc"><i>304</i>&nbsp;                                }</b>
<i>305</i>&nbsp;
<i>306</i>&nbsp;                                if(rhsSeconds != null &amp;&amp; rhsSeconds.compareTo(maxintAsBigInteger) == 1) {
<i>307</i>&nbsp;                                    throw new UnsupportedOperationException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;TooLarge&quot;, new Object[]{this.getClass().getName() + &quot;#compare(Duration duration)&quot; + DatatypeConstants.SECONDS.toString(), rhsSeconds.toString()}));
<i>308</i>&nbsp;                                } else {
<i>309</i>&nbsp;                                    GregorianCalendar lhsCalendar = new GregorianCalendar(1970, 1, 1, 0, 0, 0);
<i>310</i>&nbsp;                                    lhsCalendar.add(1, this.getYears() * this.getSign());
<i>311</i>&nbsp;                                    lhsCalendar.add(2, this.getMonths() * this.getSign());
<i>312</i>&nbsp;                                    lhsCalendar.add(6, this.getDays() * this.getSign());
<i>313</i>&nbsp;                                    lhsCalendar.add(11, this.getHours() * this.getSign());
<i>314</i>&nbsp;                                    lhsCalendar.add(12, this.getMinutes() * this.getSign());
<i>315</i>&nbsp;                                    lhsCalendar.add(13, this.getSeconds() * this.getSign());
<i>316</i>&nbsp;                                    GregorianCalendar rhsCalendar = new GregorianCalendar(1970, 1, 1, 0, 0, 0);
<i>317</i>&nbsp;                                    rhsCalendar.add(1, rhs.getYears() * rhs.getSign());
<i>318</i>&nbsp;                                    rhsCalendar.add(2, rhs.getMonths() * rhs.getSign());
<i>319</i>&nbsp;                                    rhsCalendar.add(6, rhs.getDays() * rhs.getSign());
<i>320</i>&nbsp;                                    rhsCalendar.add(11, rhs.getHours() * rhs.getSign());
<i>321</i>&nbsp;                                    rhsCalendar.add(12, rhs.getMinutes() * rhs.getSign());
<i>322</i>&nbsp;                                    rhsCalendar.add(13, rhs.getSeconds() * rhs.getSign());
<i>323</i>&nbsp;                                    return lhsCalendar.equals(rhsCalendar)?0:this.compareDates(this, rhs);
<i>324</i>&nbsp;                                }
<i>325</i>&nbsp;                            }
<i>326</i>&nbsp;                        }
<i>327</i>&nbsp;                    }
<i>328</i>&nbsp;                }
<i>329</i>&nbsp;            }
<i>330</i>&nbsp;        }
<b class="nc"><i>331</i>&nbsp;    }</b>
<i>332</i>&nbsp;
<i>333</i>&nbsp;    private int compareDates(Duration duration1, Duration duration2) {
<i>334</i>&nbsp;        boolean resultA = true;
<i>335</i>&nbsp;        boolean resultB = true;
<i>336</i>&nbsp;        XMLGregorianCalendar tempA = (XMLGregorianCalendar)TEST_POINTS[0].clone();
<i>337</i>&nbsp;        XMLGregorianCalendar tempB = (XMLGregorianCalendar)TEST_POINTS[0].clone();
<i>338</i>&nbsp;        tempA.add(duration1);
<i>339</i>&nbsp;        tempB.add(duration2);
<i>340</i>&nbsp;        int resultA1 = tempA.compare(tempB);
<i>341</i>&nbsp;        if(resultA1 == 2) {
<i>342</i>&nbsp;            return 2;
<i>343</i>&nbsp;        } else {
<i>344</i>&nbsp;            tempA = (XMLGregorianCalendar)TEST_POINTS[1].clone();
<i>345</i>&nbsp;            tempB = (XMLGregorianCalendar)TEST_POINTS[1].clone();
<i>346</i>&nbsp;            tempA.add(duration1);
<i>347</i>&nbsp;            tempB.add(duration2);
<i>348</i>&nbsp;            int resultB1 = tempA.compare(tempB);
<i>349</i>&nbsp;            resultA1 = this.compareResults(resultA1, resultB1);
<i>350</i>&nbsp;            if(resultA1 == 2) {
<b class="nc"><i>351</i>&nbsp;                return 2;</b>
<b class="nc"><i>352</i>&nbsp;            } else {</b>
<i>353</i>&nbsp;                tempA = (XMLGregorianCalendar)TEST_POINTS[2].clone();
<i>354</i>&nbsp;                tempB = (XMLGregorianCalendar)TEST_POINTS[2].clone();
<i>355</i>&nbsp;                tempA.add(duration1);
<b class="nc"><i>356</i>&nbsp;                tempB.add(duration2);</b>
<i>357</i>&nbsp;                resultB1 = tempA.compare(tempB);
<i>358</i>&nbsp;                resultA1 = this.compareResults(resultA1, resultB1);
<i>359</i>&nbsp;                if(resultA1 == 2) {
<i>360</i>&nbsp;                    return 2;
<i>361</i>&nbsp;                } else {
<i>362</i>&nbsp;                    tempA = (XMLGregorianCalendar)TEST_POINTS[3].clone();
<i>363</i>&nbsp;                    tempB = (XMLGregorianCalendar)TEST_POINTS[3].clone();
<i>364</i>&nbsp;                    tempA.add(duration1);
<i>365</i>&nbsp;                    tempB.add(duration2);
<b class="nc"><i>366</i>&nbsp;                    resultB1 = tempA.compare(tempB);</b>
<i>367</i>&nbsp;                    resultA1 = this.compareResults(resultA1, resultB1);
<b class="nc"><i>368</i>&nbsp;                    return resultA1;</b>
<i>369</i>&nbsp;                }
<b class="nc"><i>370</i>&nbsp;            }</b>
<b class="nc"><i>371</i>&nbsp;        }</b>
<b class="nc"><i>372</i>&nbsp;    }</b>
<b class="nc"><i>373</i>&nbsp;</b>
<b class="nc"><i>374</i>&nbsp;    private int compareResults(int resultA, int resultB) {</b>
<i>375</i>&nbsp;        return resultB == 2?2:(resultA != resultB?2:resultA);
<b class="nc"><i>376</i>&nbsp;    }</b>
<i>377</i>&nbsp;
<b class="nc"><i>378</i>&nbsp;    public int hashCode() {</b>
<i>379</i>&nbsp;        GregorianCalendar cal = TEST_POINTS[0].toGregorianCalendar();
<b class="nc"><i>380</i>&nbsp;        this.addTo((Calendar)cal);</b>
<i>381</i>&nbsp;        return (int)getCalendarTimeInMillis(cal);
<i>382</i>&nbsp;    }
<i>383</i>&nbsp;
<b class="nc"><i>384</i>&nbsp;    public String toString() {</b>
<i>385</i>&nbsp;        StringBuffer buf = new StringBuffer();
<i>386</i>&nbsp;        if(this.signum &lt; 0) {
<b class="nc"><i>387</i>&nbsp;            buf.append(&#39;-&#39;);</b>
<i>388</i>&nbsp;        }
<i>389</i>&nbsp;
<b class="nc"><i>390</i>&nbsp;        buf.append(&#39;P&#39;);</b>
<i>391</i>&nbsp;        if(this.years != null) {
<i>392</i>&nbsp;            buf.append(this.years + &quot;Y&quot;);
<b class="nc"><i>393</i>&nbsp;        }</b>
<b class="nc"><i>394</i>&nbsp;</b>
<i>395</i>&nbsp;        if(this.months != null) {
<i>396</i>&nbsp;            buf.append(this.months + &quot;M&quot;);
<b class="nc"><i>397</i>&nbsp;        }</b>
<b class="nc"><i>398</i>&nbsp;</b>
<i>399</i>&nbsp;        if(this.days != null) {
<i>400</i>&nbsp;            buf.append(this.days + &quot;D&quot;);
<b class="nc"><i>401</i>&nbsp;        }</b>
<b class="nc"><i>402</i>&nbsp;</b>
<i>403</i>&nbsp;        if(this.hours != null || this.minutes != null || this.seconds != null) {
<i>404</i>&nbsp;            buf.append(&#39;T&#39;);
<b class="nc"><i>405</i>&nbsp;            if(this.hours != null) {</b>
<b class="nc"><i>406</i>&nbsp;                buf.append(this.hours + &quot;H&quot;);</b>
<i>407</i>&nbsp;            }
<i>408</i>&nbsp;
<b class="nc"><i>409</i>&nbsp;            if(this.minutes != null) {</b>
<b class="nc"><i>410</i>&nbsp;                buf.append(this.minutes + &quot;M&quot;);</b>
<i>411</i>&nbsp;            }
<i>412</i>&nbsp;
<b class="nc"><i>413</i>&nbsp;            if(this.seconds != null) {</b>
<i>414</i>&nbsp;                buf.append(this.toString(this.seconds) + &quot;S&quot;);
<b class="nc"><i>415</i>&nbsp;            }</b>
<i>416</i>&nbsp;        }
<i>417</i>&nbsp;
<i>418</i>&nbsp;        return buf.toString();
<i>419</i>&nbsp;    }
<i>420</i>&nbsp;
<i>421</i>&nbsp;    private String toString(BigDecimal bd) {
<i>422</i>&nbsp;        String intString = bd.unscaledValue().toString();
<i>423</i>&nbsp;        int scale = bd.scale();
<i>424</i>&nbsp;        if(scale == 0) {
<i>425</i>&nbsp;            return intString;
<i>426</i>&nbsp;        } else {
<i>427</i>&nbsp;            int insertionPoint = intString.length() - scale;
<i>428</i>&nbsp;            if(insertionPoint == 0) {
<i>429</i>&nbsp;                return &quot;0.&quot; + intString;
<i>430</i>&nbsp;            } else {
<i>431</i>&nbsp;                StringBuffer buf;
<i>432</i>&nbsp;                if(insertionPoint &gt; 0) {
<i>433</i>&nbsp;                    buf = new StringBuffer(intString);
<i>434</i>&nbsp;                    buf.insert(insertionPoint, &#39;.&#39;);
<i>435</i>&nbsp;                } else {
<i>436</i>&nbsp;                    buf = new StringBuffer(3 - insertionPoint + intString.length());
<i>437</i>&nbsp;                    buf.append(&quot;0.&quot;);
<i>438</i>&nbsp;
<i>439</i>&nbsp;                    for(int i = 0; i &lt; -insertionPoint; ++i) {
<i>440</i>&nbsp;                        buf.append(&#39;0&#39;);
<i>441</i>&nbsp;                    }
<i>442</i>&nbsp;
<i>443</i>&nbsp;                    buf.append(intString);
<i>444</i>&nbsp;                }
<i>445</i>&nbsp;
<i>446</i>&nbsp;                return buf.toString();
<i>447</i>&nbsp;            }
<i>448</i>&nbsp;        }
<i>449</i>&nbsp;    }
<b class="nc"><i>450</i>&nbsp;</b>
<i>451</i>&nbsp;    public boolean isSet(Field field) {
<i>452</i>&nbsp;        String methodName;
<b class="nc"><i>453</i>&nbsp;        if(field == null) {</b>
<i>454</i>&nbsp;            methodName = &quot;javax.xml.datatype.Duration#isSet(DatatypeConstants.Field field)&quot;;
<b class="nc"><i>455</i>&nbsp;            throw new NullPointerException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;FieldCannotBeNull&quot;, new Object[]{methodName}));</b>
<b class="nc"><i>456</i>&nbsp;        } else if(field == DatatypeConstants.YEARS) {</b>
<b class="nc"><i>457</i>&nbsp;            return this.years != null;</b>
<i>458</i>&nbsp;        } else if(field == DatatypeConstants.MONTHS) {
<b class="nc"><i>459</i>&nbsp;            return this.months != null;</b>
<b class="nc"><i>460</i>&nbsp;        } else if(field == DatatypeConstants.DAYS) {</b>
<i>461</i>&nbsp;            return this.days != null;
<i>462</i>&nbsp;        } else if(field == DatatypeConstants.HOURS) {
<b class="nc"><i>463</i>&nbsp;            return this.hours != null;</b>
<b class="nc"><i>464</i>&nbsp;        } else if(field == DatatypeConstants.MINUTES) {</b>
<b class="nc"><i>465</i>&nbsp;            return this.minutes != null;</b>
<b class="nc"><i>466</i>&nbsp;        } else if(field == DatatypeConstants.SECONDS) {</b>
<i>467</i>&nbsp;            return this.seconds != null;
<b class="nc"><i>468</i>&nbsp;        } else {</b>
<i>469</i>&nbsp;            methodName = &quot;javax.xml.datatype.Duration#isSet(DatatypeConstants.Field field)&quot;;
<i>470</i>&nbsp;            throw new IllegalArgumentException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;UnknownField&quot;, new Object[]{methodName, field.toString()}));
<b class="nc"><i>471</i>&nbsp;        }</b>
<b class="nc"><i>472</i>&nbsp;    }</b>
<i>473</i>&nbsp;
<i>474</i>&nbsp;    public Number getField(Field field) {
<i>475</i>&nbsp;        String methodName;
<i>476</i>&nbsp;        if(field == null) {
<i>477</i>&nbsp;            methodName = &quot;javax.xml.datatype.Duration#isSet(DatatypeConstants.Field field) &quot;;
<i>478</i>&nbsp;            throw new NullPointerException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;FieldCannotBeNull&quot;, new Object[]{methodName}));
<b class="nc"><i>479</i>&nbsp;        } else if(field == DatatypeConstants.YEARS) {</b>
<b class="nc"><i>480</i>&nbsp;            return this.years;</b>
<b class="nc"><i>481</i>&nbsp;        } else if(field == DatatypeConstants.MONTHS) {</b>
<i>482</i>&nbsp;            return this.months;
<i>483</i>&nbsp;        } else if(field == DatatypeConstants.DAYS) {
<b class="nc"><i>484</i>&nbsp;            return this.days;</b>
<b class="nc"><i>485</i>&nbsp;        } else if(field == DatatypeConstants.HOURS) {</b>
<b class="nc"><i>486</i>&nbsp;            return this.hours;</b>
<i>487</i>&nbsp;        } else if(field == DatatypeConstants.MINUTES) {
<i>488</i>&nbsp;            return this.minutes;
<b class="nc"><i>489</i>&nbsp;        } else if(field == DatatypeConstants.SECONDS) {</b>
<b class="nc"><i>490</i>&nbsp;            return this.seconds;</b>
<b class="nc"><i>491</i>&nbsp;        } else {</b>
<i>492</i>&nbsp;            methodName = &quot;javax.xml.datatype.Duration#(getSet(DatatypeConstants.Field field)&quot;;
<b class="nc"><i>493</i>&nbsp;            throw new IllegalArgumentException(DatatypeMessageFormatter.formatMessage((Locale)null, &quot;UnknownField&quot;, new Object[]{methodName, field.toString()}));</b>
<i>494</i>&nbsp;        }
<i>495</i>&nbsp;    }
<i>496</i>&nbsp;
<b class="nc"><i>497</i>&nbsp;    public int getYears() {</b>
<b class="nc"><i>498</i>&nbsp;        return this.getInt(DatatypeConstants.YEARS);</b>
<b class="nc"><i>499</i>&nbsp;    }</b>
<i>500</i>&nbsp;
<i>501</i>&nbsp;    public int getMonths() {
<b class="nc"><i>502</i>&nbsp;        return this.getInt(DatatypeConstants.MONTHS);</b>
<b class="nc"><i>503</i>&nbsp;    }</b>
<b class="nc"><i>504</i>&nbsp;</b>
<i>505</i>&nbsp;    public int getDays() {
<i>506</i>&nbsp;        return this.getInt(DatatypeConstants.DAYS);
<b class="nc"><i>507</i>&nbsp;    }</b>
<b class="nc"><i>508</i>&nbsp;</b>
<i>509</i>&nbsp;    public int getHours() {
<i>510</i>&nbsp;        return this.getInt(DatatypeConstants.HOURS);
<b class="nc"><i>511</i>&nbsp;    }</b>
<b class="nc"><i>512</i>&nbsp;</b>
<i>513</i>&nbsp;    public int getMinutes() {
<b class="nc"><i>514</i>&nbsp;        return this.getInt(DatatypeConstants.MINUTES);</b>
<b class="nc"><i>515</i>&nbsp;    }</b>
<i>516</i>&nbsp;
<i>517</i>&nbsp;    public int getSeconds() {
<i>518</i>&nbsp;        return this.getInt(DatatypeConstants.SECONDS);
<i>519</i>&nbsp;    }
<b class="nc"><i>520</i>&nbsp;</b>
<b class="nc"><i>521</i>&nbsp;    private int getInt(Field field) {</b>
<i>522</i>&nbsp;        Number n = this.getField(field);
<i>523</i>&nbsp;        return n == null?0:n.intValue();
<b class="nc"><i>524</i>&nbsp;    }</b>
<b class="nc"><i>525</i>&nbsp;</b>
<b class="nc"><i>526</i>&nbsp;    public long getTimeInMillis(Calendar startInstant) {</b>
<b class="nc"><i>527</i>&nbsp;        Calendar cal = (Calendar)startInstant.clone();</b>
<b class="nc"><i>528</i>&nbsp;        this.addTo((Calendar)cal);</b>
<b class="nc"><i>529</i>&nbsp;        return getCalendarTimeInMillis(cal) - getCalendarTimeInMillis(startInstant);</b>
<b class="nc"><i>530</i>&nbsp;    }</b>
<i>531</i>&nbsp;
<i>532</i>&nbsp;    public long getTimeInMillis(Date startInstant) {
<i>533</i>&nbsp;        GregorianCalendar cal = new GregorianCalendar();
<i>534</i>&nbsp;        cal.setTime(startInstant);
<i>535</i>&nbsp;        this.addTo((Calendar)cal);
<i>536</i>&nbsp;        return getCalendarTimeInMillis(cal) - startInstant.getTime();
<i>537</i>&nbsp;    }
<i>538</i>&nbsp;
<i>539</i>&nbsp;    public Duration normalizeWith(Calendar startTimeInstant) {
<i>540</i>&nbsp;        Calendar c = (Calendar)startTimeInstant.clone();
<i>541</i>&nbsp;        c.add(1, this.getYears() * this.signum);
<b class="nc"><i>542</i>&nbsp;        c.add(2, this.getMonths() * this.signum);</b>
<i>543</i>&nbsp;        c.add(5, this.getDays() * this.signum);
<i>544</i>&nbsp;        long diff = getCalendarTimeInMillis(c) - getCalendarTimeInMillis(startTimeInstant);
<i>545</i>&nbsp;        int days = (int)(diff / 86400000L);
<i>546</i>&nbsp;        return new DurationImpl(days &gt;= 0, (BigInteger)null, (BigInteger)null, wrap(Math.abs(days)), (BigInteger)this.getField(DatatypeConstants.HOURS), (BigInteger)this.getField(DatatypeConstants.MINUTES), (BigDecimal)this.getField(DatatypeConstants.SECONDS));
<i>547</i>&nbsp;    }
<i>548</i>&nbsp;
<i>549</i>&nbsp;    public Duration multiply(int factor) {
<i>550</i>&nbsp;        return this.multiply(BigDecimal.valueOf((long)factor));
<i>551</i>&nbsp;    }
<i>552</i>&nbsp;
<b class="nc"><i>553</i>&nbsp;    public Duration multiply(BigDecimal factor) {</b>
<i>554</i>&nbsp;        BigDecimal carry = ZERO;
<i>555</i>&nbsp;        int factorSign = factor.signum();
<i>556</i>&nbsp;        factor = factor.abs();
<i>557</i>&nbsp;        BigDecimal[] buf = new BigDecimal[6];
<i>558</i>&nbsp;
<i>559</i>&nbsp;        for(int i = 0; i &lt; 5; ++i) {
<i>560</i>&nbsp;            BigDecimal bd = this.getFieldAsBigDecimal(FIELDS[i]);
<i>561</i>&nbsp;            bd = bd.multiply(factor).add(carry);
<i>562</i>&nbsp;            buf[i] = bd.setScale(0, 1);
<i>563</i>&nbsp;            bd = bd.subtract(buf[i]);
<i>564</i>&nbsp;            if(i == 1) {
<i>565</i>&nbsp;                if(bd.signum() != 0) {
<i>566</i>&nbsp;                    throw new IllegalStateException();
<i>567</i>&nbsp;                }
<b class="nc"><i>568</i>&nbsp;</b>
<i>569</i>&nbsp;                carry = ZERO;
<b class="nc"><i>570</i>&nbsp;            } else {</b>
<b class="nc"><i>571</i>&nbsp;                carry = bd.multiply(FACTORS[i]);</b>
<i>572</i>&nbsp;            }
<b class="nc"><i>573</i>&nbsp;        }</b>
<b class="nc"><i>574</i>&nbsp;</b>
<i>575</i>&nbsp;        if(this.seconds != null) {
<i>576</i>&nbsp;            buf[5] = this.seconds.multiply(factor).add(carry);
<b class="nc"><i>577</i>&nbsp;        } else {</b>
<i>578</i>&nbsp;            buf[5] = carry;
<b class="nc"><i>579</i>&nbsp;        }</b>
<i>580</i>&nbsp;
<i>581</i>&nbsp;        return new DurationImpl(this.signum * factorSign &gt;= 0, toBigInteger(buf[0], null == this.years), toBigInteger(buf[1], null == this.months), toBigInteger(buf[2], null == this.days), toBigInteger(buf[3], null == this.hours), toBigInteger(buf[4], null == this.minutes), buf[5].signum() == 0 &amp;&amp; this.seconds == null?null:buf[5]);
<i>582</i>&nbsp;    }
<i>583</i>&nbsp;
<i>584</i>&nbsp;    private BigDecimal getFieldAsBigDecimal(Field f) {
<i>585</i>&nbsp;        if(f == DatatypeConstants.SECONDS) {
<i>586</i>&nbsp;            return this.seconds != null?this.seconds:ZERO;
<i>587</i>&nbsp;        } else {
<i>588</i>&nbsp;            BigInteger bi = (BigInteger)this.getField(f);
<i>589</i>&nbsp;            return bi == null?ZERO:new BigDecimal(bi);
<i>590</i>&nbsp;        }
<i>591</i>&nbsp;    }
<i>592</i>&nbsp;
<i>593</i>&nbsp;    private static BigInteger toBigInteger(BigDecimal value, boolean canBeNull) {
<i>594</i>&nbsp;        return canBeNull &amp;&amp; value.signum() == 0?null:value.unscaledValue();
<i>595</i>&nbsp;    }
<i>596</i>&nbsp;
<i>597</i>&nbsp;    public Duration add(Duration rhs) {
<i>598</i>&nbsp;        BigDecimal[] buf = new BigDecimal[]{sanitize((BigInteger)((BigInteger)this.getField(DatatypeConstants.YEARS)), this.getSign()).add(sanitize((BigInteger)((BigInteger)rhs.getField(DatatypeConstants.YEARS)), rhs.getSign())), sanitize((BigInteger)((BigInteger)this.getField(DatatypeConstants.MONTHS)), this.getSign()).add(sanitize((BigInteger)((BigInteger)rhs.getField(DatatypeConstants.MONTHS)), rhs.getSign())), sanitize((BigInteger)((BigInteger)this.getField(DatatypeConstants.DAYS)), this.getSign()).add(sanitize((BigInteger)((BigInteger)rhs.getField(DatatypeConstants.DAYS)), rhs.getSign())), sanitize((BigInteger)((BigInteger)this.getField(DatatypeConstants.HOURS)), this.getSign()).add(sanitize((BigInteger)((BigInteger)rhs.getField(DatatypeConstants.HOURS)), rhs.getSign())), sanitize((BigInteger)((BigInteger)this.getField(DatatypeConstants.MINUTES)), this.getSign()).add(sanitize((BigInteger)((BigInteger)rhs.getField(DatatypeConstants.MINUTES)), rhs.getSign())), sanitize((BigDecimal)((BigDecimal)this.getField(DatatypeConstants.SECONDS)), this.getSign()).add(sanitize((BigDecimal)((BigDecimal)rhs.getField(DatatypeConstants.SECONDS)), rhs.getSign()))};
<i>599</i>&nbsp;        alignSigns(buf, 0, 2);
<i>600</i>&nbsp;        alignSigns(buf, 2, 6);
<b class="nc"><i>601</i>&nbsp;        int s = 0;</b>
<b class="nc"><i>602</i>&nbsp;</b>
<b class="nc"><i>603</i>&nbsp;        for(int i = 0; i &lt; 6; ++i) {</b>
<i>604</i>&nbsp;            if(s * buf[i].signum() &lt; 0) {
<i>605</i>&nbsp;                throw new IllegalStateException();
<i>606</i>&nbsp;            }
<b class="nc"><i>607</i>&nbsp;</b>
<b class="nc"><i>608</i>&nbsp;            if(s == 0) {</b>
<i>609</i>&nbsp;                s = buf[i].signum();
<i>610</i>&nbsp;            }
<i>611</i>&nbsp;        }
<b class="nc"><i>612</i>&nbsp;</b>
<b class="nc"><i>613</i>&nbsp;        return new DurationImpl(s &gt;= 0, toBigInteger(sanitize((BigDecimal)buf[0], s), this.getField(DatatypeConstants.YEARS) == null &amp;&amp; rhs.getField(DatatypeConstants.YEARS) == null), toBigInteger(sanitize((BigDecimal)buf[1], s), this.getField(DatatypeConstants.MONTHS) == null &amp;&amp; rhs.getField(DatatypeConstants.MONTHS) == null), toBigInteger(sanitize((BigDecimal)buf[2], s), this.getField(DatatypeConstants.DAYS) == null &amp;&amp; rhs.getField(DatatypeConstants.DAYS) == null), toBigInteger(sanitize((BigDecimal)buf[3], s), this.getField(DatatypeConstants.HOURS) == null &amp;&amp; rhs.getField(DatatypeConstants.HOURS) == null), toBigInteger(sanitize((BigDecimal)buf[4], s), this.getField(DatatypeConstants.MINUTES) == null &amp;&amp; rhs.getField(DatatypeConstants.MINUTES) == null), buf[5].signum() == 0 &amp;&amp; this.getField(DatatypeConstants.SECONDS) == null &amp;&amp; rhs.getField(DatatypeConstants.SECONDS) == null?null:sanitize((BigDecimal)buf[5], s));</b>
<i>614</i>&nbsp;    }
<b class="nc"><i>615</i>&nbsp;</b>
<b class="nc"><i>616</i>&nbsp;    private static void alignSigns(BigDecimal[] buf, int start, int end) {</b>
<b class="nc"><i>617</i>&nbsp;        boolean touched;</b>
<i>618</i>&nbsp;        do {
<b class="nc"><i>619</i>&nbsp;            touched = false;</b>
<b class="nc"><i>620</i>&nbsp;            int s = 0;</b>
<i>621</i>&nbsp;
<i>622</i>&nbsp;            for(int i = start; i &lt; end; ++i) {
<i>623</i>&nbsp;                if(s * buf[i].signum() &lt; 0) {
<i>624</i>&nbsp;                    touched = true;
<i>625</i>&nbsp;                    BigDecimal borrow = buf[i].abs().divide(FACTORS[i - 1], 0);
<i>626</i>&nbsp;                    if(buf[i].signum() &gt; 0) {
<i>627</i>&nbsp;                        borrow = borrow.negate();
<i>628</i>&nbsp;                    }
<i>629</i>&nbsp;
<i>630</i>&nbsp;                    buf[i - 1] = buf[i - 1].subtract(borrow);
<i>631</i>&nbsp;                    buf[i] = buf[i].add(borrow.multiply(FACTORS[i - 1]));
<i>632</i>&nbsp;                }
<i>633</i>&nbsp;
<i>634</i>&nbsp;                if(buf[i].signum() != 0) {
<i>635</i>&nbsp;                    s = buf[i].signum();
<i>636</i>&nbsp;                }
<i>637</i>&nbsp;            }
<i>638</i>&nbsp;        } while(touched);
<i>639</i>&nbsp;
<b class="nc"><i>640</i>&nbsp;    }</b>
<b class="nc"><i>641</i>&nbsp;</b>
<i>642</i>&nbsp;    private static BigDecimal sanitize(BigInteger value, int signum) {
<b class="nc"><i>643</i>&nbsp;        return signum != 0 &amp;&amp; value != null?(signum &gt; 0?new BigDecimal(value):new BigDecimal(value.negate())):ZERO;</b>
<i>644</i>&nbsp;    }
<b class="nc"><i>645</i>&nbsp;</b>
<i>646</i>&nbsp;    static BigDecimal sanitize(BigDecimal value, int signum) {
<i>647</i>&nbsp;        return signum != 0 &amp;&amp; value != null?(signum &gt; 0?value:value.negate()):ZERO;
<i>648</i>&nbsp;    }
<i>649</i>&nbsp;
<i>650</i>&nbsp;    public Duration subtract(Duration rhs) {
<i>651</i>&nbsp;        return this.add(rhs.negate());
<i>652</i>&nbsp;    }
<i>653</i>&nbsp;
<i>654</i>&nbsp;    public Duration negate() {
<i>655</i>&nbsp;        return new DurationImpl(this.signum &lt;= 0, this.years, this.months, this.days, this.hours, this.minutes, this.seconds);
<i>656</i>&nbsp;    }
<i>657</i>&nbsp;
<i>658</i>&nbsp;    public int signum() {
<i>659</i>&nbsp;        return this.signum;
<i>660</i>&nbsp;    }
<i>661</i>&nbsp;
<i>662</i>&nbsp;    public void addTo(Calendar calendar) {
<i>663</i>&nbsp;        calendar.add(1, this.getYears() * this.signum);
<i>664</i>&nbsp;        calendar.add(2, this.getMonths() * this.signum);
<i>665</i>&nbsp;        calendar.add(5, this.getDays() * this.signum);
<i>666</i>&nbsp;        calendar.add(10, this.getHours() * this.signum);
<b class="nc"><i>667</i>&nbsp;        calendar.add(12, this.getMinutes() * this.signum);</b>
<b class="nc"><i>668</i>&nbsp;        calendar.add(13, this.getSeconds() * this.signum);</b>
<i>669</i>&nbsp;        if(this.seconds != null) {
<b class="nc"><i>670</i>&nbsp;            BigDecimal fraction = this.seconds.subtract(this.seconds.setScale(0, 1));</b>
<i>671</i>&nbsp;            int millisec = fraction.movePointRight(3).intValue();
<i>672</i>&nbsp;            calendar.add(14, millisec * this.signum);
<b class="nc"><i>673</i>&nbsp;        }</b>
<i>674</i>&nbsp;
<i>675</i>&nbsp;    }
<i>676</i>&nbsp;
<i>677</i>&nbsp;    public void addTo(Date date) {
<i>678</i>&nbsp;        GregorianCalendar cal = new GregorianCalendar();
<i>679</i>&nbsp;        cal.setTime(date);
<i>680</i>&nbsp;        this.addTo((Calendar)cal);
<i>681</i>&nbsp;        date.setTime(getCalendarTimeInMillis(cal));
<b class="nc"><i>682</i>&nbsp;    }</b>
<i>683</i>&nbsp;
<i>684</i>&nbsp;    private Object writeReplace() throws IOException {
<i>685</i>&nbsp;        return new DurationImpl.DurationStream(this.toString());
<i>686</i>&nbsp;    }
<i>687</i>&nbsp;
<i>688</i>&nbsp;    private static long getCalendarTimeInMillis(Calendar cal) {
<i>689</i>&nbsp;        return cal.getTime().getTime();
<i>690</i>&nbsp;    }
<i>691</i>&nbsp;
<i>692</i>&nbsp;    static {
<i>693</i>&nbsp;        FIELDS = new Field[]{DatatypeConstants.YEARS, DatatypeConstants.MONTHS, DatatypeConstants.DAYS, DatatypeConstants.HOURS, DatatypeConstants.MINUTES, DatatypeConstants.SECONDS};
<i>694</i>&nbsp;        FIELD_IDS = new int[]{DatatypeConstants.YEARS.getId(), DatatypeConstants.MONTHS.getId(), DatatypeConstants.DAYS.getId(), DatatypeConstants.HOURS.getId(), DatatypeConstants.MINUTES.getId(), DatatypeConstants.SECONDS.getId()};
<i>695</i>&nbsp;        GMT = TimeZone.getTimeZone(&quot;GMT&quot;);
<i>696</i>&nbsp;        ZERO = BigDecimal.valueOf(0L);
<i>697</i>&nbsp;        TEST_POINTS = new XMLGregorianCalendar[]{XMLGregorianCalendarImpl.parse(&quot;1696-09-01T00:00:00Z&quot;), XMLGregorianCalendarImpl.parse(&quot;1697-02-01T00:00:00Z&quot;), XMLGregorianCalendarImpl.parse(&quot;1903-03-01T00:00:00Z&quot;), XMLGregorianCalendarImpl.parse(&quot;1903-07-01T00:00:00Z&quot;)};
<i>698</i>&nbsp;        FACTORS = new BigDecimal[]{BigDecimal.valueOf(12L), null, BigDecimal.valueOf(24L), BigDecimal.valueOf(60L), BigDecimal.valueOf(60L)};
<i>699</i>&nbsp;    }
<i>700</i>&nbsp;
<i>701</i>&nbsp;    private static class DurationStream implements Serializable {
<i>702</i>&nbsp;        private final String lexical;
<i>703</i>&nbsp;        private static final long serialVersionUID = 1L;
<i>704</i>&nbsp;
<i>705</i>&nbsp;        private DurationStream(String _lexical) {
<i>706</i>&nbsp;            this.lexical = _lexical;
<i>707</i>&nbsp;        }
<i>708</i>&nbsp;
<i>709</i>&nbsp;        private Object readResolve() throws ObjectStreamException {
<i>710</i>&nbsp;            return new DurationImpl(this.lexical);
<i>711</i>&nbsp;        }
<i>712</i>&nbsp;    }
<i>713</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2014-12-21 15:46</div>
</div>
</body>
</html>
